{"version":3,"file":"sugestoes-contextuais.js","sourceRoot":"","sources":["../../../src/analistas/estrategistas/sugestoes-contextuais.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n/**\n * Analista de Sugestões Contextuais Inteligentes\n *\n * Utiliza o sistema de detecção contextual para gerar sugestões específicas\n * baseadas no tipo real de projeto detectado, considerando:\n * - Dependências e configurações\n * - Padrões de código específicos\n * - Estrutura e nomenclatura\n * - Melhores práticas por tecnologia\n */\n\nimport { detectarContextoInteligente } from '@analistas/detectores/detector-contexto-inteligente.js';\nimport type { NodePath } from '@babel/traverse';\nimport type { Node } from '@babel/types';\nimport { log } from '@core/messages/index.js';\nimport { SugestoesContextuaisMessages } from '@core/messages/ui/sugestoes-contextuais-messages.js';\n\nimport type { Analista, ContextoExecucao, Ocorrencia, PackageJson } from '@';\n\nexport const analistaSugestoesContextuais: Analista = {\n  nome: 'sugestoes-contextuais',\n  categoria: 'estrategia',\n  descricao:\n    'Gera sugestões específicas baseadas no contexto real do projeto detectado',\n  global: true, // Analisa contexto global do projeto\n\n  async aplicar(\n    _src: string,\n    _relPath: string,\n    _ast: NodePath<Node> | null, // AST node path\n    _fullPath?: string,\n    contexto?: ContextoExecucao,\n  ): Promise<Ocorrencia[]> {\n    const ocorrencias: Ocorrencia[] = [];\n\n    if (!contexto) {\n      return ocorrencias;\n    }\n\n    try {\n      // Obter package.json se disponível\n      let packageJson: PackageJson | undefined;\n      try {\n        const pkgFile = contexto.arquivos.find(\n          (f) => f.relPath === 'package.json',\n        );\n        if (pkgFile?.content) {\n          packageJson = JSON.parse(pkgFile.content);\n        }\n      } catch {\n        // Ignorar erros de parsing do package.json\n      }\n\n      // Extrair estrutura de diretórios dos arquivos\n      const estruturaDetectada = Array.from(\n        new Set(\n          contexto.arquivos\n            .map((f) =>\n              f.relPath.includes('/') ? f.relPath.split('/')[0] : '',\n            )\n            .filter((dir) => dir && dir !== '.'),\n        ),\n      );\n\n      // Executar detecção contextual inteligente\n      const resultados = detectarContextoInteligente(\n        estruturaDetectada,\n        contexto.arquivos,\n        packageJson,\n      );\n\n      if (resultados.length === 0) {\n        ocorrencias.push({\n          tipo: 'sugestoes_arquitetura',\n          nivel: 'info',\n          mensagem: SugestoesContextuaisMessages.arquetipoNaoIdentificado,\n          relPath: '',\n          linha: 0,\n        });\n        return ocorrencias;\n      }\n\n      const melhorResultado = resultados[0];\n      const confiancaPercent = Math.round(melhorResultado.confiancaTotal * 100);\n\n      // Gerar ocorrência principal com identificação\n      ocorrencias.push({\n        tipo: 'identificacao_projeto',\n        nivel: 'info',\n        mensagem: SugestoesContextuaisMessages.projetoIdentificado(\n          melhorResultado.tecnologia,\n          confiancaPercent,\n        ),\n        relPath: '',\n        linha: 0,\n        detalhes: {\n          tecnologia: melhorResultado.tecnologia,\n          confianca: melhorResultado.confiancaTotal,\n          evidencias: melhorResultado.evidencias.length,\n        },\n      });\n\n      // Gerar sugestões de melhorias\n      for (const sugestao of melhorResultado.sugestoesMelhoria || []) {\n        ocorrencias.push({\n          tipo: 'sugestao_melhoria',\n          nivel: 'info',\n          mensagem: sugestao,\n          relPath: '',\n          linha: 0,\n          detalhes: {\n            tecnologia: melhorResultado.tecnologia,\n            categoria: 'melhoria',\n          },\n        });\n      }\n\n      // Gerar alertas de problemas\n      for (const problema of melhorResultado.problemasDetectados || []) {\n        ocorrencias.push({\n          tipo: 'problema_seguranca',\n          nivel: 'aviso',\n          mensagem: problema,\n          relPath: '',\n          linha: 0,\n          detalhes: {\n            tecnologia: melhorResultado.tecnologia,\n            categoria: 'problema',\n          },\n        });\n      }\n\n      // Gerar ocorrências para evidências mais relevantes\n      const evidenciasTop = melhorResultado.evidencias\n        .filter((e) => e.confianca > 0.8)\n        .slice(0, 5); // Top 5 evidências\n\n      for (const evidencia of evidenciasTop) {\n        let mensagem = '';\n        const nivel: 'info' | 'aviso' | 'erro' = 'info';\n\n        switch (evidencia.tipo) {\n          case 'dependencia':\n            mensagem = SugestoesContextuaisMessages.evidenciaDependencia(\n              evidencia.valor,\n              melhorResultado.tecnologia,\n            );\n            break;\n          case 'import':\n            mensagem = SugestoesContextuaisMessages.evidenciaImport(\n              evidencia.valor,\n              evidencia.localizacao,\n            );\n            break;\n          case 'codigo':\n            mensagem = SugestoesContextuaisMessages.evidenciaCodigo(\n              evidencia.localizacao,\n            );\n            break;\n          case 'estrutura':\n            mensagem = SugestoesContextuaisMessages.evidenciaEstrutura(\n              evidencia.valor,\n              melhorResultado.tecnologia,\n            );\n            break;\n          default:\n            continue; // Pular outros tipos menos relevantes\n        }\n\n        ocorrencias.push({\n          tipo: 'evidencia_contextual',\n          nivel,\n          mensagem,\n          relPath: evidencia.localizacao || '',\n          linha: 0,\n          detalhes: {\n            tecnologia: melhorResultado.tecnologia,\n            tipoEvidencia: evidencia.tipo,\n            confianca: evidencia.confianca,\n          },\n        });\n      }\n\n      // Se houver múltiplas tecnologias detectadas, mostrar alternativas\n      if (resultados.length > 1) {\n        const alternativas = resultados\n          .slice(1, 3)\n          .map(\n            (r) => `${r.tecnologia} (${Math.round(r.confiancaTotal * 100)}%)`,\n          )\n          .join(', ');\n\n        ocorrencias.push({\n          tipo: 'tecnologias_alternativas',\n          nivel: 'info',\n          mensagem:\n            SugestoesContextuaisMessages.tecnologiasAlternativas(alternativas),\n          relPath: '',\n          linha: 0,\n          detalhes: {\n            alternativas: resultados.slice(1, 3),\n          },\n        });\n      }\n    } catch (error) {\n      log.aviso(\n        SugestoesContextuaisMessages.erroAnaliseContextual(\n          error instanceof Error ? error.message : String(error),\n        ),\n      );\n\n      ocorrencias.push({\n        tipo: 'erro_analise',\n        nivel: 'aviso',\n        mensagem: SugestoesContextuaisMessages.erroDuranteAnalise,\n        relPath: '',\n        linha: 0,\n      });\n    }\n\n    return ocorrencias;\n  },\n};\n"]}