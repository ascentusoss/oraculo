{"version":3,"file":"arquetipos-personalizados.js","sourceRoot":"","sources":["../../../src/analistas/js-ts/arquetipos-personalizados.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n//  tipo-literal-inline-complexo\n// Justificativa: tipos locais para arqu√©tipos personalizados\n/**\n * Sistema de Arqu√©tipos Personalizados do Or√°culo\n *\n * Permite que usu√°rios criem arqu√©tipos personalizados para seus projetos,\n * mantendo compatibilidade com arqu√©tipos oficiais e oferecendo sugest√µes\n * de melhores pr√°ticas baseadas na personaliza√ß√£o do usu√°rio.\n */\n\nimport { promises as fs } from 'node:fs';\nimport path from 'node:path';\n\nimport { ARQUETIPOS } from '/estrategistas/arquetipos-defs.js';\n// NOTA: parseFileAST ainda n√£o foi implementado no m√≥dulo de parsing\n// import { parseFileAST } from '/parsing/parser.js';\nimport { log } from '/messages/index.js';\nimport { ORACULO_FILES } from '/registry/paths.js';\nimport { lerEstado, salvarEstado } from '/persistence/persistencia.js';\n\nimport type { ArquetipoEstruturaDef, ArquetipoPersonalizado } from '@';\n\n// Nome do arquivo legado (para compatibilidade)\nconst ARQUETIPO_PERSONALIZADO_FILENAME = 'oraculo.repo.arquetipo.json';\n\n/**\n * Carrega o arqu√©tipo personalizado do projeto atual\n * Tenta primeiro o novo caminho (.oraculo/estrutura.arquetipo.json),\n * depois o legado (raiz/oraculo.repo.arquetipo.json)\n */\n\nexport async function carregarArquetipoPersonalizado(\n  baseDir: string = process.cwd(),\n): Promise<ArquetipoPersonalizado | null> {\n  // Tentar novo caminho primeiro\n  const novoCaminho = ORACULO_FILES.ESTRUTURA_ARQUETIPO;\n  const caminhoLegado = path.join(baseDir, ARQUETIPO_PERSONALIZADO_FILENAME);\n\n  try {\n    // Tenta novo caminho\n    const arquetipo = await lerEstado<ArquetipoPersonalizado | null>(\n      novoCaminho,\n      null,\n    );\n\n    if (arquetipo && arquetipo.nome && arquetipo.arquetipoOficial) {\n      return arquetipo;\n    }\n\n    // Se n√£o encontrou no novo caminho, tenta o legado\n    const arquetipoLegado = await lerEstado<ArquetipoPersonalizado | null>(\n      caminhoLegado,\n      null,\n    );\n\n    // Valida√ß√£o b√°sica\n    if (\n      !arquetipoLegado ||\n      !arquetipoLegado.nome ||\n      !arquetipoLegado.arquetipoOficial\n    ) {\n      // Reduz ru√≠do em testes e quando n√£o estiver em modo verbose\n      const isTest = (process.env.VITEST ?? '') !== '';\n      const isVerbose =\n        (log as unknown as { verbose?: boolean }).verbose || false;\n      if (!isTest && isVerbose) {\n        log.aviso(\n          `‚ö†Ô∏è Arqu√©tipo personalizado n√£o encontrado em ${novoCaminho} nem ${caminhoLegado}`,\n        );\n      }\n      return null;\n    }\n\n    return arquetipoLegado;\n  } catch {\n    // Arquivo n√£o existe ou √© inv√°lido - isso √© normal\n    return null;\n  }\n}\n/**\n * Salva o arqu√©tipo personalizado do projeto atual\n * Usa o novo caminho (.oraculo/estrutura.arquetipo.json)\n */\nexport async function salvarArquetipoPersonalizado(\n  arquetipo: Omit<ArquetipoPersonalizado, 'metadata'>,\n  _baseDir: string = process.cwd(),\n): Promise<void> {\n  const arquetipoCompleto: ArquetipoPersonalizado = {\n    ...arquetipo,\n    metadata: {\n      criadoEm: new Date().toISOString(),\n      versao: '1.0.0',\n      notasUsuario: undefined,\n    },\n  };\n\n  // Usar novo caminho centralizado\n  const novoCaminho = ORACULO_FILES.ESTRUTURA_ARQUETIPO;\n\n  // Garantir que o diret√≥rio .oraculo existe\n  const oraculoDir = path.dirname(novoCaminho);\n  try {\n    await fs.mkdir(oraculoDir, { recursive: true });\n  } catch {\n    // Diret√≥rio j√° existe\n  }\n\n  await salvarEstado(novoCaminho, arquetipoCompleto);\n\n  log.sucesso(`‚úÖ Arqu√©tipo personalizado salvo em ${novoCaminho}`);\n}\n\n/**\n * Verifica se existe um arqu√©tipo personalizado\n * Verifica tanto o novo caminho quanto o legado\n */\n\nexport async function existeArquetipoPersonalizado(\n  baseDir: string = process.cwd(),\n): Promise<boolean> {\n  // Verificar novo caminho primeiro\n  try {\n    await fs.access(ORACULO_FILES.ESTRUTURA_ARQUETIPO);\n    return true;\n  } catch {\n    // Tentar caminho legado\n    const arquivoArquetipo = path.join(\n      baseDir,\n      ARQUETIPO_PERSONALIZADO_FILENAME,\n    );\n    try {\n      await fs.access(arquivoArquetipo);\n      return true;\n    } catch {\n      return false;\n    }\n  }\n}\n\n/**\n * Obt√©m o arqu√©tipo oficial base para um arqu√©tipo personalizado\n */\n\nexport function obterArquetipoOficial(\n  arquetipoPersonalizado: ArquetipoPersonalizado,\n): ArquetipoEstruturaDef | null {\n  return (\n    (ARQUETIPOS.find(\n      (arq) =>\n        (arq as unknown as ArquetipoEstruturaDef).nome ===\n        arquetipoPersonalizado.arquetipoOficial,\n    ) as ArquetipoEstruturaDef | undefined) || null\n  );\n}\n\n/**\n * Gera sugest√µes de cria√ß√£o de arqu√©tipo personalizado quando projeto √© desconhecido\n */\n\nexport function gerarSugestaoArquetipoPersonalizado(projetoDesconhecido: {\n  nome: string;\n  estruturaDetectada: string[];\n  arquivosRaiz: string[];\n}): string {\n  const sugestao = `\nüåü Projeto personalizado detectado: \"${projetoDesconhecido.nome}\"\n\nO Or√°culo identificou uma estrutura de projeto que n√£o corresponde a arqu√©tipos oficiais,\nmas voc√™ pode criar um arqu√©tipo personalizado para receber sugest√µes otimizadas!\n\nüìÅ Estrutura detectada:\n${projetoDesconhecido.estruturaDetectada.map((dir) => `  ‚Ä¢ ${dir}`).join('\\n')}\n\nüìÑ Arquivos na raiz:\n${projetoDesconhecido.arquivosRaiz\n  .slice(0, 5)\n  .map((file) => `  ‚Ä¢ ${file}`)\n  .join('\\n')}\n${projetoDesconhecido.arquivosRaiz.length > 5 ? `  ‚Ä¢ ... e mais ${projetoDesconhecido.arquivosRaiz.length - 5} arquivos` : ''}\n\nüí° Para criar seu arqu√©tipo personalizado, execute:\n   oraculo diagnosticar --criar-arquetipo\n\nIsso criar√° um arquivo 'oraculo.repo.arquetipo.json' com base na estrutura atual,\nque o Or√°culo usar√° para oferecer sugest√µes personalizadas mantendo as melhores pr√°ticas.\n`;\n\n  return sugestao;\n}\n\n/**\n * Cria um template de arqu√©tipo personalizado baseado na estrutura atual do projeto\n */\n\nexport function criarTemplateArquetipoPersonalizado(\n  nomeProjeto: string,\n  estruturaDetectada: string[],\n  arquivosRaiz: string[],\n  arquetipoSugerido: string = 'generico',\n): Omit<ArquetipoPersonalizado, 'metadata'> {\n  // Usa o arqu√©tipo sugerido pelo sistema de detec√ß√£o inteligente\n  // Se n√£o foi fornecido, tenta inferir de forma mais rigorosa\n  let arquetipoOficial = arquetipoSugerido;\n\n  if (arquetipoOficial === 'generico' || !arquetipoOficial) {\n    // Heur√≠stica mais rigorosa para evitar falsos positivos\n\n    // CLI: precisa ter bin/ E (cli/ OU commands/) E package.json com bin\n    const temBin = estruturaDetectada.some(\n      (dir) => dir === 'bin' || dir.startsWith('bin/'),\n    );\n    const temCli = estruturaDetectada.some(\n      (dir) => dir.includes('/cli') || dir === 'cli',\n    );\n    const temCommands = estruturaDetectada.some(\n      (dir) => dir.includes('/commands') || dir === 'commands',\n    );\n\n    if (temBin && (temCli || temCommands)) {\n      arquetipoOficial = 'cli-modular';\n    }\n    // Bot: precisa ter src/bot/ E (events/ OU scenes/) - muito espec√≠fico\n    else if (\n      estruturaDetectada.some(\n        (dir) => dir === 'src/bot' || dir.startsWith('src/bot/'),\n      ) &&\n      estruturaDetectada.some(\n        (dir) => dir.includes('events') || dir.includes('scenes'),\n      )\n    ) {\n      arquetipoOficial = 'bot';\n    }\n    // API: precisa ter controllers/ E routes/\n    else if (\n      estruturaDetectada.some((dir) => dir.includes('controllers')) &&\n      estruturaDetectada.some((dir) => dir.includes('routes'))\n    ) {\n      arquetipoOficial = 'api-rest-express';\n    }\n    // Fullstack: precisa ter pages/ E api/ (ambos)\n    else if (\n      estruturaDetectada.some((dir) => dir.includes('pages')) &&\n      estruturaDetectada.some((dir) => dir.includes('api'))\n    ) {\n      arquetipoOficial = 'fullstack';\n    }\n    // Fallback: lib-tsc se tem src/ organizado mas nenhum dos padr√µes acima\n    else if (\n      estruturaDetectada.some((dir) => dir === 'src' || dir.startsWith('src/'))\n    ) {\n      arquetipoOficial = 'lib-tsc';\n    }\n  }\n\n  // Identifica diret√≥rios principais (n√£o muito profundos)\n  const diretoriosPrincipais = estruturaDetectada\n    .filter((dir) => !dir.includes('/') || dir.split('/').length <= 2)\n    .filter(\n      (dir) => !dir.startsWith('node_modules') && !dir.startsWith('.git'),\n    );\n\n  // Identifica arquivos-chave na raiz\n  const arquivosChave = arquivosRaiz\n    .filter(\n      (file) =>\n        ['package.json', 'tsconfig.json', 'README.md', '.env.example'].includes(\n          file,\n        ) ||\n        file.endsWith('.ts') ||\n        file.endsWith('.js'),\n    )\n    .slice(0, 5);\n\n  return {\n    nome: nomeProjeto,\n    descricao: `Projeto personalizado: ${nomeProjeto}`,\n    arquetipoOficial,\n    estruturaPersonalizada: {\n      diretorios: diretoriosPrincipais,\n      arquivosChave,\n      padroesNomenclatura: {\n        // Padr√µes comuns baseados na estrutura detectada\n        ...(estruturaDetectada.some((d) => d.includes('components')) && {\n          components: '*-component.*',\n        }),\n        ...(estruturaDetectada.some((d) => d.includes('utils')) && {\n          utils: '*-util.*',\n        }),\n        ...(estruturaDetectada.some((d) => d.includes('test')) && {\n          tests: '*.test.*',\n        }),\n      },\n    },\n    melhoresPraticas: {\n      recomendado: ['src/', 'tests/', 'docs/', 'README.md', '.env.example'],\n      evitar: ['temp/', 'cache/', '*.log'],\n      notas: [\n        'Mantenha c√≥digo fonte organizado em src/',\n        'Separe testes em pasta dedicada',\n        'Documente APIs e funcionalidades importantes',\n      ],\n    },\n  };\n}\n\n/**\n * Valida um arqu√©tipo personalizado\n */\n\nexport function validarArquetipoPersonalizado(\n  arquetipo: ArquetipoPersonalizado,\n): {\n  valido: boolean;\n  erros: string[];\n} {\n  const erros: string[] = [];\n\n  if (!arquetipo.nome || typeof arquetipo.nome !== 'string') {\n    erros.push('Nome do projeto √© obrigat√≥rio');\n  }\n\n  if (\n    !arquetipo.arquetipoOficial ||\n    typeof arquetipo.arquetipoOficial !== 'string'\n  ) {\n    erros.push('Arqu√©tipo oficial base √© obrigat√≥rio');\n  } else {\n    // Verifica se o arqu√©tipo oficial existe\n    const arquetipoOficial = ARQUETIPOS.find(\n      (arq: ArquetipoEstruturaDef) => arq.nome === arquetipo.arquetipoOficial,\n    ) as ArquetipoEstruturaDef | undefined;\n    if (!arquetipoOficial) {\n      erros.push(\n        `Arqu√©tipo oficial '${arquetipo.arquetipoOficial}' n√£o encontrado. Use: ${ARQUETIPOS.map((a) => (a as unknown as ArquetipoEstruturaDef).nome).join(', ')}`,\n      );\n    }\n  }\n\n  if (!arquetipo.estruturaPersonalizada) {\n    erros.push('Estrutura personalizada √© obrigat√≥ria');\n  } else {\n    if (!Array.isArray(arquetipo.estruturaPersonalizada.diretorios)) {\n      erros.push('Diret√≥rios devem ser um array');\n    }\n    if (!Array.isArray(arquetipo.estruturaPersonalizada.arquivosChave)) {\n      erros.push('Arquivos-chave devem ser um array');\n    }\n  }\n\n  return {\n    valido: erros.length === 0,\n    erros,\n  };\n}\n\n/**\n * Lista todos os arqu√©tipos oficiais dispon√≠veis\n */\n\nexport function listarArquetiposOficiais(): ArquetipoEstruturaDef[] {\n  return ARQUETIPOS;\n}\n\n/**\n * Integra arqu√©tipo personalizado com oficial para sugest√µes\n */\n\nexport function integrarArquetipos(\n  personalizado: ArquetipoPersonalizado,\n  oficial: ArquetipoEstruturaDef,\n): ArquetipoEstruturaDef {\n  return {\n    ...oficial,\n    nome: personalizado.nome,\n    descricao: personalizado.descricao || oficial.descricao,\n    requiredDirs: personalizado.estruturaPersonalizada.diretorios,\n    optionalDirs: oficial.optionalDirs,\n    rootFilesAllowed: personalizado.estruturaPersonalizada.arquivosChave,\n    // Mant√©m outras propriedades do oficial como base\n    forbiddenDirs: oficial.forbiddenDirs,\n    dependencyHints: oficial.dependencyHints,\n    filePresencePatterns: oficial.filePresencePatterns,\n    pesoBase: oficial.pesoBase,\n  };\n}\n"]}