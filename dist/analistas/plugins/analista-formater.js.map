{"version":3,"file":"analista-formater.js","sourceRoot":"","sources":["../../../src/analistas/plugins/analista-formater.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport {\n  AnalystOrigins,\n  AnalystTypes,\n  FormatadorMessages,\n  SeverityLevels,\n} from '@core/messages/core/plugin-messages.js';\nimport { formatarPrettierMinimo } from '@shared/impar/formater.js';\n\nimport { criarAnalista, criarOcorrencia } from '@';\n\nconst disableEnv = process.env.ORACULO_DISABLE_PLUGIN_FORMATADOR === '1';\n\ntype Msg = ReturnType<typeof criarOcorrencia>;\n\nfunction msg(\n  message: string,\n  relPath: string,\n  nivel: (typeof SeverityLevels)[keyof typeof SeverityLevels] = SeverityLevels.warning,\n  line = 1,\n): Msg {\n  return criarOcorrencia({\n    relPath,\n    mensagem: message,\n    linha: line,\n    nivel,\n    origem: AnalystOrigins.formatador,\n    tipo: AnalystTypes.formatador,\n  });\n}\n\nfunction normalizarEol(code: string): string {\n  return code.replace(/\\r\\n?/g, '\\n');\n}\n\nfunction primeiraLinhaDiferente(a: string, b: string): number {\n  const aLines = normalizarEol(a).split('\\n');\n  const bLines = normalizarEol(b).split('\\n');\n  const len = Math.max(aLines.length, bLines.length);\n  for (let i = 0; i < len; i++) {\n    if ((aLines[i] ?? '') !== (bLines[i] ?? '')) return i + 1;\n  }\n  return 1;\n}\n\nexport const analistaFormatador = criarAnalista({\n  nome: 'analista-formatador',\n  categoria: 'formatacao',\n  descricao:\n    'Verifica formatação mínima interna do Oráculo (JSON/Markdown/YAML).',\n  global: false,\n  test: (relPath: string): boolean =>\n    /\\.(json|md|markdown|ya?ml)$/i.test(relPath),\n  aplicar: async (src, relPath): Promise<Msg[] | null> => {\n    if (disableEnv) return null;\n\n    const res = formatarPrettierMinimo({ code: src, relPath });\n\n    if (!res.ok) {\n      return [\n        msg(\n          FormatadorMessages.parseErro(res.parser, res.error),\n          relPath,\n          SeverityLevels.error,\n          1,\n        ),\n      ];\n    }\n\n    if (!res.changed) return null;\n\n    const linha = primeiraLinhaDiferente(src, res.formatted);\n    const detalhes = [\n      `primeira diferença na linha ${linha}`,\n      res.reason ? `motivo: ${res.reason}` : null,\n    ]\n      .filter(Boolean)\n      .join(', ');\n\n    // Manter como aviso (alinha com intenção de \"check\" sem mutação)\n    return [\n      msg(\n        FormatadorMessages.naoFormatado(res.parser, detalhes || undefined),\n        relPath,\n        SeverityLevels.warning,\n        linha,\n      ),\n    ];\n  },\n});\n\nexport default analistaFormatador;\n"]}