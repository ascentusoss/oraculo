{"version":3,"file":"detector-markdown.js","sourceRoot":"","sources":["../../../src/analistas/plugins/detector-markdown.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n/**\n * @fileoverview Detector de problemas em arquivos Markdown\n *\n * Verifica compliance de licenças, proveniência e referências em documentação.\n * Migrado de: scripts/scan-markdown.mjs\n * Data: 2025-11-02\n *\n * Funcionalidades:\n * - Detecta licenças incompatíveis (GPL, AGPL, CC-BY, etc)\n * - Verifica presença de aviso de proveniência\n * - Identifica referências de risco (Stack Overflow, cessão de direitos)\n * - Whitelist configurável para documentos de política\n */\n\nimport { promises as fs } from 'node:fs';\n\nimport { config } from '@core/config/config.js';\nimport { log } from '@core/messages/index.js';\n\nimport type { Ocorrencia } from '@';\n\nimport type {\n  MarkdownAnaliseArquivo,\n  MarkdownDetectorOptions,\n  MarkdownLicensePatterns,\n  MarkdownProblema,\n  MarkdownWhitelistConfig,\n} from '../../types/analistas/markdown.js';\n\n/**\n * Padrões de licenças e cessões problemáticas\n */\nconst LICENSE_PATTERNS: MarkdownLicensePatterns = {\n  incompativeis: [\n    /\\bGPL\\b/i,\n    /\\bAGPL\\b/i,\n    /\\bLGPL\\b/i,\n    /Creative\\s+Commons/i,\n    /\\bCC-BY\\b/i,\n    /All\\s+rights\\s+reserved/i,\n  ],\n  cessaoDireitos: [\n    /cess(?:ã|a)o\\s+de\\s+direitos/i,\n    /transfer(?:ê|e)ncia\\s+de\\s+direitos/i,\n  ],\n  referenciasRisco: [\n    /Stack\\s*Overflow/i,\n    /stackoverflow\\.com/i,\n    /\\bassign\\b/i,\n    /\\bcession\\b/i,\n  ],\n};\n\n/**\n * Whitelist padrão de arquivos\n */\nconst DEFAULT_WHITELIST: MarkdownWhitelistConfig = {\n  paths: [\n    '.github/copilot-instructions.md',\n    'docs/POLICY-PROVENIENCIA.md',\n    'docs/partials/AVISO-PROVENIENCIA.md',\n  ],\n  patterns: ['**/relatorios/**', 'docs/historico/**', 'tests/**', 'tmp*.md'],\n  dirs: [\n    'pre-public',\n    'preview-oraculo',\n    '.abandonados',\n    '.deprecados',\n    'relatorios',\n  ],\n};\n\n/**\n * Cria regex combinado de todos os padrões de risco\n */\nfunction createRiskRegex(): RegExp {\n  const allPatterns = [\n    ...LICENSE_PATTERNS.incompativeis,\n    ...LICENSE_PATTERNS.cessaoDireitos,\n    ...LICENSE_PATTERNS.referenciasRisco,\n  ]\n    .map((r) => r.source)\n    .join('|');\n\n  return new RegExp(allPatterns, 'i');\n}\n\n/**\n * Verifica se arquivo tem aviso de proveniência\n */\nfunction hasProvenienciaHeader(content: string, headerLines = 30): boolean {\n  const head = content.split(/\\r?\\n/).slice(0, headerLines).join('\\n');\n  return /Proveni[eê]ncia\\s+e\\s+Autoria/i.test(head);\n}\n\n/**\n * Verifica se arquivo está na whitelist\n */\nfunction isWhitelisted(\n  relPath: string,\n  whitelist: MarkdownWhitelistConfig,\n): boolean {\n  const normalized = relPath.replace(/\\\\/g, '/');\n\n  // Paths exatos\n  if (\n    whitelist.paths.some(\n      (p: string) => normalized === p || normalized.endsWith(`/${p}`),\n    )\n  ) {\n    return true;\n  }\n\n  // Diretórios\n  if (whitelist.dirs.some((dir: string) => normalized.startsWith(`${dir}/`))) {\n    return true;\n  }\n\n  // Patterns (simplificado - sem glob completo)\n  for (const pattern of whitelist.patterns) {\n    if (pattern.includes('**')) {\n      const parts = pattern.split('**');\n      if (\n        parts.every((part: string) =>\n          normalized.includes(part.replace(/\\*/g, '')),\n        )\n      ) {\n        return true;\n      }\n    } else if (pattern.startsWith('*')) {\n      if (normalized.endsWith(pattern.substring(1))) {\n        return true;\n      }\n    } else if (pattern.includes('*')) {\n      const [prefix, suffix] = pattern.split('*');\n      if (normalized.startsWith(prefix) && normalized.endsWith(suffix)) {\n        return true;\n      }\n    }\n  }\n\n  return false;\n}\n\n/**\n * Verifica se tem marcador de risco aprovado\n */\nfunction hasRiskReferenceMarker(content: string): boolean {\n  return /<!--\\s*RISCO_REFERENCIA_OK\\s*-->/i.test(content);\n}\n\nfunction hasOraculoIgnoreMarker(content: string, key: string): boolean {\n  // Ex.: <!-- oraculo-ignore: license-check -->\n  const escaped = key.replace(/[.*+?^${}()|[\\]\\\\]/g, '\\\\$&');\n  return new RegExp(\n    `<!--\\\\s*oraculo-ignore\\\\s*:\\\\s*${escaped}\\\\s*-->`,\n    'i',\n  ).test(content);\n}\n\nfunction mergeWhitelist(\n  base: MarkdownWhitelistConfig,\n  override: Partial<MarkdownWhitelistConfig> | undefined,\n  mode: 'merge' | 'replace',\n): MarkdownWhitelistConfig {\n  const o = override || {};\n  if (mode === 'replace') {\n    return {\n      paths: Array.isArray(o.paths) ? o.paths : [],\n      patterns: Array.isArray(o.patterns) ? o.patterns : [],\n      dirs: Array.isArray(o.dirs) ? o.dirs : [],\n    };\n  }\n\n  const uniq = (arr: string[]) => Array.from(new Set(arr.map(String)));\n  const opaths = Array.isArray(o.paths) ? o.paths : [];\n  const opatterns = Array.isArray(o.patterns) ? o.patterns : [];\n  const odirs = Array.isArray(o.dirs) ? o.dirs : [];\n  return {\n    paths: uniq([...(base.paths || []), ...opaths]),\n    patterns: uniq([...(base.patterns || []), ...opatterns]),\n    dirs: uniq([...(base.dirs || []), ...odirs]),\n  };\n}\n\n/**\n * Verifica se o único termo de risco é do aviso de proveniência\n */\nfunction isBenignProvenienciaOnly(content: string): boolean {\n  const rxCessao = /cess(?:ã|a)o\\s+de\\s+direitos/i;\n  const rxOthers = new RegExp(\n    [\n      '\\\\bGPL\\\\b',\n      '\\\\bAGPL\\\\b',\n      '\\\\bLGPL\\\\b',\n      'Creative\\\\s+Commons',\n      '\\\\bCC-BY\\\\b',\n      'Stack\\\\s*Overflow',\n      'stackoverflow\\\\.com',\n      'All\\\\s+rights\\\\s+reserved',\n      'transfer(?:ê|e)ncia\\\\s+de\\\\s+direitos',\n      '\\\\bassign\\\\b',\n      '\\\\bcession\\\\b',\n    ].join('|'),\n    'i',\n  );\n\n  const hasCessao = rxCessao.test(content);\n  const hasOthers = rxOthers.test(content);\n  const hasAviso = /Proveni[eê]ncia\\s+e\\s+Autoria/i.test(content);\n\n  return hasAviso && hasCessao && !hasOthers;\n}\n\n/**\n * Analisa um arquivo Markdown\n */\nasync function analisarArquivoMarkdown(\n  fullPath: string,\n  relPath: string,\n  options: MarkdownDetectorOptions,\n): Promise<MarkdownAnaliseArquivo> {\n  const whitelist = options.whitelist || DEFAULT_WHITELIST;\n  const problemas: MarkdownProblema[] = [];\n\n  let content: string;\n  try {\n    content = await fs.readFile(fullPath, 'utf-8');\n  } catch (error) {\n    return {\n      relPath,\n      fullPath,\n      problemas: [\n        {\n          tipo: 'formato-invalido',\n          descricao: `Erro ao ler arquivo: ${(error as Error).message}`,\n          severidade: 'medio',\n        },\n      ],\n      temProveniencia: false,\n      whitelisted: false,\n      temRiscoOk: false,\n    };\n  }\n\n  const whitelisted = isWhitelisted(relPath, whitelist);\n  const temRiscoOk = hasRiskReferenceMarker(content);\n  const temProveniencia = hasProvenienciaHeader(\n    content,\n    options.headerLines || 30,\n  );\n  const ignoreLicenseCheck = hasOraculoIgnoreMarker(content, 'license-check');\n\n  // Verificar proveniência\n  if (options.checkProveniencia !== false && !temProveniencia && !whitelisted) {\n    problemas.push({\n      tipo: 'falta-proveniencia',\n      descricao:\n        'Arquivo não possui aviso de Proveniência e Autoria nas primeiras linhas',\n      severidade: 'alto',\n      sugestao: 'Adicione o aviso usando scripts/add-disclaimer-md.js',\n    });\n  }\n\n  // Verificar licenças e referências\n  if (options.checkLicenses !== false || options.checkReferences !== false) {\n    const riskRegex = createRiskRegex();\n    const hasRisk = riskRegex.test(content);\n\n    if (\n      hasRisk &&\n      !isBenignProvenienciaOnly(content) &&\n      !whitelisted &&\n      !temRiscoOk\n    ) {\n      // Identificar problemas específicos\n      const lines = content.split(/\\r?\\n/);\n\n      for (let i = 0; i < lines.length; i++) {\n        const line = lines[i];\n\n        // Verificar licenças incompatíveis\n        if (options.checkLicenses !== false && !ignoreLicenseCheck) {\n          for (const pattern of LICENSE_PATTERNS.incompativeis) {\n            if (pattern.test(line)) {\n              problemas.push({\n                tipo: 'licenca-incompativel',\n                descricao: `Licença potencialmente incompatível: ${pattern.source}`,\n                severidade: 'critico',\n                linha: i + 1,\n                trecho: line.trim().substring(0, 100),\n                sugestao:\n                  'Verifique compatibilidade com licença MIT do projeto',\n              });\n            }\n          }\n        }\n\n        // Verificar cessão de direitos\n        if (options.checkReferences !== false) {\n          for (const pattern of LICENSE_PATTERNS.cessaoDireitos) {\n            if (pattern.test(line)) {\n              problemas.push({\n                tipo: 'referencia-risco',\n                descricao: 'Referência a cessão de direitos detectada',\n                severidade: 'alto',\n                linha: i + 1,\n                trecho: line.trim().substring(0, 100),\n                sugestao: 'Verifique se não há implicações legais',\n              });\n            }\n          }\n\n          // Verificar referências externas\n          for (const pattern of LICENSE_PATTERNS.referenciasRisco) {\n            if (pattern.test(line)) {\n              problemas.push({\n                tipo: 'referencia-risco',\n                descricao: `Referência externa detectada: ${pattern.source}`,\n                severidade: 'medio',\n                linha: i + 1,\n                trecho: line.trim().substring(0, 100),\n                sugestao:\n                  'Adicione marcador <!-- RISCO_REFERENCIA_OK --> se referência for válida',\n              });\n            }\n          }\n        }\n      }\n    }\n  }\n\n  return {\n    relPath,\n    fullPath,\n    problemas,\n    temProveniencia,\n    whitelisted,\n    temRiscoOk,\n  };\n}\n\n/**\n * Converte análise para ocorrências do Oráculo\n */\nfunction converterParaOcorrencias(\n  analise: MarkdownAnaliseArquivo,\n): Ocorrencia[] {\n  const ocorrencias: Ocorrencia[] = [];\n\n  for (const problema of analise.problemas) {\n    let nivel: 'erro' | 'aviso' | 'info';\n    switch (problema.severidade) {\n      case 'critico':\n      case 'alto':\n        nivel = 'erro';\n        break;\n      case 'medio':\n        nivel = 'aviso';\n        break;\n      default:\n        nivel = 'info';\n    }\n\n    ocorrencias.push({\n      tipo: `markdown-${problema.tipo}`,\n      nivel,\n      mensagem: problema.descricao,\n      relPath: analise.relPath,\n      linha: problema.linha,\n      contexto: problema.trecho,\n      sugestao: problema.sugestao,\n    });\n  }\n\n  return ocorrencias;\n}\n\n/**\n * Detector de problemas em Markdown\n */\nexport const detectorMarkdown = {\n  nome: 'detector-markdown',\n  categoria: 'documentacao',\n  descricao: 'Detecta problemas de compliance em arquivos Markdown',\n\n  test: (relPath: string): boolean => {\n    return relPath.toLowerCase().endsWith('.md');\n  },\n\n  aplicar: async (\n    src: string,\n    relPath: string,\n    _ast: unknown,\n    fullPath?: string,\n  ): Promise<Ocorrencia[]> => {\n    if (!fullPath) {\n      log.aviso(`detector-markdown: fullPath não fornecido para ${relPath}`);\n      return [];\n    }\n\n    const cfg = (config as unknown as { detectorMarkdown?: unknown })\n      .detectorMarkdown as\n      | {\n          checkProveniencia?: boolean;\n          checkLicenses?: boolean;\n          checkReferences?: boolean;\n          headerLines?: number;\n          whitelist?: Partial<MarkdownWhitelistConfig>;\n          whitelistMode?: 'merge' | 'replace';\n        }\n      | undefined;\n\n    const whitelistMode: 'merge' | 'replace' =\n      cfg?.whitelistMode === 'replace' || cfg?.whitelistMode === 'merge'\n        ? cfg.whitelistMode\n        : 'merge';\n\n    const options: MarkdownDetectorOptions = {\n      checkProveniencia: cfg?.checkProveniencia ?? true,\n      checkLicenses: cfg?.checkLicenses ?? true,\n      checkReferences: cfg?.checkReferences ?? true,\n      headerLines: typeof cfg?.headerLines === 'number' ? cfg.headerLines : 30,\n      whitelist: mergeWhitelist(\n        DEFAULT_WHITELIST,\n        cfg?.whitelist,\n        whitelistMode,\n      ),\n    };\n\n    try {\n      const analise = await analisarArquivoMarkdown(fullPath, relPath, options);\n      return converterParaOcorrencias(analise);\n    } catch (error) {\n      log.erro(\n        `Erro ao analisar Markdown ${relPath}: ${(error as Error).message}`,\n      );\n      return [];\n    }\n  },\n};\n\n/**\n * Exporta função de análise standalone para uso em outros módulos\n */\nexport { analisarArquivoMarkdown };\n"]}