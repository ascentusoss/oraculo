{"version":3,"file":"analista-quick-fixes.js","sourceRoot":"","sources":["../../../src/analistas/corrections/analista-quick-fixes.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport type { NodePath } from '@babel/traverse';\nimport type { Node } from '@babel/types';\nimport {\n  findQuickFixes,\n  type PatternBasedQuickFix,\n} from '@core/config/auto/fix-config.js';\n\nimport type { Analista, Ocorrencia } from '@';\nimport { criarOcorrencia } from '@';\n\nexport const analistaQuickFixes: Analista = {\n  nome: 'quick-fixes',\n  categoria: 'melhorias',\n  descricao: 'Detecta problemas comuns e oferece corre√ß√µes autom√°ticas',\n\n  test: (relPath: string): boolean => {\n    return /\\.(js|jsx|ts|tsx|mjs|cjs|svg)$/.test(relPath);\n  },\n\n  aplicar: (\n    src: string,\n    relPath: string,\n    _ast: NodePath<Node> | null,\n  ): Ocorrencia[] => {\n    if (!src) return [];\n\n    const ocorrencias: Ocorrencia[] = [];\n\n    // Buscar quick fixes gerais\n    const quickFixes = findQuickFixes(src, undefined, undefined, relPath);\n\n    // Buscar quick fixes espec√≠ficos por tipo de problema detectado\n    const problemaTypes = [\n      'unhandled-async',\n      'console-log',\n      'memory-leak',\n      'dangerous-html',\n      'eval-usage',\n      'complex-regex',\n    ];\n\n    for (const problemType of problemaTypes) {\n      const specificFixes = findQuickFixes(\n        src,\n        problemType,\n        undefined,\n        relPath,\n      );\n      quickFixes.push(...specificFixes);\n    }\n\n    // Remover duplicatas por ID\n    const uniqueFixes = quickFixes.filter(\n      (fix, index, arr) => arr.findIndex((f) => f.id === fix.id) === index,\n    );\n\n    for (const fixResult of uniqueFixes) {\n      for (const match of fixResult.matches) {\n        // Calcular linha aproximada do match\n        const beforeMatch = src.substring(0, match.index || 0);\n        const linha = beforeMatch.split('\\n').length;\n\n        // Gerar preview da corre√ß√£o\n        const previewFix = fixResult.fix(match, src);\n        const originalLine = src.split('\\n')[linha - 1] || '';\n        const fixedLine = previewFix.split('\\n')[linha - 1] || '';\n\n        // Criar sugest√£o com preview mais detalhado\n        const sugestao = [\n          fixResult.description,\n          '',\n          `üîß Corre√ß√£o sugerida:`,\n          `‚ùå Antes: ${originalLine.trim()}`,\n          `‚úÖ Depois: ${fixedLine.trim()}`,\n          '',\n          `Confian√ßa: ${fixResult.confidence}%`,\n          `Categoria: ${fixResult.category}`,\n          `ID do Fix: ${fixResult.id}`,\n        ].join('\\n');\n\n        // Mapear categoria para n√≠vel\n        const nivel = mapearCategoriaNivel(fixResult.category);\n\n        // Criar ocorr√™ncia base\n        const ocorrencia = criarOcorrencia({\n          tipo: 'auto-fix-disponivel',\n          nivel,\n          mensagem: `${fixResult.title}`,\n          relPath,\n          linha,\n        });\n\n        // Adicionar campos extras como propriedades do objeto gen√©rico\n        const ocorrenciaGenerica = ocorrencia as Ocorrencia & {\n          sugestao?: string;\n          quickFixId?: string;\n          confidence?: number;\n          category?: string;\n          matchIndex?: number;\n          matchLength?: number;\n        }; // OcorrenciaGenerica allows extra properties\n        ocorrenciaGenerica.sugestao = sugestao;\n        ocorrenciaGenerica.quickFixId = fixResult.id;\n        ocorrenciaGenerica.confidence = fixResult.confidence;\n        ocorrenciaGenerica.category = fixResult.category;\n        ocorrenciaGenerica.matchIndex = match.index;\n        ocorrenciaGenerica.matchLength = match[0].length;\n\n        ocorrencias.push(ocorrencia);\n      }\n    }\n\n    return ocorrencias;\n  },\n};\n\nfunction mapearCategoriaNivel(\n  category: PatternBasedQuickFix['category'],\n): 'info' | 'aviso' | 'erro' {\n  switch (category) {\n    case 'security':\n      return 'erro';\n    case 'performance':\n      return 'aviso';\n    case 'style':\n    case 'documentation':\n      return 'info';\n    default:\n      return 'info';\n  }\n}\n"]}