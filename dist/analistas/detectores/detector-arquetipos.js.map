{"version":3,"file":"detector-arquetipos.js","sourceRoot":"","sources":["../../../src/analistas/detectores/detector-arquetipos.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n// Nota: manter ARQUETIPOS importado vis√≠vel como lembrete para integra√ß√£o futura\nimport path from 'node:path';\n\nimport { extrairSinaisAvancados } from '@analistas/arquitetos/sinais-projeto-avancados.js';\nimport { ARQUETIPOS } from '@analistas/estrategistas/arquetipos-defs.js';\nimport { OperarioEstrutura } from '@analistas/estrategistas/operario-estrutura.js';\nimport {\n  carregarArquetipoPersonalizado,\n  integrarArquetipos,\n  obterArquetipoOficial,\n} from '@analistas/js-ts/arquetipos-personalizados.js';\nimport { scoreArquetipoAvancado } from '@analistas/pontuadores/pontuador.js';\nimport { config } from '@core/config/config.js';\nimport { lerEstado, salvarEstado } from '@shared/persistence/persistencia.js';\n\nimport type {\n  ArquetipoDrift,\n  ArquetipoEstruturaDef,\n  ArquetipoPersonalizado,\n  ContextoExecucao,\n  PackageJson,\n  ResultadoContexto,\n  ResultadoDeteccaoArquetipo,\n  SinaisProjetoAvancados,\n  SnapshotEstruturaBaseline,\n} from '@';\n\nfunction scoreArquetipo(\n  def: ArquetipoEstruturaDef,\n  arquivos: string[],\n  _sinaisAvancados: SinaisProjetoAvancados,\n): ResultadoDeteccaoArquetipo {\n  // Implementa√ß√£o simplificada tempor√°ria.\n  // Mantemos a assinatura e a forma do retorno para compatibilidade.\n  const matchedRequired: string[] = (def.requiredDirs || []).filter((d) =>\n    arquivos.some((f) => f.startsWith(`${d}/`) || f === d),\n  );\n  const missingRequired: string[] = (def.requiredDirs || []).filter(\n    (d) => !matchedRequired.includes(d),\n  );\n  return {\n    nome: def.nome,\n    score: def.pesoBase ? def.pesoBase * 10 : 10,\n    confidence: 50,\n    matchedRequired,\n    missingRequired,\n    matchedOptional: [],\n    dependencyMatches: [],\n    filePatternMatches: [],\n    forbiddenPresent: [],\n    anomalias: [],\n    sugestaoPadronizacao: '',\n    explicacaoSimilaridade: '',\n    descricao: def.descricao || '',\n    candidatoExtra: undefined,\n  };\n}\n\n// Exposi√ß√£o somente para testes (n√£o altera API p√∫blica)\n// Evita exportar diretamente para n√£o vazar em produ√ß√£o\nif (process.env.VITEST) {\n  type TestExports = Record<string, unknown> & {\n    scoreArquetipo: typeof scoreArquetipo;\n  };\n  const g = globalThis as unknown as { __ORACULO_TESTS__?: TestExports };\n  const prev = g.__ORACULO_TESTS__ ?? ({} as TestExports);\n  g.__ORACULO_TESTS__ = { ...prev, scoreArquetipo };\n}\n\nexport async function detectarArquetipos(\n  contexto: Pick<ContextoExecucao, 'arquivos' | 'baseDir'>,\n  baseDir: string,\n  options?: { quiet?: boolean },\n): Promise<{\n  candidatos: ResultadoDeteccaoArquetipo[];\n  baseline?: SnapshotEstruturaBaseline;\n  drift?: ArquetipoDrift;\n  arquetipoPersonalizado?: ArquetipoPersonalizado | null; // Para compatibilidade futura\n}> {\n  if (!options?.quiet && config.VERBOSE) {\n    console.log(\n      'üîç detectarArquetipos chamado com',\n      contexto.arquivos.length,\n      'arquivos',\n    );\n  }\n  const arquivos = contexto.arquivos.map((f) => f.relPath);\n\n  // Carregar arqu√©tipo personalizado se existir\n  const arquetipoPersonalizado = await carregarArquetipoPersonalizado(baseDir);\n  let arquetiposParaAvaliar = ARQUETIPOS;\n\n  // Se h√° arqu√©tipo personalizado, integr√°-lo com o oficial\n  if (arquetipoPersonalizado) {\n    const arquetipoOficial = obterArquetipoOficial(arquetipoPersonalizado);\n    if (arquetipoOficial) {\n      const arquetipoIntegrado = integrarArquetipos(\n        arquetipoPersonalizado,\n        arquetipoOficial,\n      );\n      // Substituir o oficial pelo personalizado na lista de avalia√ß√£o\n      arquetiposParaAvaliar = ARQUETIPOS.map((arq: ArquetipoEstruturaDef) =>\n        arq.nome === arquetipoPersonalizado.arquetipoOficial\n          ? arquetipoIntegrado\n          : arq,\n      );\n    }\n  }\n\n  // Extrai sinais avan√ßados do projeto\n  let packageJsonParaSinais: PackageJson = {};\n  try {\n    packageJsonParaSinais = (await lerEstado(\n      path.join(baseDir, 'package.json'),\n    )) as PackageJson;\n  } catch {\n    // Package.json n√£o encontrado - usar objeto vazio\n    packageJsonParaSinais = {};\n  }\n\n  const sinaisAvancados = extrairSinaisAvancados(\n    contexto.arquivos,\n    packageJsonParaSinais,\n    undefined,\n    baseDir,\n    arquivos,\n  );\n\n  // Pontua todos os arqu√©tipos dispon√≠veis usando sinais avan√ßados\n  let candidatos: ResultadoDeteccaoArquetipo[] = arquetiposParaAvaliar.map(\n    (def: ArquetipoEstruturaDef) =>\n      scoreArquetipoAvancado(def, arquivos, sinaisAvancados),\n  );\n\n  // üöÄ INTEGRA√á√ÉO SISTEMA INTELIGENTE: Aplicar boost contextual\n  if (!options?.quiet && config.VERBOSE) {\n    console.log('üîç Tentando chamar detector contextual...');\n  }\n  try {\n    const { detectarContextoInteligente } =\n      await import('./detector-contexto-inteligente.js');\n    const estruturaDetectada = arquivos; // Lista de caminhos\n    // Carregar package.json com tratamento de erro adequado\n    let packageJsonContent: PackageJson = {};\n    try {\n      packageJsonContent = (await lerEstado(\n        path.join(baseDir, 'package.json'),\n      )) as PackageJson;\n    } catch {\n      // Package.json n√£o encontrado ou inv√°lido - usar objeto vazio\n      packageJsonContent = {};\n    }\n\n    const resultadosContextuais = detectarContextoInteligente(\n      estruturaDetectada,\n      contexto.arquivos,\n      packageJsonContent,\n      options,\n    ) as ResultadoContexto[];\n\n    // Pegar o resultado com maior confian√ßa\n    const melhorDeteccao = resultadosContextuais.reduce(\n      (melhor: ResultadoContexto, atual: ResultadoContexto) =>\n        atual.confiancaTotal > melhor.confiancaTotal ? atual : melhor,\n      { confiancaTotal: 0 },\n    );\n\n    if (melhorDeteccao && melhorDeteccao.confiancaTotal > 0.6) {\n      // Escala 0-1, n√£o 0-100\n      // Mapear tecnologias detectadas para arqu√©tipos conhecidos\n      const mapeamentoTecnologia: Record<string, string[]> = {\n        'discord-bot': ['bot-discord', 'bot', 'discord-bot'],\n        'telegram-bot': ['bot-telegram', 'bot', 'telegram-bot'],\n        'express-api': ['api-rest-express', 'api-rest', 'express-api'],\n        'fastify-api': ['api-rest-fastify', 'api-rest', 'fastify-api'],\n        'nestjs-api': ['api-rest-nestjs', 'api-rest', 'nestjs-api'],\n        'cli-modular': ['cli-modular', 'cli', 'cli-tool'],\n        'electron-app': ['electron-app', 'electron', 'desktop-app'],\n        'nextjs-app': ['nextjs-app', 'nextjs', 'fullstack'],\n        'react-spa': ['react-spa', 'react', 'spa'],\n      };\n\n      const tecnologiaDetectada = melhorDeteccao.tecnologia ?? 'desconhecido';\n      const arquetiposCandidatos: string[] =\n        mapeamentoTecnologia[tecnologiaDetectada] || [];\n\n      // Aplicar boost de confian√ßa para arqu√©tipos relacionados\n      let boostAplicado = false;\n      candidatos = candidatos.map((candidato: ResultadoDeteccaoArquetipo) => {\n        if (\n          arquetiposCandidatos.some(\n            (arq: string) =>\n              candidato.nome.includes(arq) || arq.includes(candidato.nome),\n          )\n        ) {\n          const boostConfianca = Math.min(\n            melhorDeteccao.confiancaTotal * 100 * 0.8,\n            60,\n          ); // Boost agressivo at√© 60%\n          boostAplicado = true;\n          return {\n            ...candidato,\n            confidence: Math.max(candidato.confidence + boostConfianca, 70), // M√≠nimo 70% se detectado\n            explicacaoSimilaridade: `[Boost contextual: ${melhorDeteccao.tecnologia} detectado com ${(melhorDeteccao.confiancaTotal * 100).toFixed(0)}% confian√ßa] ${candidato.explicacaoSimilaridade || ''}`,\n          };\n        }\n        return candidato;\n      });\n\n      // Se n√£o encontrou arqu√©tipo compat√≠vel, criar um virtual baseado na detec√ß√£o\n      if (!boostAplicado) {\n        const arquetipoVirtual: ResultadoDeteccaoArquetipo = {\n          nome: tecnologiaDetectada,\n          score: Math.round(melhorDeteccao.confiancaTotal * 100),\n          confidence: Math.round(melhorDeteccao.confiancaTotal * 100),\n          matchedRequired: [],\n          missingRequired: [],\n          matchedOptional: [],\n          dependencyMatches: (melhorDeteccao.evidencias || [])\n            .filter((e) => e.tipo === 'dependencia')\n            .map((e) => e.valor),\n          filePatternMatches: (melhorDeteccao.evidencias || [])\n            .filter((e) => e.tipo === 'estrutura')\n            .map((e) => e.valor),\n          forbiddenPresent: [],\n          anomalias: [],\n          sugestaoPadronizacao: (melhorDeteccao.sugestoesMelhoria || []).join(\n            '; ',\n          ),\n          explicacaoSimilaridade: `Detectado via sistema inteligente contextual com ${(melhorDeteccao.confiancaTotal * 100).toFixed(0)}% confian√ßa`,\n          descricao: `Projeto ${melhorDeteccao.tecnologia} identificado por an√°lise contextual`,\n        };\n        candidatos.unshift(arquetipoVirtual); // Adiciona no in√≠cio\n      }\n    }\n  } catch (error) {\n    // Falha silenciosa - sistema inteligente √© opcional\n    if (process.env.NODE_ENV !== 'production') {\n      console.debug('Sistema inteligente n√£o dispon√≠vel:', error);\n    }\n  }\n\n  // Ordena por confian√ßa/score decrescente\n  candidatos.sort(\n    (a: ResultadoDeteccaoArquetipo, b: ResultadoDeteccaoArquetipo) =>\n      b.confidence - a.confidence || b.score - a.score,\n  );\n\n  // Decis√£o final: dominante, misto ou desconhecido\n  // Agora considera fatores contextuais e thresholds adaptativos\n  const scoresValidos = candidatos.filter((c) => c.confidence >= 30);\n\n  if (!scoresValidos.length) {\n    // Nenhum padr√£o relevante - verificar se √© um projeto muito pequeno ou n√£o estruturado\n    const temAlgumaEstrutura = arquivos.some(\n      (f) =>\n        f.includes('src/') ||\n        f.includes('lib/') ||\n        f.includes('app/') ||\n        f.includes('packages/'),\n    );\n\n    candidatos = [\n      {\n        nome: 'desconhecido',\n        score: 0,\n        confidence: temAlgumaEstrutura ? 10 : 0, // pequena confian√ßa se h√° alguma estrutura\n        matchedRequired: [],\n        missingRequired: [],\n        matchedOptional: [],\n        dependencyMatches: [],\n        filePatternMatches: [],\n        forbiddenPresent: [],\n        anomalias: [],\n        sugestaoPadronizacao: temAlgumaEstrutura\n          ? 'Projeto tem alguma estrutura, mas n√£o corresponde a arqu√©tipos conhecidos. Considere organizar em src/, lib/ ou app/.'\n          : 'Projeto sem estrutura clara detectada. Considere criar uma organiza√ß√£o b√°sica.',\n        explicacaoSimilaridade: temAlgumaEstrutura\n          ? 'Estrutura parcial detectada, mas n√£o suficiente para classifica√ß√£o.'\n          : 'Nenhum arqu√©tipo identificado.',\n        descricao: 'Nenhum arqu√©tipo identificado.',\n      },\n    ];\n  } else {\n    // An√°lise mais sofisticada para decidir entre dominante e misto\n    const top = scoresValidos[0];\n    const proximos = scoresValidos.filter(\n      (c) => c !== top && Math.abs(c.confidence - top.confidence) <= 15, // threshold aumentado\n    );\n\n    // Verificar se √© realmente um caso h√≠brido ou apenas competi√ß√£o pr√≥xima\n    const ehHibridoReal = proximos.some(\n      (c) =>\n        // Verificar se h√° sobreposi√ß√£o significativa de caracter√≠sticas\n        c.matchedRequired.some((req) => top.matchedRequired.includes(req)) ||\n        c.dependencyMatches.some((dep) => top.dependencyMatches.includes(dep)),\n    );\n\n    if (proximos.length > 0 && ehHibridoReal) {\n      // Sistema de pontua√ß√£o para casos h√≠bridos\n      const scoreHibrido =\n        top.score * 0.7 +\n        proximos.reduce(\n          (acc: number, c: ResultadoDeteccaoArquetipo) =>\n            acc + (c.score * 0.3) / proximos.length,\n          0,\n        );\n      const confidenceHibrido = Math.max(top.confidence - 10, 40); // reduzir confian√ßa mas manter m√≠nimo\n\n      candidatos = [\n        {\n          nome: 'misto',\n          score: Math.round(scoreHibrido),\n          confidence: confidenceHibrido,\n          matchedRequired: [],\n          missingRequired: [],\n          matchedOptional: [],\n          dependencyMatches: [],\n          filePatternMatches: [],\n          forbiddenPresent: [],\n          anomalias: [],\n          sugestaoPadronizacao: '',\n          explicacaoSimilaridade: `Estrutura h√≠brida detectada: combina elementos de ${[top.nome, ...proximos.map((p) => p.nome)].join(', ')}. Recomenda-se avaliar se a separa√ß√£o em projetos distintos seria ben√©fica.`,\n          descricao: 'Estrutura h√≠brida',\n        },\n      ];\n    } else {\n      // Dominante claro\n      candidatos = [top];\n    }\n  }\n  const baselinePath = path.join(\n    baseDir,\n    '.oraculo',\n    'baseline-estrutura.json',\n  );\n  let baseline: SnapshotEstruturaBaseline | undefined;\n  const existente = await lerEstado<SnapshotEstruturaBaseline | []>(\n    baselinePath,\n  );\n  if (\n    existente &&\n    !Array.isArray(existente) &&\n    typeof existente === 'object' &&\n    'arquetipo' in existente\n  ) {\n    baseline = existente as SnapshotEstruturaBaseline;\n  }\n  if (!baseline && candidatos[0]) {\n    baseline = {\n      version: 1,\n      timestamp: new Date().toISOString(),\n      arquetipo: candidatos[0].nome,\n      confidence: candidatos[0].confidence,\n      arquivosRaiz: arquivos.filter((p) => !p.includes('/')).sort(),\n    };\n    await salvarEstado(baselinePath, baseline);\n  }\n  // Prioriza baseline apenas se o candidato principal for 'desconhecido' ou confian√ßa baixa\n  if (baseline && baseline.arquetipo !== 'desconhecido') {\n    const arquivosRaizAtuais = arquivos.filter((p) => !p.includes('/'));\n    const setBase = new Set(baseline.arquivosRaiz || []);\n    const temIntersecao = arquivosRaizAtuais.some((f) => setBase.has(f));\n    const candidatoTop = candidatos[0];\n    if (\n      temIntersecao &&\n      (candidatoTop.nome === 'desconhecido' || candidatoTop.confidence < 50)\n    ) {\n      const melhorBaseline: ResultadoDeteccaoArquetipo = {\n        nome: baseline.arquetipo,\n        score: 999, // for√ßa topo da lista\n        confidence: baseline.confidence,\n        matchedRequired: [],\n        missingRequired: [],\n        matchedOptional: [],\n        dependencyMatches: [],\n        filePatternMatches: [],\n        forbiddenPresent: [],\n        anomalias: [],\n        sugestaoPadronizacao: '',\n        explicacaoSimilaridade:\n          'Detectado via baseline existente (.oraculo/baseline-estrutura.json).',\n        descricao: 'Arqu√©tipo determinado pelo baseline',\n      };\n      candidatos = [\n        melhorBaseline,\n        ...candidatos.filter(\n          (c: ResultadoDeteccaoArquetipo) => c.nome !== baseline.arquetipo,\n        ),\n      ];\n    }\n  }\n  let drift: ArquetipoDrift | undefined;\n  if (baseline && candidatos[0]) {\n    const atual = candidatos[0];\n    const arquivosRaizAtuais = arquivos.filter((p) => !p.includes('/')).sort();\n    const setBase = new Set(baseline.arquivosRaiz);\n    const setAtual = new Set(arquivosRaizAtuais);\n    const novos: string[] = [];\n    const removidos: string[] = [];\n    for (const f of setAtual) if (!setBase.has(f)) novos.push(f as string);\n    for (const f of setBase) if (!setAtual.has(f)) removidos.push(f as string);\n    drift = {\n      alterouArquetipo: baseline.arquetipo !== atual.nome,\n      anterior: baseline.arquetipo,\n      atual: atual.nome,\n      deltaConfidence: atual.confidence - baseline.confidence,\n      arquivosRaizNovos: novos,\n      arquivosRaizRemovidos: removidos,\n    };\n  }\n  // Sugest√£o de plano para o candidato top\n  if (candidatos[0]) {\n    try {\n      // Usa plano de arqu√©tipos se preset for diferente de 'oraculo' ou em ambiente de teste\n      const preset = (contexto as { preset?: string }).preset ?? 'oraculo';\n      const emTeste = !!process.env.VITEST;\n      const preferEstrategista = preset === 'oraculo' && !emTeste;\n      const { plano } = await OperarioEstrutura.planejar(\n        baseDir,\n        contexto.arquivos,\n        {\n          preferEstrategista,\n          preset,\n        },\n      );\n      if (plano) candidatos[0].planoSugestao = plano;\n    } catch {\n      // mant√©m default vazio se falhar\n    }\n  }\n  return {\n    candidatos,\n    baseline,\n    drift,\n    arquetipoPersonalizado,\n  };\n}\n"]}