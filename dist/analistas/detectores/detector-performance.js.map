{"version":3,"file":"detector-performance.js","sourceRoot":"","sources":["../../../src/analistas/detectores/detector-performance.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport type { NodePath } from '@babel/traverse';\nimport type { CallExpression, ForStatement, Node } from '@babel/types';\nimport { traverse } from '@core/config/traverse.js';\nimport { DetectorAgregadosMessages } from '@core/messages/analistas/detector-agregados-messages.js';\nimport { detectarContextoProjeto } from '@shared/contexto-projeto.js';\nimport { filtrarOcorrenciasSuprimidas } from '@shared/helpers/suppressao.js';\n\nimport type { Analista, Ocorrencia, ProblemaPerformance } from '@';\nimport { criarOcorrencia } from '@';\n\nexport const analistaPerformance: Analista = {\n  nome: 'performance',\n  categoria: 'performance',\n  descricao: 'Detecta problemas de performance e otimizações possíveis',\n\n  test: (relPath: string): boolean => {\n    return /\\.(js|jsx|ts|tsx|mjs|cjs)$/.test(relPath);\n  },\n\n  aplicar: (\n    src: string,\n    relPath: string,\n    ast: NodePath<Node> | null,\n  ): Ocorrencia[] => {\n    if (!src) return [];\n\n    const contextoArquivo = detectarContextoProjeto({\n      arquivo: relPath,\n      conteudo: src,\n      relPath,\n    });\n\n    const problemas: ProblemaPerformance[] = [];\n\n    try {\n      // Detectar problemas por padrões de texto\n      detectarPadroesPerformance(src, problemas, relPath);\n\n      // Detectar problemas via AST quando disponível\n      if (ast) {\n        detectarProblemasPerformanceAST(ast, problemas, relPath);\n      }\n\n      // Converter para ocorrências\n      const ocorrencias: Ocorrencia[] = [];\n\n      // Agrupar por impacto\n      const porImpacto = agruparPorImpacto(problemas);\n\n      for (const [impacto, items] of Object.entries(porImpacto)) {\n        if (items.length > 0) {\n          const nivel = mapearImpactoParaNivel(\n            impacto as ProblemaPerformance['impacto'],\n          );\n\n          // Ser menos rigoroso com testes\n          const nivelAjustado =\n            contextoArquivo.isTest && nivel === 'aviso' ? 'info' : nivel;\n\n          const resumo = items\n            .slice(0, 3)\n            .map((p) => p.tipo)\n            .join(', ');\n\n          ocorrencias.push(\n            criarOcorrencia({\n              tipo: 'PROBLEMA_PERFORMANCE',\n              nivel: nivelAjustado,\n              mensagem: DetectorAgregadosMessages.problemasPerformanceResumo(\n                impacto,\n                resumo,\n                items.length,\n              ),\n              relPath,\n              linha: items[0].linha,\n            }),\n          );\n        }\n      }\n\n      // Aplicar supressões inline antes de retornar\n      return filtrarOcorrenciasSuprimidas(ocorrencias, 'performance', src);\n    } catch (erro) {\n      return [\n        criarOcorrencia({\n          tipo: 'ERRO_ANALISE',\n          nivel: 'aviso',\n          mensagem: DetectorAgregadosMessages.erroAnalisarPerformance(erro),\n          relPath,\n          linha: 1,\n        }),\n      ];\n    }\n  },\n};\n\nfunction detectarPadroesPerformance(\n  src: string,\n  problemas: ProblemaPerformance[],\n  relPath: string,\n): void {\n  const linhas = src.split('\\n');\n  let dentroLoop = 0;\n\n  linhas.forEach((linha, index) => {\n    const numeroLinha = index + 1;\n\n    // Detectar entrada de loops\n    if (/\\b(for|while)\\s*\\(/.test(linha)) {\n      dentroLoop++;\n\n      // Se já estamos em um loop e encontramos outro, é loop aninhado\n      if (dentroLoop > 1) {\n        problemas.push({\n          tipo: 'inefficient-loop',\n          descricao:\n            'Loops aninhados podem causar problemas de performance O(n²)',\n          impacto: 'alto',\n          linha: numeroLinha,\n          coluna:\n            linha.indexOf('for') !== -1\n              ? linha.indexOf('for') + 1\n              : linha.indexOf('while') + 1,\n          sugestao:\n            'Considere usar Map, Set ou otimizar algoritmo para complexidade linear',\n        });\n      }\n    }\n\n    // Detectar saída de loops (simplificado)\n    if (/^\\s*}/.test(linha) && dentroLoop > 0) {\n      dentroLoop = Math.max(0, dentroLoop - 1);\n    }\n\n    // Operações síncronas bloqueantes\n    if (/\\b(readFileSync|writeFileSync|execSync)\\s*\\(/.test(linha)) {\n      problemas.push({\n        tipo: 'blocking-operation',\n        descricao: 'Operação síncrona pode bloquear event loop',\n        impacto: 'alto',\n        linha: numeroLinha,\n        coluna:\n          linha.indexOf(\n            /readFileSync|writeFileSync|execSync/.exec(linha)?.[0] || '',\n          ) + 1,\n        sugestao: 'Use versões assíncronas: readFile, writeFile, exec',\n      });\n    }\n\n    // Event listeners sem cleanup\n    if (/addEventListener\\s*\\(/.test(linha)) {\n      // Verificar se há removeEventListener no código (ignorando comentários)\n      const srcSemComentarios = src\n        .replace(/\\/\\/.*$/gm, '')\n        .replace(/\\/\\*[\\s\\S]*?\\*\\//g, '');\n      if (\n        !srcSemComentarios.includes('removeEventListener') &&\n        !srcSemComentarios.includes('cleanup') &&\n        !srcSemComentarios.includes('destroy')\n      ) {\n        problemas.push({\n          tipo: 'memory-leak',\n          descricao: 'Event listener pode causar vazamento de memória',\n          impacto: 'medio',\n          linha: numeroLinha,\n          coluna: linha.indexOf('addEventListener') + 1,\n          sugestao: 'Adicione removeEventListener em cleanup/destroy',\n        });\n      }\n    }\n\n    // React: map sem key (detecção melhorada)\n    if (\n      /\\.map\\s*\\([^)]*\\)/.test(linha) &&\n      (/return\\s*<|<\\w+/.test(linha) ||\n        relPath.includes('.tsx') ||\n        relPath.includes('.jsx')) &&\n      !linha.includes('key=')\n    ) {\n      problemas.push({\n        tipo: 'unnecessary-rerender',\n        descricao:\n          'React map sem key prop pode causar rerenders desnecessários',\n        impacto: 'medio',\n        linha: numeroLinha,\n        coluna: linha.indexOf('.map') + 1,\n        sugestao: 'Adicione key prop única para cada elemento da lista',\n      });\n    }\n\n    // N+1 queries pattern\n    if (/\\.forEach\\s*\\(.*\\.(find|get|query|select)\\s*\\(/.test(linha)) {\n      problemas.push({\n        tipo: 'n-plus-one',\n        descricao: 'Possível problema N+1 em consultas',\n        impacto: 'alto',\n        linha: numeroLinha,\n        coluna: linha.indexOf('.forEach') + 1,\n        sugestao: 'Use join/include ou agrupe consultas para evitar N+1',\n      });\n    }\n\n    // Imports de bibliotecas grandes\n    if (\n      /import.*from\\s+['\"]lodash['\"]|import.*from\\s+['\"]moment['\"]/.test(linha)\n    ) {\n      problemas.push({\n        tipo: 'large-bundle',\n        descricao: 'Import completo de biblioteca grande pode aumentar bundle',\n        impacto: 'medio',\n        linha: numeroLinha,\n        coluna: linha.indexOf('import') + 1,\n        sugestao:\n          'Use imports específicos: import { method } from \"lodash/method\"',\n      });\n    }\n  });\n}\n\nfunction detectarProblemasPerformanceAST(\n  ast: NodePath<Node>,\n  problemas: ProblemaPerformance[],\n  relPath: string,\n): void {\n  try {\n    traverse(ast.node, {\n      // Detectar loops aninhados via AST (mais preciso)\n      ForStatement(path: NodePath<ForStatement>) {\n        let parent = path.parent;\n        while (parent) {\n          if (\n            parent.type === 'ForStatement' ||\n            parent.type === 'WhileStatement' ||\n            parent.type === 'DoWhileStatement'\n          ) {\n            problemas.push({\n              tipo: 'inefficient-loop',\n              descricao:\n                'Loop aninhado detectado via AST - pode causar performance O(n²)',\n              impacto: 'alto',\n              linha: path.node.loc?.start.line || 0,\n              coluna: path.node.loc?.start.column || 0,\n              sugestao:\n                'Considere restruturar algoritmo para evitar complexidade quadrática',\n            });\n            break;\n          }\n          parent = (parent as NodePath).parent; // Parent NodePath\n        }\n      },\n\n      // Detectar função setTimeout/setInterval sem cleanup\n      CallExpression(path: NodePath<CallExpression>) {\n        if (\n          path.node.callee.type === 'Identifier' &&\n          (path.node.callee.name === 'setTimeout' ||\n            path.node.callee.name === 'setInterval')\n        ) {\n          // Verificar se há clearTimeout/clearInterval no escopo\n          const binding = path.scope.getBinding(path.node.callee.name);\n          if (!binding) return;\n\n          // Heurística simples: se não há clear* na mesma função/arquivo\n          const parentFunction = path.getFunctionParent();\n          if (\n            parentFunction &&\n            !parentFunction.toString().includes('clear') &&\n            !relPath.includes('test')\n          ) {\n            problemas.push({\n              tipo: 'memory-leak',\n              descricao: `${path.node.callee.name} sem cleanup pode causar vazamento`,\n              impacto: 'medio',\n              linha: path.node.loc?.start.line || 0,\n              coluna: path.node.loc?.start.column || 0,\n              sugestao: `Use clear${path.node.callee.name.replace('set', '')} para limpar`,\n            });\n          }\n        }\n      },\n    });\n  } catch {\n    // Ignorar erros de traverse\n  }\n}\n\nfunction agruparPorImpacto(\n  problemas: ProblemaPerformance[],\n): Record<string, ProblemaPerformance[]> {\n  return problemas.reduce(\n    (acc, problema) => {\n      const impacto = problema.impacto;\n      if (impacto) {\n        if (!acc[impacto]) {\n          acc[impacto] = [];\n        }\n        acc[impacto].push(problema);\n      }\n      return acc;\n    },\n    {} as Record<string, ProblemaPerformance[]>,\n  );\n}\n\nfunction mapearImpactoParaNivel(\n  impacto: ProblemaPerformance['impacto'],\n): 'info' | 'aviso' | 'erro' {\n  switch (impacto) {\n    case 'alto':\n      return 'aviso';\n    case 'medio':\n      return 'aviso';\n    case 'baixo':\n    default:\n      return 'info';\n  }\n}\n"]}