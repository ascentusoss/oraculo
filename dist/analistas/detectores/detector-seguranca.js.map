{"version":3,"file":"detector-seguranca.js","sourceRoot":"","sources":["../../../src/analistas/detectores/detector-seguranca.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n//  seguranca vulnerabilidade-seguranca\nimport type { NodePath } from '/traverse';\nimport type { CallExpression, NewExpression, Node } from '/types';\nimport { traverse } from '/config/traverse.js';\nimport { DetectorAgregadosMessages } from '/messages/analistas/detector-agregados-messages.js';\nimport { detectarContextoProjeto } from '/contexto-projeto.js';\nimport { filtrarOcorrenciasSuprimidas } from '/helpers/suppressao.js';\n\nimport type { Analista, Ocorrencia, ProblemaSeguranca } from '@';\nimport { criarOcorrencia } from '@';\n\n// Funções helper para detecção inteligente de segredos\n\nfunction isPlaceholderSuspeito(linha: string): boolean {\n  const placeholdersComuns = [\n    '<YOUR_',\n    '<FOO>',\n    '<BAR>',\n    'REPLACE_ME',\n    'EXAMPLE_',\n    'PLACEHOLDER',\n    'your_',\n    'example',\n    'sample',\n    'demo',\n    'test',\n    'fake',\n    'dummy',\n    'mock',\n  ];\n\n  const linhaLower = linha.toLowerCase();\n  return placeholdersComuns.some((p) => linhaLower.includes(p.toLowerCase()));\n}\n\nfunction isContextoDocumentacao(relPath: string): boolean {\n  const arquivosDoc = [\n    'readme',\n    'doc/',\n    'docs/',\n    '.md',\n    '.example',\n    '.sample',\n    '.template',\n    'third-party-notices',\n    'license',\n    'changelog',\n  ];\n\n  const pathLower = relPath.toLowerCase();\n  return arquivosDoc.some((pattern) => pathLower.includes(pattern));\n}\n\nfunction calcularEntropia(str: string): number {\n  const frequencias = new Map<string, number>();\n\n  // Contar frequência de cada caractere\n  for (const char of str) {\n    frequencias.set(char, (frequencias.get(char) || 0) + 1);\n  }\n\n  // Calcular entropia de Shannon\n  let entropia = 0;\n  for (const freq of frequencias.values()) {\n    const prob = freq / str.length;\n    entropia -= prob * Math.log2(prob);\n  }\n\n  return entropia;\n}\n\nexport const analistaSeguranca: Analista = {\n  nome: 'seguranca',\n  categoria: 'seguranca',\n  descricao: 'Detecta vulnerabilidades e práticas inseguras no código',\n\n  test: (relPath: string): boolean => {\n    return /\\.(js|jsx|ts|tsx|mjs|cjs)$/.test(relPath);\n  },\n\n  aplicar: (\n    src: string,\n    relPath: string,\n    ast: NodePath<Node> | null,\n  ): Ocorrencia[] => {\n    if (!src) return [];\n\n    const contextoArquivo = detectarContextoProjeto({\n      arquivo: relPath,\n      conteudo: src,\n      relPath,\n    });\n\n    const problemas: ProblemaSeguranca[] = [];\n\n    try {\n      // Detectar problemas por padrões de texto (mais confiável que AST para alguns casos)\n      detectarPadroesPerigosos(src, relPath, problemas);\n\n      // Detectar problemas via AST quando disponível\n      if (ast) {\n        detectarProblemasAST(ast, problemas);\n      }\n\n      // Converter para ocorrências\n      const ocorrencias: Ocorrencia[] = [];\n\n      // Agrupar por severidade\n      const porSeveridade = agruparPorSeveridade(problemas);\n\n      for (const [severidade, items] of Object.entries(porSeveridade)) {\n        if (items.length > 0) {\n          const nivel = mapearSeveridadeParaNivel(\n            severidade as ProblemaSeguranca['severidade'],\n          );\n\n          // Ajustar severidade baseado no contexto\n          const nivelAjustado =\n            contextoArquivo.isTest && nivel === 'aviso' ? 'info' : nivel;\n\n          const resumo = items\n            .slice(0, 3)\n            .map((p) => p.tipo)\n            .join(', ');\n\n          ocorrencias.push(\n            criarOcorrencia({\n              tipo: 'vulnerabilidade-seguranca',\n              nivel: nivelAjustado,\n              mensagem: DetectorAgregadosMessages.problemasSegurancaResumo(\n                severidade,\n                resumo,\n                items.length,\n              ),\n              relPath,\n              linha: items[0].linha,\n            }),\n          );\n        }\n      }\n\n      // Aplicar supressões inline antes de retornar\n      return filtrarOcorrenciasSuprimidas(ocorrencias, 'seguranca', src);\n    } catch (erro) {\n      return [\n        criarOcorrencia({\n          tipo: 'ERRO_ANALISE',\n          nivel: 'aviso',\n          mensagem: DetectorAgregadosMessages.erroAnalisarSeguranca(erro),\n          relPath,\n          linha: 1,\n        }),\n      ];\n    }\n  },\n};\n\nfunction detectarPadroesPerigosos(\n  src: string,\n  relPath: string,\n  problemas: ProblemaSeguranca[],\n): void {\n  const linhas = src.split('\\n');\n\n  function isLikelyHttpHeaderName(value: string): boolean {\n    const v = String(value || '').trim();\n    if (!v) return false;\n    // Header names geralmente são curtos/médios e usam letras/números/hífens.\n    if (v.length < 4 || v.length > 80) return false;\n    if (!/^[A-Za-z0-9-]+$/.test(v)) return false;\n    if (v.startsWith('-') || v.endsWith('-')) return false;\n    // Heurística: costuma ter hífen (ex.: Content-Type) e, muitas vezes, prefixo X-\n    if (!/-/.test(v) && !/^X[A-Za-z]?/.test(v)) return false;\n    return true;\n  }\n\n  function isHttpHeadersKeyValueContext(index: number): boolean {\n    const start = Math.max(0, index - 12);\n    const end = Math.min(linhas.length, index + 6);\n    const ctx = linhas.slice(start, end).join('\\n');\n    const hasHeaders =\n      /\\bheaders\\b\\s*[:=]/i.test(ctx) || /\\bheader\\b/i.test(ctx);\n    const hasValueProp = /\\bvalue\\b\\s*[:=]/i.test(ctx);\n    return hasHeaders && hasValueProp;\n  }\n\n  linhas.forEach((linha, index) => {\n    const numeroLinha = index + 1;\n\n    // Ignorar comentários, strings e regex patterns para reduzir falsos positivos\n    const linhaSemComentarios = linha\n      .replace(/\\/\\/.*$/, '')\n      .replace(/\\/\\*.*?\\*\\//, '');\n    const linhaSemStrings = linhaSemComentarios\n      .replace(/'[^']*'/g, '')\n      .replace(/\"[^\"]*\"/g, '')\n      .replace(/`[^`]*`/g, '')\n      .replace(/\\/[^\\/]*\\//g, '');\n\n    // eval() usage - apenas em código real, não em comentários/strings/regex\n    if (/\\beval\\s*\\(/.test(linhaSemStrings)) {\n      problemas.push({\n        tipo: 'eval-usage',\n        descricao: 'Uso de eval() pode executar código malicioso',\n        severidade: 'critica',\n        linha: numeroLinha,\n        sugestao: 'Use JSON.parse() ou funções específicas ao invés de eval()',\n      });\n    }\n\n    // innerHTML com variáveis\n    if (/\\.innerHTML\\s*=\\s*[^\"']/.test(linha)) {\n      problemas.push({\n        tipo: 'dangerous-html',\n        descricao: 'innerHTML com variáveis pode causar XSS',\n        severidade: 'alta',\n        linha: numeroLinha,\n        sugestao: 'Use textContent ou sanitize o HTML antes de inserir',\n      });\n    }\n\n    // Math.random() para criptografia\n    if (\n      /Math\\.random\\(\\)/.test(linha) &&\n      /crypto|password|token|secret/i.test(linha)\n    ) {\n      problemas.push({\n        tipo: 'weak-crypto',\n        descricao: 'Math.random() não é seguro para criptografia',\n        severidade: 'alta',\n        linha: numeroLinha,\n        sugestao: 'Use crypto.randomBytes() ou crypto.getRandomValues()',\n      });\n    }\n\n    // Algoritmos de hash fracos\n    if (/createHash\\s*\\(\\s*['\"`](md5|md4|sha1)['\"`]\\s*\\)/.test(linha)) {\n      const algoritmo = /createHash\\s*\\(\\s*['\"`](md5|md4|sha1)['\"`]\\s*\\)/.exec(\n        linha,\n      )?.[1];\n\n      // Verificar se há comentário justificando o uso (ex: fingerprinting, não-criptográfico)\n      const linhaAnterior = index > 0 ? linhas[index - 1] : '';\n      const linha2Atras = index > 1 ? linhas[index - 2] : '';\n      const comentarioContexto = linhaAnterior + linha2Atras;\n      const temJustificativa =\n        /fingerprint|cache|baseline|perf|não.*segurança|not.*security|não.*criptograf/i.test(\n          comentarioContexto,\n        ) ||\n        /apenas.*identifica|only.*identif|deduplica/i.test(comentarioContexto);\n\n      if (!temJustificativa) {\n        problemas.push({\n          tipo: 'weak-crypto',\n          descricao: `Algoritmo de hash ${algoritmo?.toUpperCase()} é considerado fraco`,\n          severidade: 'alta',\n          linha: numeroLinha,\n          sugestao:\n            'Use SHA-256 ou superior: createHash(\"sha256\") - ou adicione comentário se for apenas fingerprinting',\n        });\n      }\n    }\n\n    // RegExp com input do usuário\n    if (\n      /new RegExp\\s*\\([^)]*\\)/.test(linha) &&\n      /req\\.|params\\.|query\\.|body\\./.test(linha)\n    ) {\n      problemas.push({\n        tipo: 'unsafe-regex',\n        descricao: 'RegExp com input não validado pode causar ReDoS',\n        severidade: 'media',\n        linha: numeroLinha,\n        sugestao: 'Valide e escape o input antes de usar em RegExp',\n      });\n    }\n\n    // __proto__ manipulation - evitar falsos positivos em strings/comentários\n    if (/__proto__/.test(linhaSemStrings)) {\n      problemas.push({\n        tipo: 'prototype-pollution',\n        descricao: 'Manipulação de __proto__ pode causar prototype pollution',\n        severidade: 'alta',\n        linha: numeroLinha,\n        sugestao:\n          'Use Object.create(null) ou Object.setPrototypeOf() com cuidado',\n      });\n    }\n\n    // Path traversal patterns\n    if (/\\.\\.\\//g.test(linha) && /req\\.|params\\.|query\\./.test(linha)) {\n      problemas.push({\n        tipo: 'path-traversal',\n        descricao: 'Possível vulnerabilidade de path traversal',\n        severidade: 'alta',\n        linha: numeroLinha,\n        sugestao:\n          'Sanitize caminhos de arquivo e use path.resolve() com cuidado',\n      });\n    }\n\n    // Credenciais hardcoded - versão inteligente com whitelist\n    // Excluir variáveis comuns que não são secrets (migrationKey, cacheKey, hashKey, etc)\n    const isNonSecretKey =\n      /\\b(migration|cache|hash|dedupe|lookup|map|index)key\\b/i.test(linha);\n\n    if (\n      !isPlaceholderSuspeito(linha) &&\n      !isContextoDocumentacao(relPath) &&\n      !isNonSecretKey\n    ) {\n      const padraoSegredo =\n        /\\b(password|pwd|pass|secret|key|token|api_key|apikey)\\b\\s*[:=]\\s*['\"`]([^'\"`\\s]{3,})/i;\n      const match = linha.match(padraoSegredo);\n\n      if (match) {\n        const campo = String(match[1] || '').toLowerCase();\n        const valor = match[2];\n\n        // Redução de falsos positivos: headers HTTP em configurações\n        // Ex.: headers: [{ key: 'X-Content-Type-Options', value: 'nosniff' }]\n        if (\n          campo === 'key' &&\n          isLikelyHttpHeaderName(valor) &&\n          isHttpHeadersKeyValueContext(index)\n        ) {\n          return;\n        }\n\n        // Excluir template strings com interpolação (não são secrets hardcoded)\n        const temInterpolacao =\n          linha.includes('${') || /`[^`]*\\$\\{[^}]+\\}/.test(linha);\n        if (temInterpolacao) {\n          return; // Template strings dinâmicas não são hardcoded\n        }\n\n        // Whitelist de padrões comuns de nomenclatura (não são secrets)\n        const padroesNomenclatura = [\n          '_role_',\n          '_config_',\n          '_key_',\n          '_type_',\n          '_name_',\n          '_prefix_',\n          '_suffix_',\n          'squad_',\n          'channel_',\n          'guild_',\n        ];\n\n        const isPadraoNomenclatura = padroesNomenclatura.some((p) =>\n          valor.toLowerCase().includes(p.toLowerCase()),\n        );\n\n        if (isPadraoNomenclatura) {\n          return; // Padrões de nomenclatura não são secrets\n        }\n\n        // Whitelist para placeholders comuns\n        const placeholdersSegurs = [\n          '<YOUR_',\n          '<FOO>',\n          '<BAR>',\n          'REPLACE_ME',\n          'EXAMPLE_',\n          'PLACEHOLDER',\n          'your_',\n          'example',\n          'sample',\n          'demo',\n          'test',\n          'fake',\n          'dummy',\n          'mock',\n        ];\n\n        const isPlaceholder = placeholdersSegurs.some((p) =>\n          valor.toLowerCase().includes(p.toLowerCase()),\n        );\n\n        // Verificar entropia (tokens reais tendem a ter alta entropia)\n        const entropia = calcularEntropia(valor);\n        const temAltaEntropia = entropia > 3.5; // Threshold empírico\n\n        // Verificar se parece com token/chave real\n        const pareceTokReal =\n          valor.length > 20 && // Aumentado de 8 para 20 para reduzir falsos positivos\n          (temAltaEntropia || /^[A-Za-z0-9+/]{20,}={0,2}$/.test(valor)) && // Base64-like\n          !isPlaceholder;\n\n        if (pareceTokReal) {\n          problemas.push({\n            tipo: 'hardcoded-secrets',\n            descricao: 'Credenciais hardcoded no código podem ser expostas',\n            severidade: 'critica',\n            linha: numeroLinha,\n            sugestao:\n              'Use variáveis de ambiente ou arquivo de configuração seguro',\n          });\n        }\n      }\n    }\n  });\n\n  // Detectar async/await sem try-catch (melhoria exclusiva)\n  detectarAsyncSemTryCatch(src, problemas);\n}\n\n/**\n * Detecta uso de async/await sem tratamento adequado de erro\n */\nfunction detectarAsyncSemTryCatch(\n  src: string,\n  problemas: ProblemaSeguranca[],\n): void {\n  const lines = src.split('\\n');\n\n  // Contexto global do arquivo para detectar padrões do Next.js\n  const isNextJsServerComponent =\n    /^['\"](use server|use client)['\"]/.test(src.trim()) ||\n    /export\\s+(default\\s+)?async\\s+function/.test(src);\n  const hasDynamicImport = /next\\/dynamic|import\\s*\\(/.test(src);\n\n  for (let i = 0; i < lines.length; i++) {\n    const line = lines[i];\n    const trimmedLine = line.trim();\n\n    // Detectar await sem try-catch\n    if (/\\bawait\\s+/.test(line) && !trimmedLine.startsWith('//')) {\n      // Verificar contexto expandido para detectar event handlers\n      const contextLines = lines.slice(Math.max(0, i - 10), i);\n      const context = contextLines.join(' ');\n\n      // Detectar se está dentro de event handler (fire-and-forget por design)\n      const isEventHandler =\n        /\\.on\\s*\\(/.test(context) ||\n        /\\.once\\s*\\(/.test(context) ||\n        /addEventListener\\s*\\(/.test(context) ||\n        /collector\\.on\\s*\\(/.test(context) ||\n        /emitter\\.on\\s*\\(/.test(context) ||\n        /process\\.on\\s*\\(/.test(context);\n\n      // Verificar se é dynamic import do Next.js (tratamento gerenciado pelo framework)\n      const isDynamicImport =\n        hasDynamicImport &&\n        (/import\\s*\\(/.test(line) || /dynamic\\s*\\(/.test(context));\n\n      // Server Components do Next.js: tratamento gerenciado pelo framework\n      if (isNextJsServerComponent || isDynamicImport) {\n        continue;\n      }\n\n      // Verificar se há try-catch em escopo expandido (20 linhas antes/depois)\n      const extendedContext = lines.slice(\n        Math.max(0, i - 20),\n        Math.min(lines.length, i + 10),\n      );\n      const fullContext = extendedContext.join('\\n');\n\n      // Detectar try-catch em escopo pai (bloco que envolve o await)\n      const hasErrorHandling =\n        /try\\s*\\{[\\s\\S]*?\\}\\s*catch/.test(fullContext) ||\n        /\\.catch\\s*\\(/.test(line) ||\n        /\\.catch\\s*\\(/.test(lines[i + 1] || '') ||\n        // Promise encadeada com .then().catch()\n        /\\.then\\s*\\([^)]*\\)\\s*\\.catch/.test(fullContext);\n\n      if (!hasErrorHandling) {\n        problemas.push({\n          tipo: isEventHandler ? 'unhandled-async-event' : 'unhandled-async',\n          descricao: isEventHandler\n            ? 'await em event handler sem tratamento de erro (considere adicionar .catch se necessário)'\n            : 'await sem tratamento de erro pode causar crashes não tratados',\n          severidade: isEventHandler ? 'baixa' : 'media',\n          linha: i + 1,\n          sugestao: isEventHandler\n            ? 'Event handlers são fire-and-forget. Adicione .catch() apenas se precisar tratar erros específicos'\n            : 'Envolva em try-catch ou use .catch() na Promise',\n        });\n      }\n    }\n  }\n}\n\nfunction detectarProblemasAST(\n  ast: NodePath<Node>,\n  problemas: ProblemaSeguranca[],\n): void {\n  try {\n    traverse(ast.node, {\n      // Detectar Function constructor\n      NewExpression(path: NodePath<NewExpression>) {\n        if (\n          path.node.callee.type === 'Identifier' &&\n          path.node.callee.name === 'Function'\n        ) {\n          problemas.push({\n            tipo: 'eval-usage',\n            descricao: 'Function constructor pode executar código dinâmico',\n            severidade: 'alta',\n            linha: path.node.loc?.start.line || 0,\n            sugestao: 'Evite Function constructor, use funções declaradas',\n          });\n        }\n      },\n\n      // Detectar setTimeout/setInterval com strings\n      CallExpression(path: NodePath<CallExpression>) {\n        if (\n          path.node.callee.type === 'Identifier' &&\n          ['setTimeout', 'setInterval'].includes(path.node.callee.name) &&\n          path.node.arguments[0]?.type === 'StringLiteral'\n        ) {\n          problemas.push({\n            tipo: 'eval-usage',\n            descricao:\n              'setTimeout/setInterval com string executa código dinâmico',\n            severidade: 'media',\n            linha: path.node.loc?.start.line || 0,\n            sugestao: 'Use função ao invés de string',\n          });\n        }\n      },\n    });\n  } catch {\n    // Ignorar erros de traverse para não quebrar a análise\n  }\n}\n\nfunction agruparPorSeveridade(\n  problemas: ProblemaSeguranca[],\n): Record<string, ProblemaSeguranca[]> {\n  return problemas.reduce(\n    (acc, problema) => {\n      if (!acc[problema.severidade]) {\n        acc[problema.severidade] = [];\n      }\n      acc[problema.severidade].push(problema);\n      return acc;\n    },\n    {} as Record<string, ProblemaSeguranca[]>,\n  );\n}\n\nfunction mapearSeveridadeParaNivel(\n  severidade: ProblemaSeguranca['severidade'],\n): 'info' | 'aviso' | 'erro' {\n  switch (severidade) {\n    case 'critica':\n    case 'alta':\n      return 'erro';\n    case 'media':\n      return 'aviso';\n    case 'baixa':\n    default:\n      return 'info';\n  }\n}\n"]}