{"version":3,"file":"sinais-projeto.js","sourceRoot":"","sources":["../../../src/analistas/arquitetos/sinais-projeto.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n// import path from 'node:path'; // Removido: não utilizado\nimport type {\n  ClassDeclaration,\n  ImportDeclaration,\n  Program,\n  Statement,\n  TSEnumDeclaration,\n  TSInterfaceDeclaration,\n  TSTypeAliasDeclaration,\n  VariableDeclaration,\n} from '/types';\n\nimport type { FileEntryWithAst, PackageJson, SinaisProjetoAvancados } from '@';\n\nexport function extrairSinaisAvancados(\n  fileEntries: FileEntryWithAst[],\n  packageJson?: PackageJson,\n): SinaisProjetoAvancados {\n  // Auxiliar para checar se o nó possui id.name string\n  const hasIdName = (node: unknown): node is { id: { name: string } } => {\n    return (\n      typeof node === 'object' &&\n      node !== null &&\n      'id' in node &&\n      typeof (node as { id?: { name?: unknown } }).id?.name === 'string'\n    );\n  };\n  const sinais: SinaisProjetoAvancados = {\n    funcoes: 0,\n    imports: [],\n    variaveis: 0,\n    tipos: [],\n    classes: 0,\n    frameworksDetectados: [],\n    dependencias: [],\n    scripts: [],\n    pastasPadrao: [],\n    arquivosPadrao: [],\n    arquivosConfig: [],\n    padroesArquiteturais: [],\n    tecnologiasDominantes: [],\n    complexidadeEstrutura: 'baixa',\n    tipoDominante: 'desconhecido',\n  };\n\n  for (const fe of fileEntries) {\n    let body: Statement[] = [];\n    if (\n      fe.ast &&\n      'node' in fe.ast &&\n      fe.ast.node &&\n      (fe.ast.node as Program).type === 'Program' &&\n      Array.isArray((fe.ast.node as Program).body)\n    ) {\n      body = (fe.ast.node as Program).body;\n    }\n    // Funções\n    sinais.funcoes += body.filter(\n      (n): n is import('/types').FunctionDeclaration =>\n        n.type === 'FunctionDeclaration',\n    ).length;\n    // Imports\n    const imports = body.filter(\n      (n): n is ImportDeclaration => n.type === 'ImportDeclaration',\n    );\n    sinais.imports.push(...imports.map((i) => i.source.value));\n    // Variáveis\n    sinais.variaveis += body.filter(\n      (n): n is VariableDeclaration => n.type === 'VariableDeclaration',\n    ).length;\n    // Tipos (TypeScript)\n    sinais.tipos.push(\n      ...body\n        .filter(\n          (\n            n,\n          ): n is\n            | TSTypeAliasDeclaration\n            | TSInterfaceDeclaration\n            | TSEnumDeclaration =>\n            [\n              'TSTypeAliasDeclaration',\n              'TSInterfaceDeclaration',\n              'TSEnumDeclaration',\n            ].includes(n.type),\n        )\n        .map((n) => (hasIdName(n) ? n.id.name : undefined))\n        .filter((v): v is string => typeof v === 'string'),\n    );\n    // Classes\n    sinais.classes += body.filter(\n      (n): n is ClassDeclaration => n.type === 'ClassDeclaration',\n    ).length;\n    // Frameworks por import\n    for (const i of imports) {\n      if (typeof i.source.value === 'string') {\n        if (\n          /express|react|next|electron|discord\\.js|telegraf/.test(\n            i.source.value,\n          )\n        ) {\n          sinais.frameworksDetectados.push(i.source.value);\n        }\n      }\n    }\n    // Padrões de pastas/arquivos\n    const rel = fe.relPath.replace(/\\\\/g, '/');\n    if (/src\\/controllers|pages|api|prisma|packages|apps/.test(rel)) {\n      sinais.pastasPadrao.push(rel);\n    }\n    if (/main\\.js|index\\.ts|bot\\.ts|electron\\.js/.test(rel)) {\n      sinais.arquivosPadrao.push(rel);\n    }\n    if (/tsconfig\\.json|turbo\\.json|pnpm-workspace\\.yaml/.test(rel)) {\n      sinais.arquivosConfig.push(rel);\n    }\n  }\n  // Dependências e scripts do package.json\n  if (packageJson) {\n    sinais.dependencias.push(...Object.keys(packageJson.dependencies || {}));\n    sinais.scripts.push(...Object.keys(packageJson.scripts || {}));\n  }\n  // Normaliza arrays\n  sinais.imports = Array.from(new Set(sinais.imports));\n  sinais.frameworksDetectados = Array.from(\n    new Set(sinais.frameworksDetectados),\n  );\n  sinais.pastasPadrao = Array.from(new Set(sinais.pastasPadrao));\n  sinais.arquivosPadrao = Array.from(new Set(sinais.arquivosPadrao));\n  sinais.arquivosConfig = Array.from(new Set(sinais.arquivosConfig));\n  sinais.tipos = Array.from(new Set(sinais.tipos));\n  return sinais;\n}\n"]}