{"version":3,"file":"relatorio-poda.js","sourceRoot":"","sources":["../../src/relatorios/relatorio-poda.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport { RelatorioMessages } from '@core/messages/index.js';\nimport { salvarEstado } from '@shared/persistence/persistencia.js';\n\nimport type { OpcoesRelatorioPoda, Pendencia, PendenciaProcessavel } from '@';\n\nexport async function gerarRelatorioPodaMarkdown(\n  caminho: string,\n  podados: Pendencia[],\n  mantidos: Pendencia[],\n  opcoes?: OpcoesRelatorioPoda,\n): Promise<void> {\n  const dataISO = new Date().toISOString();\n  const totalPodados = podados.length;\n  const totalMantidos = mantidos.length;\n  const simulado = opcoes?.simulado;\n\n  let md = `# ${RelatorioMessages.poda.titulo}\\n\\n`;\n  md += `**${RelatorioMessages.poda.secoes.metadados.data}:** ${dataISO}  \\n`;\n  md += `**${RelatorioMessages.poda.secoes.metadados.execucao}:** ${simulado ? RelatorioMessages.poda.secoes.metadados.simulacao : RelatorioMessages.poda.secoes.metadados.real}  \\n`;\n  md += `**${RelatorioMessages.poda.secoes.metadados.arquivosPodados}:** ${totalPodados}  \\n`;\n  md += `**${RelatorioMessages.poda.secoes.metadados.arquivosMantidos}:** ${totalMantidos}  \\n`;\n  md += `\\n---\\n`;\n\n  md += `## ${RelatorioMessages.poda.secoes.podados.titulo}\\n`;\n  if (totalPodados === 0) {\n    md += `${RelatorioMessages.poda.secoes.podados.vazio}\\n`;\n  } else {\n    const cols = RelatorioMessages.poda.secoes.podados.colunas;\n    md += `| ${cols.arquivo} | ${cols.motivo} | ${cols.diasInativo} | ${cols.detectadoEm} |\\n`;\n    md += '|---------|--------|--------------|--------------|\\n';\n    for (const p of podados) {\n      const pendenciaObj = p as PendenciaProcessavel;\n      const diasInativo =\n        typeof pendenciaObj.diasInativo === 'number'\n          ? String(pendenciaObj.diasInativo)\n          : '-';\n      md += `| ${p.arquivo} | ${p.motivo} | ${diasInativo} | ${p.detectedAt ? new Date(p.detectedAt).toISOString().slice(0, 10) : '-'} |\\n`;\n    }\n  }\n  md += '\\n---\\n';\n\n  md += `## ${RelatorioMessages.poda.secoes.mantidos.titulo}\\n`;\n  if (totalMantidos === 0) {\n    md += `${RelatorioMessages.poda.secoes.mantidos.vazio}\\n`;\n  } else {\n    const cols = RelatorioMessages.poda.secoes.mantidos.colunas;\n    md += `| ${cols.arquivo} | ${cols.motivo} |\\n`;\n    md += '|---------|--------|\\n';\n    for (const p of mantidos) {\n      md += `| ${p.arquivo} | ${p.motivo} |\\n`;\n    }\n  }\n\n  await salvarEstado(caminho, md);\n}\n\nexport async function gerarRelatorioPodaJson(\n  caminho: string,\n  podados: Pendencia[],\n  mantidos: Pendencia[],\n): Promise<void> {\n  const json = {\n    podados: podados.map((p) => {\n      const pendenciaObj = p as PendenciaProcessavel;\n      return {\n        arquivo: p.arquivo,\n        motivo: p.motivo,\n        diasInativo:\n          typeof pendenciaObj.diasInativo === 'number'\n            ? pendenciaObj.diasInativo\n            : undefined,\n      };\n    }),\n    mantidos: mantidos.map((p) => ({ arquivo: p.arquivo, motivo: p.motivo })),\n    totalPodados: podados.length,\n    totalMantidos: mantidos.length,\n    timestamp: Date.now(),\n  };\n  await salvarEstado(caminho, json);\n}\n"]}