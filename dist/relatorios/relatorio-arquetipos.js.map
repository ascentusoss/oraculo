{"version":3,"file":"relatorio-arquetipos.js","sourceRoot":"","sources":["../../src/relatorios/relatorio-arquetipos.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport path from 'node:path';\n\nimport { ExcecoesMessages } from '/messages/core/excecoes-messages.js';\nimport { RelatorioMessages } from '/messages/index.js';\nimport {\n  lerArquivoTexto,\n  salvarEstado,\n} from '/persistence/persistencia.js';\n\nimport type { ResultadoDeteccaoArquetipo } from '@';\n\nexport async function exportarRelatorioArquetiposMarkdown(\n  destino: string,\n  candidatos: ResultadoDeteccaoArquetipo[],\n  contexto?: { origem?: string },\n  detalhado = false,\n): Promise<void> {\n  const linhas: string[] = [];\n  linhas.push(`# ${RelatorioMessages.arquetipos.titulo}`);\n  if (contexto?.origem) linhas.push(`*Origem: ${contexto.origem}*`);\n  linhas.push('');\n  const cols = RelatorioMessages.arquetipos.secoes.candidatos;\n  linhas.push(\n    `| ${cols.nome} | ${cols.confianca} | ${cols.score} | Explicação | Sugestão |`,\n  );\n  linhas.push('|-----------|---------------|-------|------------|----------|');\n  for (const c of candidatos) {\n    if (!detalhado) {\n      // Relatório compacto\n      const missing = c.missingRequired?.slice(0, 3) || [];\n      const forbidden = c.forbiddenPresent?.slice(0, 3) || [];\n      const dependFalt =\n        c.dependencyMatches?.length === 0 && c.dependencyMatches !== undefined\n          ? c.dependencyMatches\n          : [];\n      let resumo = '';\n      if (missing.length) resumo += `Faltam pastas: ${missing.join(', ')}. `;\n      if (forbidden.length)\n        resumo += `Estruturas proibidas: ${forbidden.join(', ')}. `;\n      if (dependFalt.length)\n        resumo += `Dependências ausentes: ${dependFalt.join(', ')}. `;\n      if (c.sugestaoPadronizacao)\n        resumo += c.sugestaoPadronizacao.replace(/\\n/g, ' ');\n      if (!resumo) resumo = 'Estrutura próxima do ideal.';\n      // Compacta explicação\n      const explicacao = (c.explicacaoSimilaridade || '')\n        .split('\\n')\n        .slice(0, 2)\n        .join(' ');\n      linhas.push(\n        `| ${c.nome} | ${c.confidence} | ${c.score} | ${explicacao} | ${resumo} |`,\n      );\n    } else {\n      // Relatório detalhado enriquecido\n      linhas.push(`\\n## ${c.nome}`);\n      linhas.push(`Confiança: ${c.confidence} | Score: ${c.score}`);\n      linhas.push(\n        `Explicação: ${c.explicacaoSimilaridade?.replace(/\\n/g, ' ')}`,\n      );\n      linhas.push(`Sugestão: ${c.sugestaoPadronizacao?.replace(/\\n/g, ' ')}`);\n      // Gravidade dos problemas\n      if (c.missingRequired?.length)\n        linhas.push(\n          `Pastas faltantes (gravidade: crítico): ${c.missingRequired.map((p) => `${p} [mkdir ${p}]`).join(', ')}`,\n        );\n      if (c.forbiddenPresent?.length)\n        linhas.push(\n          `Estruturas proibidas (gravidade: risco): ${c.forbiddenPresent.join(', ')}`,\n        );\n      if (c.dependencyMatches?.length)\n        linhas.push(\n          `Dependências detectadas: ${c.dependencyMatches.join(', ')}`,\n        );\n      if (c.filePatternMatches?.length)\n        linhas.push(`Padrões de arquivos: ${c.filePatternMatches.join(', ')}`);\n      if (c.anomalias?.length)\n        linhas.push(\n          `Anomalias: ${c.anomalias.map((a) => `${a.path} (${a.motivo})`).join(', ')}`,\n        );\n      // Sugestões automáticas de comandos/scripts\n      if (c.missingRequired?.length) {\n        linhas.push(`Sugestão de comandos:`);\n        c.missingRequired.forEach((p) => linhas.push(`  mkdir ${p}`));\n      }\n      // Dependências ausentes (simples)\n      if (c.dependencyMatches && Array.isArray(c.dependencyMatches)) {\n        const ausentes =\n          c.dependencyMatches.length === 0 && c.dependencyMatches !== undefined\n            ? c.dependencyMatches\n            : [];\n        if (ausentes.length) {\n          linhas.push(`Sugestão de comandos para dependências:`);\n          ausentes.forEach((dep) => linhas.push(`  npm install ${dep}`));\n        }\n      }\n      // Links para documentação oficial\n      if (c.nome) {\n        const docLinks: Record<string, string> = {\n          'api-rest-express': 'https://expressjs.com/pt-br/',\n          fullstack: 'https://nextjs.org/docs',\n          monorepo: 'https://turborepo.org/docs',\n          cli: 'https://nodejs.org/api/cli.html',\n          lib: 'https://www.typescriptlang.org/docs/',\n        };\n        if (docLinks[c.nome])\n          linhas.push(`Documentação oficial: ${docLinks[c.nome]}`);\n      }\n      // Frameworks detectados\n      if (c.dependencyMatches?.length) {\n        const fwLinks: Record<string, string> = {\n          express: 'https://expressjs.com/pt-br/',\n          react: 'https://react.dev/',\n          next: 'https://nextjs.org/docs',\n          electron: 'https://www.electronjs.org/docs',\n          'discord.js': 'https://discord.js.org/#/docs',\n          telegraf: 'https://telegraf.js.org/',\n        };\n        c.dependencyMatches.forEach((dep) => {\n          if (fwLinks[dep]) linhas.push(`Doc ${dep}: ${fwLinks[dep]}`);\n        });\n      }\n      // Pr�ticas inseguras e smells (exemplo)\n      if (\n        c.explicacaoSimilaridade &&\n        /função longa|require dinâmico|import misto|eval/.test(\n          c.explicacaoSimilaridade,\n        )\n      ) {\n        linhas.push(\n          `Práticas inseguras detectadas: ${c.explicacaoSimilaridade}`,\n        );\n      }\n      // Dependências desatualizadas/vulneráveis (simples)\n      try {\n        const pkgPath = path.resolve(process.cwd(), 'package.json');\n        try {\n          const raw = await lerArquivoTexto(pkgPath);\n          const pkg = raw ? JSON.parse(raw) : null;\n          if (!pkg) throw new Error(ExcecoesMessages.semPkg);\n          if (pkg.dependencies) {\n            for (const dep in pkg.dependencies) {\n              // Simulação: destaca dependências com versão \"0.\" ou \"^0.\" como desatualizadas/vulneráveis\n              if (\n                /^0\\./.test(pkg.dependencies[dep]) ||\n                /^\\^0\\./.test(pkg.dependencies[dep])\n              ) {\n                linhas.push(\n                  `Dependência potencialmente desatualizada/vulnerável: ${dep} (${pkg.dependencies[dep]}) [grave]`,\n                );\n                linhas.push(`Sugestão: npm update ${dep}`);\n              }\n            }\n          }\n        } catch {}\n      } catch {}\n      // Status do npm audit\n      try {\n        const { execSync } = await import('node:child_process');\n        const auditRaw = execSync('npm audit --json', { encoding: 'utf-8' });\n        const audit = JSON.parse(auditRaw);\n        if (audit.metadata?.vulnerabilities?.total > 0) {\n          linhas.push(`Vulnerabilidades detectadas pelo npm audit:`);\n          for (const [sev, qtd] of Object.entries(\n            audit.metadata.vulnerabilities,\n          )) {\n            if (typeof qtd === 'number' && qtd > 0 && sev !== 'total') {\n              linhas.push(`  ${sev}: ${qtd}`);\n            }\n          }\n          linhas.push('Sugestão: npm audit fix');\n        } else {\n          linhas.push('Nenhuma vulnerabilidade encontrada pelo npm audit.');\n        }\n      } catch {}\n      linhas.push('---');\n    }\n  }\n  linhas.push('');\n  linhas.push('---');\n  linhas.push('**Como o diagnóstico foi feito:**');\n  linhas.push(\n    `A pontuação de cada arquétipo considera presença de pastas obrigatórias, opcionais, padrões de arquivos, dependências e penalidades por estruturas proibidas. O campo \"Explicação\" detalha os fatores que levaram à sugestão.`,\n  );\n  await salvarEstado(destino, linhas.join('\\n'));\n}\n\nexport async function exportarRelatorioArquetiposJson(\n  destino: string,\n  candidatos: ResultadoDeteccaoArquetipo[],\n  contexto?: { origem?: string },\n  detalhado = false,\n): Promise<void> {\n  const { criarRelatorioComVersao } = await import('/schema/version.js');\n\n  const relatorio = {\n    origem: contexto?.origem ?? null,\n    candidatos: candidatos.map((c) => {\n      if (!detalhado) {\n        // Compacto\n        const missing = c.missingRequired?.slice(0, 3) || [];\n        const forbidden = c.forbiddenPresent?.slice(0, 3) || [];\n        const dependFalt =\n          c.dependencyMatches?.length === 0 && c.dependencyMatches !== undefined\n            ? c.dependencyMatches\n            : [];\n        let resumo = '';\n        if (missing.length) resumo += `Faltam pastas: ${missing.join(', ')}. `;\n        if (forbidden.length)\n          resumo += `Estruturas proibidas: ${forbidden.join(', ')}. `;\n        if (dependFalt.length)\n          resumo += `Dependências ausentes: ${dependFalt.join(', ')}. `;\n        if (c.sugestaoPadronizacao)\n          resumo += c.sugestaoPadronizacao.replace(/\\n/g, ' ');\n        if (!resumo) resumo = 'Estrutura próxima do ideal.';\n        // Compacta explicação\n        const explicacao = (c.explicacaoSimilaridade || '')\n          .split('\\n')\n          .slice(0, 2)\n          .join(' ');\n        return {\n          nome: c.nome,\n          confidence: c.confidence,\n          score: c.score,\n          explicacao,\n          resumo,\n          matchedRequired: c.matchedRequired?.slice(0, 3) || [],\n          missingRequired: missing,\n          forbiddenPresent: forbidden,\n          descricao: c.descricao,\n        };\n      } else {\n        // Detalhado\n        return {\n          nome: c.nome,\n          confidence: c.confidence,\n          score: c.score,\n          explicacao: c.explicacaoSimilaridade,\n          sugestao: c.sugestaoPadronizacao,\n          matchedRequired: c.matchedRequired,\n          missingRequired: c.missingRequired,\n          matchedOptional: c.matchedOptional,\n          dependencyMatches: c.dependencyMatches,\n          filePatternMatches: c.filePatternMatches,\n          forbiddenPresent: c.forbiddenPresent,\n          anomalias: c.anomalias,\n          descricao: c.descricao,\n        };\n      }\n    }),\n  };\n\n  // Criar relatório com versão\n  const relatorioVersionado = criarRelatorioComVersao(\n    relatorio,\n    undefined, // usar versão atual\n    'Relatório de detecção de arquétipos estruturais',\n  );\n\n  await salvarEstado(destino, relatorioVersionado);\n}\n"]}