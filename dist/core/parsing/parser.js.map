{"version":3,"file":"parser.js","sourceRoot":"","sources":["../../../src/core/parsing/parser.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport type { ParserOptions } from '/parser';\nimport { parse as babelParse } from '/parser';\nimport type { File as BabelFile } from '/types';\nimport { log, logCore } from '/messages/index.js';\nimport { initializeDefaultPlugins } from '/plugins/init.js';\n  /* -------------------------- SISTEMA DE PLUGINS - Novo sistema de parsers modular (Fase 1) -------------------------- */\nimport { getGlobalRegistry } from '/plugins/registry.js';\nimport * as csstree from 'css-tree';\nimport { XMLParser } from 'fast-xml-parser';\n// Parsers externos leves para outras linguagens\nimport { parseDocument } from 'htmlparser2';\nimport { createRequire } from 'module';\n\nimport type {\n  DecifrarSintaxeOpts,\n  ParserBabelFileExtra as BabelFileExtra,\n  ParserFunc,\n  ParserOptions as PluginParserOptions,\n  ParserRawAst,\n} from '@';\n\n// Contexto global para o arquivo atual durante parsing\nlet currentParsingFile: string | undefined;\n\n/**\n * Helper para setar o arquivo atual durante parsing\n */\nfunction setCurrentParsingFile(file: string | undefined) {\n  currentParsingFile = file;\n}\n\n/**\n * Helper para obter o arquivo atual durante parsing\n */\nexport function getCurrentParsingFile(): string {\n  return currentParsingFile || 'desconhecido';\n}\n\nconst localRequire = createRequire(import.meta.url);\n\n// Mantemos a assinatura retornando BabelFile | null para n√£o quebrar tipos externos, mas\n// para linguagens n√£o-Babel geramos um objeto \"compat\" m√≠nimo com File/Program vazio\n// e ast original em oraculoExtra.\n\nfunction parseComBabel(codigo: string, plugins?: string[]): BabelFile | null {\n  // Plugins padr√£o ampliados para cobrir padr√µes amplamente usados em node_modules\n  const defaultPlugins = [\n    'typescript',\n    'jsx',\n    'decorators-legacy',\n    // Suporte a import attributes/assertions modernos\n    'importAttributes',\n    'importAssertions',\n    // Class fields/methods private (comuns em libs modernas)\n    'classProperties',\n    'classPrivateProperties',\n    'classPrivateMethods',\n    'optionalChaining',\n    'nullishCoalescingOperator',\n    'topLevelAwait',\n  ];\n  const options: ParserOptions = {\n    sourceType: 'unambiguous',\n    plugins: (Array.isArray(plugins)\n      ? plugins\n      : defaultPlugins) as ParserOptions['plugins'],\n  };\n  try {\n    return babelParse(codigo, options);\n  } catch (e) {\n    // Mant√©m comportamento resiliente: parser inv√°lido retorna null (testes esperam isso)\n    logCore.erroBabel((e as Error).message, getCurrentParsingFile());\n    return null;\n  }\n}\n\nfunction wrapMinimal(lang: string, rawAst: ParserRawAst): BabelFileExtra {\n  return {\n    type: 'File',\n    program: {\n      type: 'Program',\n      body: [],\n      sourceType: 'script',\n      directives: [],\n    },\n    comments: [],\n    tokens: [],\n    oraculoExtra: { lang, rawAst },\n  };\n}\n\nfunction parseComTypeScript(codigo: string, tsx = false) {\n  try {\n    // Lazy require para reduzir custo quando n√£o necess√°rio\n    const ts: typeof import('typescript') = localRequire('typescript');\n    const sf = ts.createSourceFile(\n      tsx ? 'file.tsx' : 'file.ts',\n      codigo,\n      ts.ScriptTarget.Latest,\n      /*setParentNodes*/ false,\n      tsx ? ts.ScriptKind.TSX : ts.ScriptKind.TS,\n    );\n    // Retorna AST do TS como extra; suficiente para gerar sentinel no pipeline\n    return wrapMinimal(tsx ? 'tsx-tsc' : 'ts-tsc', {\n      kind: sf.kind,\n      statements: sf.statements?.length ?? 0,\n    });\n  } catch (e) {\n    logCore.erroTs((e as Error).message, getCurrentParsingFile());\n    return null;\n  }\n}\n\nfunction parseComXml(codigo: string) {\n  try {\n    const parser = new XMLParser({\n      ignoreAttributes: false,\n      attributeNamePrefix: '@',\n    });\n    const ast = parser.parse(codigo);\n    return wrapMinimal('xml', ast);\n  } catch (e) {\n    logCore.erroXml((e as Error).message, getCurrentParsingFile());\n    return null;\n  }\n}\n\nfunction parseComPhp(codigo: string) {\n  // Heur√≠stica simples para PHP: extrai classes, fun√ß√µes e namespaces\n  const classes = Array.from(codigo.matchAll(/\\bclass\\s+([A-Za-z0-9_]+)/g)).map(\n    (m) => m[1],\n  );\n  const functions = Array.from(\n    codigo.matchAll(/\\bfunction\\s+([A-Za-z0-9_]+)/g),\n  ).map((m) => m[1]);\n  const namespaces = Array.from(\n    codigo.matchAll(/\\bnamespace\\s+([A-Za-z0-9_\\\\]+)/g),\n  ).map((m) => m[1]);\n  log.debug(\n    `üêò PHP pseudo-parse: ${classes.length} classes, ${functions.length} fun√ß√µes`,\n  );\n  return wrapMinimal('php', { classes, functions, namespaces });\n}\n\nfunction parseComPython(codigo: string) {\n  // Heur√≠stica simples para Python: extrai classes e fun√ß√µes (def)\n  const classes = Array.from(codigo.matchAll(/^class\\s+([A-Za-z0-9_]+)/gm)).map(\n    (m) => m[1],\n  );\n  const functions = Array.from(codigo.matchAll(/^def\\s+([A-Za-z0-9_]+)/gm)).map(\n    (m) => m[1],\n  );\n  log.debug(\n    `üêç Python pseudo-parse: ${classes.length} classes, ${functions.length} fun√ß√µes`,\n  );\n  return wrapMinimal('python', { classes, functions });\n}\n\nfunction parseComHtmlFunc(codigo: string) {\n  try {\n    const dom = parseDocument(codigo, { xmlMode: false });\n    return wrapMinimal('html', dom as unknown as ParserRawAst);\n  } catch (e) {\n    logCore.erroHtml((e as Error).message, getCurrentParsingFile());\n    return null;\n  }\n}\n\nfunction parseComVue(codigo: string) {\n  try {\n    // Extrair blocos do arquivo Vue\n    const templateMatch = codigo.match(\n      /<template\\b[^>]*>([\\s\\S]*?)<\\/template\\b[^>]*>/i,\n    );\n    const scriptMatch = codigo.match(\n      /<script\\b[^>]*>([\\s\\S]*?)<\\/script\\b[^>]*>/i,\n    );\n    const styleMatch = codigo.match(\n      /<style\\b[^>]*>([\\s\\S]*?)<\\/style\\b[^>]*>/i,\n    );\n\n    const template = templateMatch ? templateMatch[1].trim() : '';\n    const script = scriptMatch ? scriptMatch[1].trim() : '';\n    const style = styleMatch ? styleMatch[1].trim() : '';\n\n    // Analisar script como TypeScript/JavaScript se presente\n    if (script) {\n      try {\n        babelParse(script, {\n          sourceType: 'module',\n          plugins: ['typescript', 'jsx'],\n          allowImportExportEverywhere: true,\n        });\n      } catch {\n        // Fallback para JS se TS falhar\n        try {\n          babelParse(script, {\n            sourceType: 'module',\n            plugins: ['jsx'],\n            allowImportExportEverywhere: true,\n          });\n        } catch {\n          // Ignorar erros de parsing do script\n        }\n      }\n    }\n\n    // Analisar template como HTML se presente\n    if (template) {\n      try {\n        parseDocument(template, { xmlMode: false });\n      } catch {\n        // Ignorar erros de parsing do template\n      }\n    }\n\n    // Analisar style como CSS se presente\n    if (style) {\n      try {\n        csstree.parse(style, { positions: false });\n      } catch {\n        // Ignorar erros de parsing do style\n      }\n    }\n\n    return wrapMinimal('vue', {\n      template: template ? 'present' : null,\n      script: script ? 'present' : null,\n      style: style ? 'present' : null,\n      hasTemplate: !!template,\n      hasScript: !!script,\n      hasStyle: !!style,\n      templateContent: template,\n      scriptContent: script,\n      styleContent: style,\n    });\n  } catch (e) {\n    logCore.erroHtml((e as Error).message, getCurrentParsingFile());\n    return null;\n  }\n}\n\nfunction parseComCss(codigo: string) {\n  try {\n    const ast = csstree.parse(codigo, { positions: false });\n    return wrapMinimal('css', ast);\n  } catch (e) {\n    logCore.erroCss((e as Error).message, getCurrentParsingFile());\n    return null;\n  }\n}\n\nexport const PARSERS = new Map<string, ParserFunc>([\n  ['.js', parseComBabel],\n  ['.jsx', parseComBabel],\n  ['.ts', parseComBabel],\n  ['.tsx', parseComBabel],\n  ['.mjs', parseComBabel],\n  ['.cjs', parseComBabel],\n  // Evitamos .d.ts explicitamente: n√£o h√° AST √∫til para nossas an√°lises\n  ['.d.ts', () => null],\n  ['.xml', parseComXml],\n  ['.html', parseComHtmlFunc],\n  ['.htm', parseComHtmlFunc],\n  ['.vue', parseComVue],\n  ['.css', parseComCss],\n  ['.php', parseComPhp],\n  ['.py', parseComPython],\n]);\n\nexport const EXTENSOES_SUPORTADAS = Array.from(PARSERS.keys()).filter(\n  (ext) => ext !== '.d.ts',\n);\n\nexport async function decifrarSintaxe(\n  codigo: string,\n  ext: string,\n  opts: DecifrarSintaxeOpts = {},\n): Promise<BabelFile | null> {\n  // Setar arquivo atual para logs de erro\n  setCurrentParsingFile(opts.relPath);\n\n  const parser = PARSERS.get(ext);\n  if (!parser) {\n    logCore.nenhumParser(ext);\n    return null;\n  }\n\n  // Curto-circuito para TS/TSX: se o chamador forneceu plugins e eles n√£o incluem 'typescript'\n  // (ou incluem 'flow'), evitamos Babel para n√£o aceitar sintaxe TS como Flow e for√ßamos o\n  // compilador do TypeScript. Isso garante ast.oraculoExtra.lang = 'ts-tsc'|'tsx-tsc'.\n  if (ext === '.ts' || ext === '.tsx') {\n    const p = opts.plugins;\n    if (Array.isArray(p)) {\n      const lower = p.map((x) => String(x).toLowerCase());\n      const hasTs = lower.includes('typescript');\n      const hasFlow = lower.includes('flow');\n      if (!hasTs || hasFlow) {\n        const tsx = ext === '.tsx';\n        const tsParsed = parseComTypeScript(codigo, tsx);\n        if (tsParsed) {\n          setCurrentParsingFile(undefined);\n          return Promise.resolve(tsParsed as unknown as BabelFile);\n        }\n        // Se o compilador TS falhar, ca√≠mos no fluxo normal para tentar Babel\n      }\n    }\n  }\n\n  // Primeira tentativa com plugins padr√£o (ou fornecidos)\n  let parseResult;\n  if (parser === parseComBabel) {\n    parseResult = parseComBabel(codigo, opts.plugins);\n  } else {\n    parseResult = parser(codigo, opts.plugins);\n  }\n  // Fallbacks espec√≠ficos para .js/.mjs: tentar Flow quando a primeira tentativa falhar\n  if (\n    parseResult == null &&\n    (ext === '.js' || ext === '.mjs' || ext === '.cjs')\n  ) {\n    try {\n      // Heur√≠stica r√°pida: detecta uso de Flow\n      const pareceFlow =\n        /\\b/.test(codigo) || /\\bimport\\s+type\\b/.test(codigo);\n      if (pareceFlow) {\n        const flowPlugins = [\n          'flow',\n          'jsx',\n          'decorators-legacy',\n          'importAttributes',\n          'importAssertions',\n          'classProperties',\n          'classPrivateProperties',\n          'classPrivateMethods',\n          'optionalChaining',\n          'nullishCoalescingOperator',\n          'topLevelAwait',\n        ];\n        parseResult = parseComBabel(codigo, flowPlugins);\n      }\n      // Se ainda nulo e n√£o parece Flow, tenta um conjunto \"JS moderno\" sem TypeScript (para .js puros)\n      if (parseResult == null) {\n        const jsModernPlugins = [\n          'jsx',\n          'decorators-legacy',\n          'importAttributes',\n          'importAssertions',\n          'classProperties',\n          'classPrivateProperties',\n          'classPrivateMethods',\n          'optionalChaining',\n          'nullishCoalescingOperator',\n          'topLevelAwait',\n        ];\n        parseResult = parseComBabel(codigo, jsModernPlugins);\n      }\n    } catch {\n      // mant√©m null\n    }\n  }\n\n  // Fallback usando TypeScript compiler quando Babel falhar em .ts/.tsx\n  if (parseResult == null && (ext === '.ts' || ext === '.tsx')) {\n    const tsx = ext === '.tsx';\n    const tsParsed = parseComTypeScript(codigo, tsx);\n    if (tsParsed) {\n      setCurrentParsingFile(undefined);\n      return Promise.resolve(tsParsed as unknown as BabelFile);\n    }\n  }\n\n  // Caso especial: se plugins foram passados e o parser de .ts/.tsx retornou null,\n  // for√ßa fallback para o compilador TS (cobre cen√°rios de plugins conflitantes como 'flow').\n  if (\n    parseResult == null &&\n    opts.plugins &&\n    (ext === '.ts' || ext === '.tsx')\n  ) {\n    const tsx = ext === '.tsx';\n    const tsParsed = parseComTypeScript(codigo, tsx);\n    if (tsParsed) {\n      setCurrentParsingFile(undefined);\n      return Promise.resolve(tsParsed as unknown as BabelFile);\n    }\n  }\n\n  if (opts.timeoutMs) {\n    return (async () => {\n      let timer: NodeJS.Timeout | null = null;\n      try {\n        const race = Promise.race([\n          Promise.resolve(parseResult),\n          new Promise<null>((resolve) => {\n            timer = setTimeout(() => {\n              logCore.timeoutParsing(opts.timeoutMs || 0, ext);\n              resolve(null);\n            }, opts.timeoutMs);\n          }),\n        ]);\n        return await race;\n      } finally {\n        if (timer) clearTimeout(timer);\n        setCurrentParsingFile(undefined);\n      }\n    })();\n  }\n\n  // Se ainda assim for null, normalize para null expl√≠cito\n  setCurrentParsingFile(undefined);\n  return Promise.resolve(parseResult ?? null);\n}\n\nfunction initializePluginSystem() {\n  const registry = getGlobalRegistry();\n\n  // Registra todos os plugins padr√£o se ainda n√£o foram registrados\n  const registeredPlugins = registry.getRegisteredPlugins();\n  if (registeredPlugins.length === 0) {\n    initializeDefaultPlugins();\n    log.debug('üîå Plugins padr√£o registrados no sistema');\n  }\n}\n\n/**\n * Parse usando o novo sistema de plugins (API futura)\n * Mant√©m compatibilidade com sistema atual\n */\n\nexport async function parseComPlugins(\n  codigo: string,\n  extensao: string,\n  opts?: PluginParserOptions,\n): Promise<BabelFile | null> {\n  try {\n    initializePluginSystem();\n\n    const registry = getGlobalRegistry();\n    const plugin = await registry.getPluginForExtension(extensao);\n\n    if (!plugin) {\n      logCore.pluginNaoEncontrado(extensao);\n      // Fallback para sistema atual usando a fun√ß√£o exportada\n      return await decifrarSintaxe(codigo, extensao, {\n        plugins: opts?.plugins,\n        timeoutMs: opts?.timeoutMs,\n      });\n    }\n\n    logCore.usandoPlugin(plugin.name, extensao);\n\n    const pluginOpts: PluginParserOptions = {\n      ...opts,\n      pluginConfig: {\n        ...opts?.pluginConfig,\n        extension: extensao,\n      },\n    };\n\n    const result = await plugin.parse(codigo, pluginOpts);\n    return result;\n  } catch (error) {\n    logCore.sistemaPluginsFalhou((error as Error).message);\n    // Fallback para sistema atual em caso de erro\n    return await decifrarSintaxe(codigo, extensao, {\n      plugins: opts?.plugins,\n      timeoutMs: opts?.timeoutMs,\n    });\n  }\n}\n\n/**\n * Obt√©m estat√≠sticas do sistema de plugins\n */\n\nexport function getPluginStats(): {\n  pluginsRegistrados: number;\n  extensoesSuportadas: number;\n  sistemAtivojava: boolean;\n} {\n  try {\n    initializePluginSystem();\n    const registry = getGlobalRegistry();\n    const stats = registry.getStats();\n\n    return {\n      pluginsRegistrados: stats.pluginsRegistrados,\n      extensoesSuportadas: stats.extensoesSuportadas,\n      sistemAtivojava: stats.pluginsRegistrados > 0,\n    };\n  } catch {\n    return {\n      pluginsRegistrados: 0,\n      extensoesSuportadas: 0,\n      sistemAtivojava: false,\n    };\n  }\n}\n"]}