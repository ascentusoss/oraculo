{"version":3,"file":"executor.js","sourceRoot":"","sources":["../../../src/core/execution/executor.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport crypto from 'node:crypto';\n\nimport { config } from '@core/config/config.js';\nimport { formatMs } from '@core/config/format.js';\nimport { log, logCore } from '@core/messages/index.js';\nimport { logAnalistas } from '@core/messages/log/log-helper.js';\nimport { WorkerPool } from '@core/workers/worker-pool.js';\nimport { lerEstado, salvarEstado } from '@shared/persistence/persistencia.js';\nimport XXH from 'xxhashjs';\n\nimport type {\n  ContextoExecucao,\n  EstadoIncremental,\n  FileEntryWithAst,\n  GuardianResult,\n  MetricaAnalista,\n  MetricaExecucao,\n  MetricasGlobais,\n  Ocorrencia,\n  ResultadoInquisicao,\n  Tecnica,\n} from '@';\nimport { ocorrenciaErroAnalista } from '@';\n// Fallback para infoDestaque quando mock de log n√£o implementa\nconst __infoD = (msg: string) => {\n  const l = log as unknown as {\n    infoDestaque?: (m: string) => void;\n    info: (m: string) => void;\n  };\n  if (typeof l.infoDestaque === 'function') return l.infoDestaque(msg);\n  return l.info(msg);\n};\n\nexport async function executarInquisicao(\n  fileEntriesComAst: FileEntryWithAst[],\n  tecnicas: Tecnica[],\n  baseDir: string,\n  guardianResultado: GuardianResult,\n  opts?: { verbose?: boolean; compact?: boolean; fast?: boolean },\n): Promise<ResultadoInquisicao> {\n  const ocorrencias: Ocorrencia[] = [];\n  const metricasAnalistas: MetricaAnalista[] = [];\n  const arquivosValidosSet = new Set(fileEntriesComAst.map((f) => f.relPath));\n  const contextoGlobal: ContextoExecucao = {\n    baseDir,\n    arquivos: fileEntriesComAst,\n    ambiente: {\n      arquivosValidosSet,\n      guardian: guardianResultado,\n    },\n  };\n  const inicioExecucao = performance.now();\n\n  // Narrowing helper: detecta se um objeto se parece com NodePath do babel\n  function isNodePath(\n    x: unknown, // Type guard intencional: aceita entrada arbitr√°ria para valida√ß√£o estrutural\n  ): x is import('@babel/traverse').NodePath<import('@babel/types').Node> {\n    if (typeof x !== 'object' || x === null) return false;\n    const maybe = x as Record<string, unknown>;\n    if (!('node' in maybe)) return false;\n    const node = maybe.node as unknown;\n    if (typeof node !== 'object' || node === null) return false;\n    return 'type' in (node as Record<string, unknown>);\n  }\n\n  // Incremental: carregar estado anterior (tipo importado de @types)\n  let estadoIncremental: EstadoIncremental | null = null;\n  if (config.ANALISE_INCREMENTAL_ENABLED) {\n    const lido = await lerEstado<EstadoIncremental>(\n      config.ANALISE_INCREMENTAL_STATE_PATH,\n    ).catch(() => null);\n    if (lido && lido.versao === config.ANALISE_INCREMENTAL_VERSION)\n      estadoIncremental = lido;\n  }\n  const novoEstado: EstadoIncremental = {\n    versao: config.ANALISE_INCREMENTAL_VERSION,\n    arquivos: {},\n    estatisticas: {\n      totalReaproveitamentos: 0,\n      totalArquivosProcessados: 0,\n      ultimaDuracaoMs: 0,\n    },\n  };\n\n  function hashConteudo(c: string) {\n    try {\n      // Usa xxhash64 (seed arbitr√°ria) para performance\n      return XXH.h64(c, 0xabcd).toString(16);\n    } catch {\n      // Fallback para SHA1 se algo der errado\n      // SHA1 usado apenas para cache de AST (fingerprinting de conte√∫do)\n      // N√£o √© usado para seguran√ßa/criptografia - contexto: deduplica√ß√£o de parsing\n      return crypto.createHash('sha1').update(c).digest('hex');\n    }\n  }\n\n  // T√©cnicas globais\n  for (const tecnica of tecnicas) {\n    if (tecnica.global) {\n      // in√≠cio medido apenas por analista espec√≠fico (inicioAnalista)\n      const timeoutMs = config.ANALISE_TIMEOUT_POR_ANALISTA_MS;\n      try {\n        const inicioAnalista = performance.now();\n\n        // Implementa timeout para analistas globais se configurado\n        let resultado: Awaited<ReturnType<typeof tecnica.aplicar>> | undefined;\n\n        if (timeoutMs > 0) {\n          // Promise.race entre execu√ß√£o do analista global e timeout\n          const execPromise = tecnica.aplicar(\n            '',\n            '',\n            null,\n            undefined,\n            contextoGlobal,\n          );\n          resultado = await (async () => {\n            let timer: NodeJS.Timeout | null = null;\n            try {\n              const race = Promise.race([\n                execPromise,\n                new Promise<never>((_, reject) => {\n                  timer = setTimeout(\n                    () =>\n                      reject(\n                        new Error(\n                          `Timeout: analista global '${tecnica.nome}' excedeu ${timeoutMs}ms`,\n                        ),\n                      ),\n                    timeoutMs,\n                  );\n                }),\n              ]);\n              return await race;\n            } finally {\n              if (timer) clearTimeout(timer);\n            }\n          })();\n        } else {\n          // Execu√ß√£o sem timeout\n          resultado = await tecnica.aplicar(\n            '',\n            '',\n            null,\n            undefined,\n            contextoGlobal,\n          );\n        }\n\n        if (Array.isArray(resultado)) {\n          ocorrencias.push(...resultado);\n        }\n\n        const duracaoMs = performance.now() - inicioAnalista;\n        if (config.ANALISE_METRICAS_ENABLED) {\n          metricasAnalistas.push({\n            nome: tecnica.nome || 'desconhecido',\n            duracaoMs,\n            ocorrencias: Array.isArray(resultado)\n              ? resultado.length\n              : resultado\n                ? 1\n                : 0,\n            global: true,\n          });\n        }\n        if (opts?.verbose) {\n          log.sucesso(`T√©cnica global \"${tecnica.nome}\"`);\n        }\n        if (config.LOG_ESTRUTURADO) {\n          log.info(\n            JSON.stringify({\n              tipo: 'analista',\n              escopo: 'global',\n              nome: tecnica.nome,\n              duracaoMs,\n              ocorrencias: metricasAnalistas.at(-1)?.ocorrencias,\n            }),\n          );\n        }\n      } catch (error) {\n        const err = error as Error;\n        const isTimeout = err.message.includes('Timeout: analista global');\n        const nivelLog = isTimeout ? 'aviso' : 'erro';\n        const prefixo = isTimeout ? '‚è∞' : '‚ùå';\n\n        // Log apropriado baseado no tipo de erro\n        if (nivelLog === 'aviso') {\n          log.aviso(`${prefixo} ${err.message}`);\n        } else {\n          log.erro(\n            `${prefixo} Erro na t√©cnica global '${tecnica.nome}': ${err.message}`,\n          );\n          // Exibe stack trace em modo verbose ou debug\n          if (err.stack) {\n            if (opts?.verbose || config.DEV_MODE) {\n              log.info('Stack trace:');\n              log.info(err.stack);\n            }\n          }\n        }\n\n        // Registra ocorr√™ncia de erro/timeout\n        ocorrencias.push(\n          ocorrenciaErroAnalista({\n            mensagem: isTimeout\n              ? `Timeout na t√©cnica global '${tecnica.nome}': ${timeoutMs}ms excedido`\n              : `Falha na t√©cnica global '${tecnica.nome}': ${err.message}`,\n            relPath: '[execu√ß√£o global]',\n            origem: tecnica.nome,\n            stack: !isTimeout && err.stack ? err.stack : undefined,\n          }),\n        );\n      }\n    }\n  }\n\n  // Modo Fast: usar WorkerPool para processamento paralelo\n  if (opts?.fast && fileEntriesComAst.length > 0) {\n    log.info('üöÄ Modo r√°pido ativado: processamento paralelo com Workers');\n\n    const workerPool = new WorkerPool({\n      enabled: true,\n      maxWorkers: config.WORKER_POOL_MAX_WORKERS || undefined,\n      batchSize: 10,\n      timeoutMs: config.ANALISE_TIMEOUT_POR_ANALISTA_MS,\n    });\n\n    const resultadoWorkers = await workerPool.processFiles(\n      fileEntriesComAst,\n      tecnicas.filter((t) => !t.global), // Apenas t√©cnicas n√£o-globais\n      contextoGlobal,\n    );\n\n    ocorrencias.push(...resultadoWorkers.occurrences);\n    metricasAnalistas.push(...resultadoWorkers.metrics);\n\n    const duracaoTotal = performance.now() - inicioExecucao;\n    log.sucesso(\n      `‚úÖ An√°lise r√°pida conclu√≠da: ${fileEntriesComAst.length} arquivos em ${formatMs(duracaoTotal)}`,\n    );\n\n    // Salvar estado incremental (se habilitado)\n    if (config.ANALISE_INCREMENTAL_ENABLED) {\n      try {\n        for (const entry of fileEntriesComAst) {\n          const hash = hashConteudo(entry.content ?? '');\n          novoEstado.arquivos[entry.relPath] = {\n            hash,\n            ocorrencias: [],\n            reaproveitadoCount: 0,\n          };\n        }\n        if (novoEstado.estatisticas) {\n          novoEstado.estatisticas.totalArquivosProcessados =\n            fileEntriesComAst.length;\n          novoEstado.estatisticas.ultimaDuracaoMs = duracaoTotal;\n        }\n        await salvarEstado(config.ANALISE_INCREMENTAL_STATE_PATH, novoEstado);\n      } catch {\n        /* Ignora erro ao salvar cache */\n      }\n    }\n\n    const metricasExecucao: MetricaExecucao = {\n      totalArquivos: fileEntriesComAst.length,\n      tempoTotal: duracaoTotal,\n      ocorrenciasEncontradas: ocorrencias.length,\n      analistas: metricasAnalistas,\n      workerPool: {\n        workersAtivos: resultadoWorkers.totalProcessed,\n        duracaoTotalMs: resultadoWorkers.duration,\n      },\n    };\n\n    // Retorna resultado do processamento paralelo\n    return {\n      totalArquivos: fileEntriesComAst.length,\n      arquivosAnalisados: fileEntriesComAst.map((e) => e.relPath),\n      ocorrencias,\n      timestamp: Date.now(),\n      duracaoMs: duracaoTotal,\n      metricas: metricasExecucao,\n    };\n  }\n\n  // T√©cnicas por arquivo (modo sequencial padr√£o)\n  let arquivoAtual = 0;\n  const totalArquivos = fileEntriesComAst.length;\n  // Limiar para logs detalhados por arquivo\n  const LIMIAR_DETALHE_TOTAL = 100; // at√© aqui permite detalhar por arquivo\n  const LIMIAR_DETALHE_THROTTLED_MAX = 250; // at√© aqui permite \"Arquivo X/Y\" com throttle\n  // Define passo de logging quando em modo verbose para evitar spam massivo\n\n  function passoDeLog(total: number): number {\n    // Assumimos faixas: at√© 100 => cada arquivo; 101-250 => a cada 10; 251-500 => a cada 25; >500 => a cada 100\n    if (total <= 100) return 1;\n    if (total <= 250) return 10;\n    if (total <= 500) return 25;\n    return 100;\n  }\n  const frames = ['->', '=>', '>>', '=>'] as const;\n  const stepVerbose = passoDeLog(totalArquivos);\n  const detalharPorArquivo =\n    (opts?.verbose ?? false) && totalArquivos <= LIMIAR_DETALHE_TOTAL;\n  const permitirArquivoXY =\n    (opts?.verbose ?? false) && totalArquivos <= LIMIAR_DETALHE_THROTTLED_MAX;\n\n  // üéØ Inicializa sistema de logs inteligente\n  logAnalistas.iniciarBatch(totalArquivos);\n\n  for (const entry of fileEntriesComAst) {\n    arquivoAtual++;\n    if (opts?.compact) {\n      if (arquivoAtual === totalArquivos) {\n        log.info(`Arquivos analisados: ${totalArquivos}`);\n      }\n    } else if (opts?.verbose) {\n      // Em verbose: detalha por arquivo somente at√© o limiar; entre 101-250 mostra \"Arquivo X/Y\" com throttle; acima disso, s√≥ resumo de progresso.\n      if (permitirArquivoXY) {\n        if (\n          arquivoAtual === 1 ||\n          arquivoAtual % stepVerbose === 0 ||\n          arquivoAtual === totalArquivos\n        ) {\n          const seta = frames[arquivoAtual % frames.length];\n          log.info(\n            `${seta} Arquivo ${arquivoAtual}/${totalArquivos}: ${entry.relPath}`,\n          );\n        }\n      } else {\n        if (\n          arquivoAtual === 1 ||\n          arquivoAtual % stepVerbose === 0 ||\n          arquivoAtual === totalArquivos\n        ) {\n          log.info(`Arquivos analisados: ${arquivoAtual}/${totalArquivos}`);\n        }\n      }\n    } else if (arquivoAtual % 50 === 0 || arquivoAtual === totalArquivos) {\n      // Modo padr√£o: log apenas a cada 50 arquivos para reduzir ru√≠do\n      if (arquivoAtual === totalArquivos) {\n        __infoD(`Arquivos analisados: ${arquivoAtual}/${totalArquivos}`);\n      }\n    }\n    // Verifica incremento\n    const conteudo = entry.content ?? '';\n    const h = hashConteudo(conteudo);\n    const cacheAnterior = estadoIncremental?.arquivos[entry.relPath];\n    let reaproveitou = false;\n    if (\n      config.ANALISE_INCREMENTAL_ENABLED &&\n      cacheAnterior &&\n      cacheAnterior.hash === h\n    ) {\n      // Reaproveita ocorr√™ncias anteriores do arquivo\n      ocorrencias.push(...cacheAnterior.ocorrencias);\n      novoEstado.arquivos[entry.relPath] = cacheAnterior; // mant√©m\n      novoEstado.arquivos[entry.relPath].reaproveitadoCount =\n        (cacheAnterior.reaproveitadoCount || 0) + 1;\n      if (novoEstado.estatisticas) {\n        novoEstado.estatisticas.totalReaproveitamentos =\n          (novoEstado.estatisticas.totalReaproveitamentos || 0) + 1;\n      }\n      reaproveitou = true;\n      if (detalharPorArquivo) logCore.reaproveitadoIncremental(entry.relPath);\n      if (config.LOG_ESTRUTURADO) {\n        log.info(\n          JSON.stringify({\n            tipo: 'incremental-reuse',\n            arquivo: entry.relPath,\n            ocorrencias: cacheAnterior.ocorrencias.length,\n          }),\n        );\n      }\n    }\n    if (reaproveitou) continue; // pula analistas\n\n    for (const tecnica of tecnicas) {\n      if (tecnica.global) continue;\n      if (tecnica.test && !tecnica.test(entry.relPath)) continue;\n      // in√≠cio medido apenas por analista espec√≠fico (inicioAnalista)\n      const timeoutMs = config.ANALISE_TIMEOUT_POR_ANALISTA_MS;\n      try {\n        const inicioAnalista = performance.now();\n\n        // Log adaptativo: in√≠cio da an√°lise\n        const tamanhoArquivo = entry.content\n          ? Math.round(entry.content.length / 1024)\n          : 0;\n        logAnalistas.iniciandoAnalista(\n          tecnica.nome || 'analista-desconhecido',\n          entry.relPath,\n          tamanhoArquivo,\n        );\n\n        // Implementa timeout por analista se configurado\n        let resultado: Awaited<ReturnType<typeof tecnica.aplicar>> | undefined;\n\n        if (timeoutMs > 0) {\n          // Promise.race entre execu√ß√£o do analista e timeout\n          const astParam = isNodePath(entry.ast)\n            ? (entry.ast as import('@babel/traverse').NodePath<\n                import('@babel/types').Node\n              >)\n            : null;\n          const execPromise = tecnica.aplicar(\n            entry.content ?? '',\n            entry.relPath,\n            astParam,\n            entry.fullPath,\n            contextoGlobal,\n          );\n          resultado = await (async () => {\n            let timer: NodeJS.Timeout | null = null;\n            try {\n              const race = Promise.race([\n                execPromise,\n                new Promise<never>((_, reject) => {\n                  timer = setTimeout(\n                    () =>\n                      reject(\n                        new Error(\n                          `Timeout: analista '${tecnica.nome}' excedeu ${timeoutMs}ms para ${entry.relPath}`,\n                        ),\n                      ),\n                    timeoutMs,\n                  );\n                }),\n              ]);\n              return await race;\n            } finally {\n              if (timer) clearTimeout(timer);\n            }\n          })();\n        } else {\n          // Execu√ß√£o sem timeout\n          const astParam2 = isNodePath(entry.ast)\n            ? (entry.ast as import('@babel/traverse').NodePath<\n                import('@babel/types').Node\n              >)\n            : null;\n          resultado = await tecnica.aplicar(\n            entry.content ?? '',\n            entry.relPath,\n            astParam2,\n            entry.fullPath,\n            contextoGlobal,\n          );\n        }\n\n        if (Array.isArray(resultado)) {\n          ocorrencias.push(...resultado);\n        }\n\n        const duracaoMs = performance.now() - inicioAnalista;\n        if (config.ANALISE_METRICAS_ENABLED) {\n          metricasAnalistas.push({\n            nome: tecnica.nome || 'desconhecido',\n            duracaoMs,\n            ocorrencias: Array.isArray(resultado)\n              ? resultado.length\n              : resultado\n                ? 1\n                : 0,\n            global: false,\n          });\n        }\n\n        // Log adaptativo: conclus√£o da an√°lise\n        const ocorrenciasCount = Array.isArray(resultado)\n          ? resultado.length\n          : resultado\n            ? 1\n            : 0;\n        logAnalistas.concluido(\n          tecnica.nome || 'analista-desconhecido',\n          entry.relPath,\n          ocorrenciasCount,\n          duracaoMs,\n        );\n\n        if (detalharPorArquivo) {\n          log.info(\n            `üìÑ '${tecnica.nome}' analisou ${entry.relPath} em ${formatMs(duracaoMs)}`,\n          );\n        }\n        if (config.LOG_ESTRUTURADO) {\n          log.info(\n            JSON.stringify({\n              tipo: 'analista',\n              arquivo: entry.relPath,\n              nome: tecnica.nome,\n              duracaoMs,\n              ocorrencias: metricasAnalistas.at(-1)?.ocorrencias,\n            }),\n          );\n        }\n      } catch (error) {\n        const err = error as Error;\n        const isTimeout = err.message.includes('Timeout: analista');\n        const nivelLog = isTimeout ? 'aviso' : 'erro';\n        const prefixo = isTimeout ? '‚è∞' : '‚ùå';\n\n        // Log adaptativo para erros e timeouts\n        if (isTimeout) {\n          const duracaoEstimada =\n            config.ANALISE_TIMEOUT_POR_ANALISTA_MS || 30000;\n          logAnalistas.timeout(\n            tecnica.nome || 'analista-desconhecido',\n            duracaoEstimada,\n          );\n        } else {\n          logAnalistas.erro(\n            tecnica.nome || 'analista-desconhecido',\n            err.message,\n          );\n        }\n\n        // Log apropriado baseado no tipo de erro\n        if (nivelLog === 'aviso') {\n          log.aviso(`${prefixo} ${err.message}`);\n        } else {\n          log.erro(\n            `${prefixo} Erro em '${tecnica.nome}' para ${entry.relPath}: ${err.message}`,\n          );\n          // Exibe stack trace em modo verbose ou debug\n          if (err.stack) {\n            if (opts?.verbose || config.DEV_MODE) {\n              log.info('Stack trace:');\n              log.info(err.stack);\n            }\n          }\n        }\n\n        // Registra ocorr√™ncia de erro/timeout com stack trace\n        ocorrencias.push(\n          ocorrenciaErroAnalista({\n            mensagem: isTimeout\n              ? `Timeout na t√©cnica '${tecnica.nome}' para ${entry.relPath}: ${timeoutMs}ms excedido`\n              : `Falha na t√©cnica '${tecnica.nome}' para ${entry.relPath}: ${err.message}`,\n            relPath: entry.relPath,\n            origem: tecnica.nome,\n            stack: !isTimeout && err.stack ? err.stack : undefined,\n          }),\n        );\n      }\n    }\n    // Salva estado incremental do arquivo processado\n    if (config.ANALISE_INCREMENTAL_ENABLED) {\n      const ocorrArq = ocorrencias.filter((o) => o.relPath === entry.relPath);\n      // Extrai m√©tricas por analista espec√≠ficas do arquivo\n      const analistasArquivo: Record<\n        string,\n        { ocorrencias: number; duracaoMs: number }\n      > = {};\n      for (const m of metricasAnalistas.filter((m) => !m.global)) {\n        analistasArquivo[m.nome] = {\n          ocorrencias: m.ocorrencias,\n          duracaoMs: m.duracaoMs,\n        };\n      }\n      novoEstado.arquivos[entry.relPath] = {\n        hash: h,\n        ocorrencias: ocorrArq,\n        analistas: analistasArquivo,\n        ultimaExecucaoMs: Date.now(),\n        reaproveitadoCount: 0,\n      };\n      if (novoEstado.estatisticas) {\n        novoEstado.estatisticas.totalArquivosProcessados =\n          (novoEstado.estatisticas.totalArquivosProcessados || 0) + 1;\n      }\n    }\n\n    // üéØ NOVO: Atualiza progresso por arquivo (n√£o por analista)\n    logAnalistas.arquivoProcessado();\n  }\n\n  const fimExecucao = performance.now();\n  const duracaoMs = Math.round(fimExecucao - inicioExecucao);\n\n  // üéØ Finaliza sistema de logs inteligente\n  logAnalistas.finalizarBatch(ocorrencias.length, duracaoMs);\n\n  // Agrega√ß√£o de m√©tricas\n  let metricasExecucao: MetricaExecucao | null = null;\n  if (config.ANALISE_METRICAS_ENABLED) {\n    const metricasGlobais: MetricasGlobais = ((\n      globalThis as unknown as Record<string, unknown>\n    ).__ORACULO_METRICAS__ as MetricasGlobais) || {\n      parsingTimeMs: 0,\n      cacheHits: 0,\n      cacheMiss: 0,\n    };\n    metricasExecucao = {\n      totalArquivos: fileEntriesComAst.length,\n      tempoParsingMs: Math.round(metricasGlobais.parsingTimeMs),\n      tempoAnaliseMs: duracaoMs,\n      cacheAstHits: metricasGlobais.cacheHits,\n      cacheAstMiss: metricasGlobais.cacheMiss,\n      analistas: metricasAnalistas,\n    };\n    if (config.LOG_ESTRUTURADO) {\n      log.info(JSON.stringify({ tipo: 'metricas', ...metricasExecucao }));\n    }\n    // Persistir hist√≥rico\n    try {\n      const historicoPath = config.ANALISE_METRICAS_HISTORICO_PATH as\n        | string\n        | undefined;\n      if (historicoPath) {\n        type RegistroHistorico = MetricaExecucao & { timestamp: number };\n        const anterior = await lerEstado<unknown>(historicoPath).catch(\n          () => [] as RegistroHistorico[],\n        );\n        const lista = Array.isArray(anterior)\n          ? (anterior as RegistroHistorico[])\n          : [];\n        lista.push({ ...metricasExecucao, timestamp: Date.now() });\n        const max = config.ANALISE_METRICAS_HISTORICO_MAX || 200;\n        const recortado = lista.slice(-max);\n        await salvarEstado(historicoPath, recortado);\n      }\n    } catch (e) {\n      // Sempre registra em DEV e tamb√©m em execu√ß√£o normal para visibilidade dos testes\n      log.erro(\n        `Falha ao persistir hist√≥rico de m√©tricas: ${(e as Error).message}`,\n      );\n    }\n  }\n\n  // Persistir incremental\n  if (config.ANALISE_INCREMENTAL_ENABLED) {\n    if (novoEstado.estatisticas) {\n      novoEstado.estatisticas.ultimaDuracaoMs = duracaoMs;\n    }\n    await salvarEstado(config.ANALISE_INCREMENTAL_STATE_PATH, novoEstado);\n    if (config.LOG_ESTRUTURADO) {\n      log.info(\n        JSON.stringify({\n          tipo: 'incremental-salvo',\n          arquivos: Object.keys(novoEstado.arquivos).length,\n          totalReaproveitamentos:\n            novoEstado.estatisticas?.totalReaproveitamentos,\n          processados: novoEstado.estatisticas?.totalArquivosProcessados,\n        }),\n      );\n    }\n  }\n\n  return {\n    totalArquivos: fileEntriesComAst.length,\n    arquivosAnalisados: fileEntriesComAst.map((e) => e.relPath),\n    ocorrencias,\n    timestamp: Date.now(),\n    duracaoMs,\n    metricas: metricasExecucao || undefined,\n  };\n}\n\n// Hook simples para expor √∫ltima m√©trica de execu√ß√£o (consumido por comando perf baseline)\n\nexport function registrarUltimasMetricas(\n  metricas: MetricaExecucao | undefined,\n): void {\n  try {\n    (\n      globalThis as unknown as {\n        __ULTIMAS_METRICAS_ORACULO__?: MetricaExecucao | null;\n      }\n    ).__ULTIMAS_METRICAS_ORACULO__ = metricas || null;\n  } catch {\n    /* ignore */\n  }\n}\n"]}