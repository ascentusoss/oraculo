{"version":3,"file":"validacao.js","sourceRoot":"","sources":["../../../../src/core/config/auto/validacao.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n/**\n * Sistema de validação para correções automáticas\n * Integra com o sistema existente de detectores do Oráculo\n */\n\nimport { log } from '@core/messages/index.js';\n\nimport type { ValidationResult } from '@';\n\n// Re-exporta o tipo para compatibilidade\nexport type { ValidationResult };\n\n/**\n * Valida sintaxe usando verificações robustas baseadas nos detectores existentes\n */\nexport function validateJavaScriptSyntax(code: string): ValidationResult {\n  const result: ValidationResult = {\n    isValid: true,\n    errors: [],\n    warnings: [],\n  };\n\n  try {\n    // 1. Verificações básicas de balanceamento\n    const braceCount =\n      (code.match(/{/g) || []).length - (code.match(/}/g) || []).length;\n    const parenCount =\n      (code.match(/\\(/g) || []).length - (code.match(/\\)/g) || []).length;\n    const bracketCount =\n      (code.match(/\\[/g) || []).length - (code.match(/\\]/g) || []).length;\n\n    if (braceCount !== 0) {\n      result.errors.push(\n        `Chaves desbalanceadas: ${braceCount > 0 ? 'faltam' : 'sobram'} ${Math.abs(braceCount)} chave(s)`,\n      );\n      result.isValid = false;\n    }\n\n    if (parenCount !== 0) {\n      result.errors.push(\n        `Parênteses desbalanceados: ${parenCount > 0 ? 'faltam' : 'sobram'} ${Math.abs(parenCount)} parêntese(s)`,\n      );\n      result.isValid = false;\n    }\n\n    if (bracketCount !== 0) {\n      result.errors.push(\n        `Colchetes desbalanceados: ${bracketCount > 0 ? 'faltam' : 'sobram'} ${Math.abs(bracketCount)} colchete(s)`,\n      );\n      result.isValid = false;\n    }\n\n    // 2. Usar lógica similar ao detector de segurança para try-catch\n    const tryBlocks = (code.match(/try\\s*{/g) || []).length;\n    const catchBlocks = (code.match(/catch\\s*\\(/g) || []).length;\n\n    if (tryBlocks !== catchBlocks) {\n      result.errors.push('Blocos try-catch desbalanceados');\n      result.isValid = false;\n    }\n\n    // 3. Verificar JSDoc órfãos (seguindo padrão dos detectores)\n    // Nota: Verificação simplificada - JSDoc pode aparecer em classes, interfaces, etc\n    const jsdocBlocks = (code.match(/\\/\\*\\*[\\s\\S]*?\\*\\//g) || []).length;\n    const codeStructures = (\n      code.match(\n        /(?:export\\s+)?(?:async\\s+)?(?:function|class|interface|type)\\s+\\w+/g,\n      ) || []\n    ).length;\n\n    // Apenas avisar se houver MUITOS JSDoc órfãos (possível geração automática problemática)\n    if (jsdocBlocks > codeStructures + 5) {\n      result.warnings.push(\n        `Possível poluição de JSDoc: ${jsdocBlocks} blocos para ${codeStructures} estruturas`,\n      );\n    }\n\n    // 4. Verificar imports/exports quebrados\n    const importLines = code\n      .split('\\n')\n      .filter(\n        (line) =>\n          line.trim().startsWith('import') || line.trim().startsWith('export'),\n      );\n\n    for (const line of importLines) {\n      if (\n        !line.trim().endsWith(';') &&\n        !line.includes('from') &&\n        !line.includes('=')\n      ) {\n        result.warnings.push(\n          `Possível import/export malformado: ${line.trim().substring(0, 50)}...`,\n        );\n      }\n    }\n  } catch (error) {\n    result.errors.push(\n      `Erro na validação de sintaxe: ${error instanceof Error ? error.message : String(error)}`,\n    );\n    result.isValid = false;\n  }\n\n  return result;\n}\n\n/**\n * Valida se a correção não introduz problemas conhecidos\n */\nexport function validateQuickFixResult(\n  originalCode: string,\n  fixedCode: string,\n  fixId: string,\n): ValidationResult {\n  const result: ValidationResult = {\n    isValid: true,\n    errors: [],\n    warnings: [],\n  };\n\n  try {\n    // Validar sintaxe do código corrigido\n    const syntaxValidation = validateJavaScriptSyntax(fixedCode);\n    result.errors.push(...syntaxValidation.errors);\n    result.warnings.push(...syntaxValidation.warnings);\n    result.isValid = result.isValid && syntaxValidation.isValid;\n\n    // Validações específicas por tipo de correção\n    switch (fixId) {\n      case 'wrap-async-with-try-catch':\n        // Verificar se o try-catch foi adicionado corretamente\n        if (!fixedCode.includes('try {') || !fixedCode.includes('} catch')) {\n          result.errors.push('Try-catch não foi adicionado corretamente');\n          result.isValid = false;\n        }\n\n        // Verificar se não criamos try-catch aninhados desnecessários\n        const nestedTryCount = (fixedCode.match(/try\\s*{[^}]*try\\s*{/g) || [])\n          .length;\n        if (nestedTryCount > 0) {\n          result.warnings.push('Possível try-catch aninhado desnecessário');\n        }\n        break;\n\n      case 'remove-console-log':\n        // Verificar se o console.log foi comentado corretamente\n        if (\n          fixedCode.includes('console.log(') &&\n          !fixedCode.includes('// console.log(')\n        ) {\n          result.warnings.push(\n            'Console.log pode não ter sido comentado corretamente',\n          );\n        }\n        break;\n\n      case 'fix-dangerous-html':\n        // Verificar se o innerHTML foi substituído corretamente\n        if (\n          fixedCode.includes('innerHTML') &&\n          !fixedCode.includes('textContent')\n        ) {\n          result.warnings.push(\n            'innerHTML pode não ter sido substituído corretamente',\n          );\n        }\n        break;\n    }\n\n    // Verificação geral: o código não deve ter ficado significativamente maior\n    const sizeDiff = fixedCode.length - originalCode.length;\n    if (sizeDiff > originalCode.length * 0.5) {\n      // Mais de 50% de aumento\n      result.warnings.push(\n        `Código aumentou significativamente (${sizeDiff} caracteres)`,\n      );\n    }\n  } catch (error) {\n    result.errors.push(\n      `Erro na validação da correção: ${error instanceof Error ? error.message : String(error)}`,\n    );\n    result.isValid = false;\n  }\n\n  return result;\n}\n\n/**\n * Valida se é seguro aplicar uma correção específica usando heurísticas dos detectores\n */\nexport function isSafeToApplyFix(\n  code: string,\n  fixId: string,\n  match: RegExpMatchArray,\n): boolean {\n  try {\n    // Verificações gerais de segurança\n\n    // 1. Não aplicar em arquivos muito pequenos (possivelmente incompletos)\n    if (code.length < 100) {\n      return false;\n    }\n\n    // 2. Não aplicar se o código tem muitos erros de sintaxe\n    const validation = validateJavaScriptSyntax(code);\n    if (validation.errors.length > 3) {\n      return false;\n    }\n\n    // 3. Verificações específicas baseadas nos detectores existentes\n    switch (fixId) {\n      case 'wrap-async-with-try-catch':\n        // Usar lógica similar ao detector-seguranca.ts para async/await\n        const lines = code.split('\\n');\n        const matchLine = match.index\n          ? code.substring(0, match.index).split('\\n').length - 1\n          : 0;\n\n        // Verificar contexto (mesma lógica do detector de segurança)\n        const contextLines = lines.slice(\n          Math.max(0, matchLine - 5),\n          Math.min(lines.length, matchLine + 5),\n        );\n        const context = contextLines.join(' ');\n\n        // Não aplicar se já tem tratamento de erro próximo\n        if (\n          context.includes('try') ||\n          context.includes('catch') ||\n          context.includes('.catch')\n        ) {\n          return false;\n        }\n\n        // Não aplicar se está em Promise.allSettled (tratamento próprio)\n        if (context.includes('Promise.allSettled')) {\n          return false;\n        }\n        break;\n\n      case 'remove-console-log':\n        // Usar contexto similar aos detectores para verificar se é debug legítimo\n        const beforeMatch = code.substring(\n          Math.max(0, (match.index || 0) - 200),\n          match.index || 0,\n        );\n\n        // Não remover se está em contexto de desenvolvimento/debug\n        if (\n          beforeMatch.includes('debug') ||\n          beforeMatch.includes('DEV_MODE') ||\n          beforeMatch.includes('VERBOSE')\n        ) {\n          return false;\n        }\n        break;\n    }\n\n    return true;\n  } catch (error) {\n    log.aviso(\n      `⚠️ Erro ao validar segurança da correção ${fixId}: ${error instanceof Error ? error.message : String(error)}`,\n    );\n    return false;\n  }\n}\n"]}