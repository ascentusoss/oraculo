{"version":3,"file":"seguranca.js","sourceRoot":"","sources":["../../../src/core/config/seguranca.ts"],"names":[],"mappings":"AACA,OAAO,IAAI,MAAM,WAAW,CAAC;AAI7B,MAAM,UAAU,gBAAgB,CAAC,GAAW;IAC1C,IAAI,CAAC,GAAG;QAAE,OAAO,EAAE,CAAC;IACpB,GAAG,GAAG,GAAG,CAAC,OAAO,CAAC,gBAAgB,EAAE,EAAE,CAAC,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;IAC5D,MAAM,IAAI,GAAG,GAAG,CAAC,OAAO,CAAC,MAAM,EAAE,GAAG,CAAC,CAAC;IACtC,MAAM,SAAS,GAAG,IAAI,CAAC,KAAK,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC;IAC7C,IAAI,SAAS,CAAC,UAAU,CAAC,IAAI,CAAC,EAAE,CAAC;QAE/B,MAAM,OAAO,GAAG,SAAS,CAAC,OAAO,CAAC,WAAW,EAAE,EAAE,CAAC,CAAC;QACnD,OAAO,OAAO,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;IACrC,CAAC;IACD,OAAO,SAAS,CAAC,OAAO,CAAC,MAAM,EAAE,EAAE,CAAC,CAAC;AACvC,CAAC;AAED,MAAM,UAAU,UAAU,CAAC,OAAe,EAAE,IAAY;IACtD,MAAM,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAC,OAAO,EAAE,IAAI,CAAC,CAAC;IACzC,OAAO,CAAC,CAAC,GAAG,IAAI,CAAC,GAAG,CAAC,UAAU,CAAC,IAAI,CAAC,IAAI,CAAC,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,CAAC;AACjE,CAAC;AAED,MAAM,UAAU,oBAAoB,CAClC,OAAe,EACf,SAAiB;IAEjB,IAAI,CAAC;QACH,IAAI,OAAO,SAAS,KAAK,QAAQ,IAAI,CAAC,SAAS,CAAC,IAAI,EAAE,EAAE,CAAC;YACvD,OAAO,EAAE,IAAI,EAAE,2CAA2C,EAAE,CAAC;QAC/D,CAAC;QACD,MAAM,SAAS,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,SAAS,CAAC,CAAC;QACnD,IAAI,CAAC,UAAU,CAAC,OAAO,EAAE,SAAS,CAAC,EAAE,CAAC;YACpC,OAAO,EAAE,IAAI,EAAE,4CAA4C,EAAE,CAAC;QAChE,CAAC;QAED,MAAM,SAAS,GAAG,CAAC,cAAc,EAAE,QAAQ,CAAC,CAAC;QAC7C,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,SAAS,CAAC,CAAC,EAAE,CAAC;YAC9C,OAAO,EAAE,IAAI,EAAE,kCAAkC,EAAE,CAAC;QACtD,CAAC;QACD,OAAO,EAAE,OAAO,EAAE,SAAS,EAAE,CAAC;IAChC,CAAC;IAAC,OAAO,CAAC,EAAE,CAAC;QACX,OAAO,EAAE,IAAI,EAAG,CAAW,CAAC,OAAO,IAAI,MAAM,CAAC,CAAC,CAAC,EAAE,CAAC;IACrD,CAAC;AACH,CAAC;AAED,MAAM,UAAU,iBAAiB,CAAC,MAAc;IAC9C,IAAI,MAAM,CAAC,MAAM,GAAG,GAAG;QAAE,OAAO,KAAK,CAAC;IAEtC,MAAM,WAAW,GAAG,CAAC,MAAM,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,EAAE,CAAC,CAAC,MAAM,CAAC;IACzD,IAAI,WAAW,IAAI,CAAC;QAAE,OAAO,KAAK,CAAC;IACnC,OAAO,IAAI,CAAC;AACd,CAAC;AACD,MAAM,UAAU,kBAAkB,CAAC,OAAiB;IAClD,OAAO,OAAO,CAAC,MAAM,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,iBAAiB,CAAC,CAAC,CAAC,CAAC,CAAC;AACrD,CAAC","sourcesContent":["// SPDX-License-Identifier: MIT\nimport path from 'node:path';\n\n// Normaliza um caminho relativo eliminando tentativas de escape (..), barras duplicadas e separadores inconsistentes\n\nexport function sanitizarRelPath(rel: string): string {\n  if (!rel) return '';\n  rel = rel.replace(/^[A-Za-z]:\\\\?/u, '').replace(/^\\/+/, '');\n  const norm = rel.replace(/\\\\+/g, '/');\n  const collapsed = path.posix.normalize(norm);\n  if (collapsed.startsWith('..')) {\n    // remove todos os prefixos de ../ e barras iniciais resultantes\n    const semDots = collapsed.replace(/^(\\.\\/?)+/, '');\n    return semDots.replace(/^\\/+/, '');\n  }\n  return collapsed.replace(/^\\/+/, '');\n}\n\nexport function estaDentro(baseDir: string, alvo: string): boolean {\n  const rel = path.relative(baseDir, alvo);\n  return !!rel && !rel.startsWith('..') && !path.isAbsolute(rel);\n}\n\nexport function resolverPluginSeguro(\n  baseDir: string,\n  pluginRel: string,\n): { caminho?: string; erro?: string } {\n  try {\n    if (typeof pluginRel !== 'string' || !pluginRel.trim()) {\n      return { erro: 'entrada de plugin inválida (string vazia)' };\n    }\n    const resolvido = path.resolve(baseDir, pluginRel);\n    if (!estaDentro(baseDir, resolvido)) {\n      return { erro: 'plugin fora da raiz do projeto (bloqueado)' };\n    }\n    // Restringe extensões para reduzir risco de execução arbitrária\n    const permitido = [/\\.(c|m)?js$/i, /\\.ts$/i];\n    if (!permitido.some((r) => r.test(resolvido))) {\n      return { erro: 'extensão de plugin não permitida' };\n    }\n    return { caminho: resolvido };\n  } catch (e) {\n    return { erro: (e as Error).message || String(e) };\n  }\n}\n\nexport function validarGlobBasico(padrao: string): boolean {\n  if (padrao.length > 300) return false;\n  // Bloqueia mais de 4 ocorrências de '**' mesmo não consecutivas\n  const ocorrencias = (padrao.match(/\\*\\*/g) || []).length;\n  if (ocorrencias >= 5) return false;\n  return true;\n}\nexport function filtrarGlobSeguros(padroes: string[]): string[] {\n  return padroes.filter((p) => validarGlobBasico(p));\n}\n"]}