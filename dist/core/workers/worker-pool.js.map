{"version":3,"file":"worker-pool.js","sourceRoot":"","sources":["../../../src/core/workers/worker-pool.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n/**\n * Sistema de Pool de Workers para Processamento Paralelo de Arquivos\n *\n * Permite processar m√∫ltiplos arquivos em paralelo usando Worker Threads,\n * melhorando a performance em projetos grandes com muitos arquivos.\n */\n\nimport * as os from 'node:os';\nimport * as path from 'node:path';\nimport { Worker } from 'node:worker_threads';\n\nimport { config } from '/config/config.js';\nimport { log } from '/messages/index.js';\n\nimport type {\n  ContextoExecucao,\n  FileEntryWithAst,\n  MetricaAnalista,\n  Ocorrencia,\n  Tecnica,\n  WorkerPoolOptions,\n  WorkerResult,\n  WorkerTask,\n} from '@';\nimport { ocorrenciaErroAnalista } from '@';\n\n// Re-exporta os tipos para compatibilidade\nexport type { WorkerPoolOptions, WorkerResult, WorkerTask };\n\n/**\n * Pool de workers para processamento paralelo de arquivos\n */\nexport class WorkerPool {\n  private maxWorkers: number;\n  private batchSize: number;\n  private timeoutMs: number;\n  private enabled: boolean;\n  private activeWorkers = 0;\n  private results: WorkerResult[] = [];\n  private errors: string[] = [];\n\n  constructor(options: WorkerPoolOptions = {}) {\n    // Se o valor foi passado via options usa ele; se config define 0 usamos n¬∫ de CPUs\n    const configuredMax =\n      options.maxWorkers ?? config.WORKER_POOL_MAX_WORKERS ?? 0;\n    this.maxWorkers =\n      configuredMax > 0 ? configuredMax : Math.max(1, os.cpus().length);\n    this.batchSize = options.batchSize ?? 10;\n    // Timeout base vindo de op√ß√µes/config\n    let baseTimeout =\n      options.timeoutMs ?? config.ANALISE_TIMEOUT_POR_ANALISTA_MS;\n    // Permite sobrescrever com vari√°vel de ambiente para ambientes de produ√ß√£o\n    const envCap = Number(process.env.ORACULO_MAX_ANALYST_TIMEOUT_MS) || 0;\n    if (envCap > 0) {\n      baseTimeout = Math.min(baseTimeout, envCap);\n    } else if (process.env.NODE_ENV === 'production') {\n      // Em produ√ß√£o, por padr√£o, limitamos para n√£o exceder 10s salvo override expl√≠cito\n      baseTimeout = Math.min(baseTimeout, 10000);\n    }\n    this.timeoutMs = baseTimeout;\n    this.enabled = options.enabled ?? config.WORKER_POOL_ENABLED !== false;\n\n    // Verifica se Worker Threads est√£o dispon√≠veis\n    if (!this.enabled || !Worker) {\n      this.enabled = false;\n      log.info('Pool de workers desabilitado (Worker Threads n√£o dispon√≠vel)');\n    }\n  }\n\n  /**\n   * Processa arquivos usando pool de workers\n   */\n  async processFiles(\n    files: FileEntryWithAst[],\n    techniques: Tecnica[],\n    context: ContextoExecucao,\n  ): Promise<{\n    occurrences: Ocorrencia[];\n    metrics: MetricaAnalista[];\n    totalProcessed: number;\n    duration: number;\n  }> {\n    if (!this.enabled || files.length < this.batchSize) {\n      // Fallback para processamento sequencial\n      return this.processSequentially(files, techniques, context);\n    }\n\n    const startTime = performance.now();\n    const batches = this.createBatches(files);\n    const nonGlobalTechniques = techniques.filter((t) => !t.global);\n\n    log.info(\n      `üöÄ Iniciando processamento paralelo com ${this.maxWorkers} workers`,\n    );\n    log.info(\n      `üì¶ ${batches.length} lotes de at√© ${this.batchSize} arquivos cada`,\n    );\n\n    // Processa lotes globais primeiro\n    const globalTechniques = techniques.filter((t) => t.global);\n    if (globalTechniques.length > 0) {\n      await this.processGlobalTechniques(globalTechniques, context);\n    }\n\n    // Processa lotes de arquivos em paralelo\n    await this.processBatches(batches, nonGlobalTechniques, context);\n\n    const duration = performance.now() - startTime;\n    const totalOccurrences = this.results.reduce(\n      (sum, r) => sum + r.occurrences.length,\n      0,\n    );\n    const totalMetrics = this.results.flatMap((r) => r.metrics);\n\n    log.info(\n      `‚úÖ Processamento paralelo conclu√≠do em ${Math.round(duration)}ms`,\n    );\n    log.info(\n      `üìä ${this.results.length} workers, ${files.length} arquivos, ${totalOccurrences} ocorr√™ncias`,\n    );\n\n    return {\n      occurrences: this.results.flatMap((r) => r.occurrences),\n      metrics: totalMetrics,\n      totalProcessed: files.length,\n      duration,\n    };\n  }\n\n  /**\n   * Cria lotes de arquivos para processamento paralelo\n   */\n  private createBatches(files: FileEntryWithAst[]): FileEntryWithAst[][] {\n    const batches: FileEntryWithAst[][] = [];\n    for (let i = 0; i < files.length; i += this.batchSize) {\n      batches.push(files.slice(i, i + this.batchSize));\n    }\n    return batches;\n  }\n\n  /**\n   * Processa t√©cnicas globais (n√£o paraleliz√°veis)\n   */\n  private async processGlobalTechniques(\n    techniques: Tecnica[],\n    context: ContextoExecucao,\n  ): Promise<void> {\n    for (const technique of techniques) {\n      try {\n        const startTime = performance.now();\n        const result = await this.executeTechniqueWithTimeout(\n          technique,\n          '', // conte√∫do vazio para t√©cnicas globais\n          '[global]',\n          null, // sem AST\n          undefined, // sem fullPath\n          context,\n        );\n\n        if (result) {\n          const occurrences = Array.isArray(result) ? result : [result];\n          this.results.push({\n            workerId: -1, // ID especial para global\n            occurrences,\n            metrics: [\n              {\n                nome: technique.nome || 'global',\n                duracaoMs: performance.now() - startTime,\n                ocorrencias: occurrences.length,\n                global: true,\n              },\n            ],\n            processedFiles: 0,\n            errors: [],\n            duration: performance.now() - startTime,\n          });\n        }\n      } catch (error) {\n        const err = error as Error;\n        this.errors.push(\n          `Erro em t√©cnica global '${technique.nome}': ${err.message}`,\n        );\n        this.results.push({\n          workerId: -1,\n          occurrences: [\n            ocorrenciaErroAnalista({\n              mensagem: `Falha na t√©cnica global '${technique.nome}': ${err.message}`,\n              relPath: '[execu√ß√£o global]',\n              origem: technique.nome,\n            }),\n          ],\n          metrics: [],\n          processedFiles: 0,\n          errors: [err.message],\n          duration: 0,\n        });\n      }\n    }\n  }\n\n  /**\n   * Processa lotes de arquivos em paralelo\n   */\n  private async processBatches(\n    batches: FileEntryWithAst[][],\n    techniques: Tecnica[],\n    context: ContextoExecucao,\n  ): Promise<void> {\n    // Conjunto de promises ativas para controle fino (removemos quando conclu\u0000eddas)\n    const activePromises = new Set<Promise<void>>();\n\n    for (let i = 0; i < batches.length; i++) {\n      // Espera at√© ter vaga para novo worker\n      while (this.activeWorkers >= this.maxWorkers) {\n        // Aguarda a primeira promise ativa resolver (libera capacidade)\n        if (activePromises.size === 0) break;\n        await Promise.race(Array.from(activePromises));\n      }\n\n      const p = this.processBatch(batches[i], techniques, context, i);\n      activePromises.add(p);\n\n      // Quando a promise terminar, remove do conjunto\n      p.then(() => activePromises.delete(p)).catch(() =>\n        activePromises.delete(p),\n      );\n    }\n\n    // Aguarda todas as promises ativas terminarem\n    await Promise.all(Array.from(activePromises));\n  }\n\n  /**\n   * Processa um lote de arquivos em um worker\n   */\n  private async processBatch(\n    files: FileEntryWithAst[],\n    techniques: Tecnica[],\n    context: ContextoExecucao,\n    batchId: number,\n  ): Promise<void> {\n    this.activeWorkers++;\n\n    try {\n      const workerPath = path.join(__dirname, 'worker-executor.js');\n\n      // Calcula timeout adaptativo por lote baseado no tamanho m√©dio dos arquivos\n      const avgSize =\n        files.reduce((s, f) => s + (f.content ? f.content.length : 0), 0) /\n        Math.max(1, files.length);\n      const sizeMultiplier = 1 + Math.min(4, avgSize / 50000);\n      const batchTimeoutMs = Math.max(\n        1000,\n        Math.min(this.timeoutMs, Math.floor(this.timeoutMs * sizeMultiplier)),\n      );\n\n      const worker = new Worker(workerPath, {\n        workerData: {\n          files,\n          techniques,\n          context,\n          workerId: batchId,\n          timeoutMs: batchTimeoutMs,\n        } as WorkerTask,\n      });\n\n      const workerKillMs = Math.max(30000, this.timeoutMs * 2 || 30000);\n      const adjustedKillMs = Math.max(\n        1000,\n        Math.min(workerKillMs, batchTimeoutMs + 1000),\n      );\n\n      const result = await new Promise<WorkerResult>((resolve, reject) => {\n        let settled = false;\n        // Timer para for√ßar t√©rmino caso worker trave por muito tempo\n        let killTimer: NodeJS.Timeout | null = setTimeout(() => {\n          if (settled) return;\n          settled = true;\n          try {\n            void worker.terminate();\n          } catch {\n            /* ignore */\n          }\n          // Log estruturado para kills (ajuda em observabilidade em produ√ß√£o)\n          try {\n            log.infoSemSanitizar(\n              JSON.stringify({\n                event: 'worker_killed',\n                batchId,\n                adjustedKillMs,\n                reason: 'timeout',\n              }),\n            );\n          } catch {}\n          reject(\n            new Error(`Worker ${batchId} killed after ${adjustedKillMs}ms`),\n          );\n        }, adjustedKillMs);\n\n        worker.on('message', (msg: unknown) => {\n          const m = msg as Record<string, unknown>;\n          // Heartbeat: rearmar o kill timer\n          if (m && m['type'] === 'heartbeat') {\n            try {\n              if (killTimer) clearTimeout(killTimer);\n            } catch {}\n            killTimer = setTimeout(() => {\n              if (settled) return;\n              settled = true;\n              try {\n                void worker.terminate();\n              } catch {}\n              try {\n                log.infoSemSanitizar(\n                  JSON.stringify({\n                    event: 'worker_killed',\n                    batchId,\n                    adjustedKillMs,\n                    reason: 'heartbeat_timeout',\n                  }),\n                );\n              } catch {}\n              reject(\n                new Error(\n                  `Worker ${batchId} killed after ${adjustedKillMs}ms (heartbeat timeout)`,\n                ),\n              );\n            }, adjustedKillMs);\n            return;\n          }\n\n          if (settled) return;\n          settled = true;\n          try {\n            if (killTimer) clearTimeout(killTimer);\n          } catch {}\n          // Normaliza a mensagem retornada pelo worker para o formato WorkerResult esperado\n          try {\n            const workerId =\n              typeof m['workerId'] === 'number'\n                ? (m['workerId'] as number)\n                : batchId;\n            const occurrences = Array.isArray(m['occurrences'])\n              ? (m['occurrences'] as Ocorrencia[])\n              : Array.isArray(m['resultados'])\n                ? (m['resultados'] as Ocorrencia[])\n                : [];\n            const metrics = Array.isArray(m['metrics'])\n              ? (m['metrics'] as MetricaAnalista[])\n              : [];\n            const processedFiles =\n              typeof m['processedFiles'] === 'number'\n                ? (m['processedFiles'] as number)\n                : files.length || 0;\n            const errors = Array.isArray(m['errors'])\n              ? (m['errors'] as string[]).map(String)\n              : m['erro']\n                ? [String(m['erro'])]\n                : [];\n            const duration =\n              typeof m['duration'] === 'number' ? (m['duration'] as number) : 0;\n\n            const workerResult: WorkerResult = {\n              workerId,\n              occurrences,\n              metrics,\n              processedFiles,\n              errors: errors as string[],\n              duration,\n            };\n            resolve(workerResult);\n          } catch (e) {\n            reject(e);\n          }\n        });\n\n        worker.on('error', (err) => {\n          if (settled) return;\n          settled = true;\n          try {\n            if (killTimer) clearTimeout(killTimer);\n          } catch {}\n          reject(err);\n        });\n\n        worker.on('exit', (code) => {\n          if (settled) return;\n          settled = true;\n          try {\n            if (killTimer) clearTimeout(killTimer);\n          } catch {}\n          if (code !== 0) {\n            try {\n              log.infoSemSanitizar(\n                JSON.stringify({ event: 'worker_exit_nonzero', batchId, code }),\n              );\n            } catch {}\n            reject(new Error(`Worker ${batchId} exited with code ${code}`));\n          } else {\n            resolve({\n              workerId: batchId,\n              occurrences: [],\n              metrics: [],\n              processedFiles: files.length,\n              errors: [],\n              duration: 0,\n            });\n          }\n        });\n      });\n\n      this.results.push(result);\n    } catch (error) {\n      const err = error as Error;\n      this.errors.push(`Erro no worker ${batchId}: ${err.message}`);\n\n      // Adiciona resultado de erro\n      this.results.push({\n        workerId: batchId,\n        occurrences: [\n          ocorrenciaErroAnalista({\n            mensagem: `Falha no worker ${batchId}: ${err.message}`,\n            relPath: `[worker-${batchId}]`,\n            origem: 'worker-pool',\n          }),\n        ],\n        metrics: [],\n        processedFiles: 0,\n        errors: [err.message],\n        duration: 0,\n      });\n    } finally {\n      this.activeWorkers--;\n    }\n  }\n\n  /**\n   * Processamento sequencial como fallback\n   */\n  private async processSequentially(\n    files: FileEntryWithAst[],\n    techniques: Tecnica[],\n    context: ContextoExecucao,\n  ): Promise<{\n    occurrences: Ocorrencia[];\n    metrics: MetricaAnalista[];\n    totalProcessed: number;\n    duration: number;\n  }> {\n    const startTime = performance.now();\n    const occurrences: Ocorrencia[] = [];\n    const metrics: MetricaAnalista[] = [];\n\n    log.info('üîÑ Usando processamento sequencial (workers desabilitados)');\n\n    // Processa t√©cnicas globais\n    const globalTechniques = techniques.filter((t) => t.global);\n    for (const technique of globalTechniques) {\n      try {\n        const result = await this.executeTechniqueWithTimeout(\n          technique,\n          '',\n          '[global]',\n          null,\n          undefined,\n          context,\n        );\n\n        if (result) {\n          const occs = Array.isArray(result) ? result : [result];\n          occurrences.push(...occs);\n        }\n      } catch (error) {\n        const err = error as Error;\n        occurrences.push(\n          ocorrenciaErroAnalista({\n            mensagem: `Falha na t√©cnica global '${technique.nome}': ${err.message}`,\n            relPath: '[execu√ß√£o global]',\n            origem: technique.nome,\n          }),\n        );\n      }\n    }\n\n    // Processa arquivos sequencialmente\n    const nonGlobalTechniques = techniques.filter((t) => !t.global);\n    for (const file of files) {\n      for (const technique of nonGlobalTechniques) {\n        if (technique.test && !technique.test(file.relPath)) continue;\n\n        try {\n          const startTime = performance.now();\n          const result = await this.executeTechniqueWithTimeout(\n            technique,\n            file.content ?? '',\n            file.relPath,\n            file.ast && 'node' in file.ast ? file.ast : null,\n            file.fullPath,\n            context,\n          );\n\n          if (result) {\n            const occs = Array.isArray(result) ? result : [result];\n            occurrences.push(...occs);\n          }\n\n          const duration = performance.now() - startTime;\n          metrics.push({\n            nome: technique.nome || 'desconhecido',\n            duracaoMs: duration,\n            ocorrencias: Array.isArray(result) ? result.length : result ? 1 : 0,\n            global: false,\n          });\n        } catch (error) {\n          const err = error as Error;\n          occurrences.push(\n            ocorrenciaErroAnalista({\n              mensagem: `Falha na t√©cnica '${technique.nome}' para ${file.relPath}: ${err.message}`,\n              relPath: file.relPath,\n              origem: technique.nome,\n            }),\n          );\n        }\n      }\n    }\n\n    return {\n      occurrences,\n      metrics,\n      totalProcessed: files.length,\n      duration: performance.now() - startTime,\n    };\n  }\n\n  /**\n   * Executa uma t√©cnica com timeout\n   */\n  private async executeTechniqueWithTimeout(\n    technique: Tecnica,\n    content: string,\n    relPath: string,\n    ast: import('/traverse').NodePath<import('/types').Node> | null,\n    fullPath: string | undefined,\n    context: ContextoExecucao,\n  ): Promise<ReturnType<Tecnica['aplicar']>> {\n    if (this.timeoutMs > 0) {\n      let timer: NodeJS.Timeout | null = null;\n      const timeoutPromise = new Promise<never>((_, reject) => {\n        timer = setTimeout(() => {\n          reject(\n            new Error(\n              `Timeout: analista '${technique.nome}' excedeu ${this.timeoutMs}ms`,\n            ),\n          );\n        }, this.timeoutMs);\n      });\n\n      const execPromise = technique.aplicar(\n        content,\n        relPath,\n        ast,\n        fullPath,\n        context,\n      );\n      try {\n        return await Promise.race([execPromise, timeoutPromise]);\n      } finally {\n        if (timer) clearTimeout(timer);\n      }\n    } else {\n      return await technique.aplicar(content, relPath, ast, fullPath, context);\n    }\n  }\n\n  /**\n   * Retorna estat√≠sticas do pool\n   */\n  getStats(): {\n    maxWorkers: number;\n    batchSize: number;\n    enabled: boolean;\n    activeWorkers: number;\n    completedWorkers: number;\n    totalErrors: number;\n    errors: string[];\n  } {\n    return {\n      maxWorkers: this.maxWorkers,\n      batchSize: this.batchSize,\n      enabled: this.enabled,\n      activeWorkers: this.activeWorkers,\n      completedWorkers: this.results.length,\n      totalErrors: this.errors.length,\n      errors: this.errors,\n    };\n  }\n}\n\n/**\n * Fun√ß√£o de conveni√™ncia para usar o pool de workers\n */\n\nexport async function processarComWorkers(\n  files: FileEntryWithAst[],\n  techniques: Tecnica[],\n  context: ContextoExecucao,\n  options?: WorkerPoolOptions,\n): Promise<{\n  occurrences: Ocorrencia[];\n  metrics: MetricaAnalista[];\n  totalProcessed: number;\n  duration: number;\n}> {\n  const pool = new WorkerPool(options);\n  return await pool.processFiles(files, techniques, context);\n}\n"]}