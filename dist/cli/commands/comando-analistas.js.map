{"version":3,"file":"comando-analistas.js","sourceRoot":"","sources":["../../../src/cli/commands/comando-analistas.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport path from 'node:path';\n\nimport {\n  listarAnalistas,\n  registroAnalistas,\n} from '/registry/registry.js';\nimport { ExitCode, sair } from '/helpers/exit-codes.js';\nimport { config } from '/config/config.js';\nimport { CliComandoAnalistasMessages } from '/messages/cli/cli-comando-analistas-messages.js';\nimport { ICONES_DIAGNOSTICO, log } from '/messages/index.js';\nimport { salvarEstado } from '/persistence/persistencia.js';\nimport { Command } from 'commander';\n\nexport function comandoAnalistas(): Command {\n  return new Command('analistas')\n    .description('Lista analistas registrados e seus metadados atuais')\n    .option('-j, --json', 'Saída em JSON')\n    .option('-o, --output <arquivo>', 'Arquivo para exportar JSON de analistas')\n    .option('-d, --doc <arquivo>', 'Gera documentação Markdown dos analistas')\n    .action(async (opts: { json?: boolean; output?: string; doc?: string }) => {\n      try {\n        if (process.env.ORACULO_TEST_FAST === '1') {\n          if (opts.json) {\n            log.info(\n              JSON.stringify(\n                {\n                  total: 0,\n                  analistas: [],\n                  meta: { fast: true, tipo: 'analistas' },\n                },\n                null,\n                2,\n              ),\n            );\n            return;\n          }\n          log.info(CliComandoAnalistasMessages.fastModeTitulo);\n          log.info(CliComandoAnalistasMessages.fastModeTotalZero);\n          return;\n        }\n        const lista = listarAnalistas();\n        // Geração de documentação markdown\n        if (opts.doc) {\n          const destinoDoc = path.isAbsolute(opts.doc)\n            ? opts.doc\n            : path.join(process.cwd(), opts.doc);\n          const linhas: string[] = [];\n          linhas.push(CliComandoAnalistasMessages.docMdTitulo);\n          linhas.push('');\n          linhas.push(\n            CliComandoAnalistasMessages.docGeradoEm(new Date().toISOString()),\n          );\n          linhas.push('');\n          linhas.push(CliComandoAnalistasMessages.docTabelaHeader);\n          linhas.push(CliComandoAnalistasMessages.docTabelaSeparador);\n          for (const a of lista) {\n            const registroOriginal = (\n              registroAnalistas as Array<{\n                nome: string;\n                limites?: Record<string, number>;\n                categoria?: string;\n                descricao?: string;\n              }>\n            ).find((r) => r.nome === a.nome);\n            let limitesStr = '';\n            if (registroOriginal?.limites) {\n              limitesStr = Object.entries(registroOriginal.limites)\n                .map(([k, v]) => `${k}:${v}`)\n                .join('<br>');\n            }\n            linhas.push(\n              CliComandoAnalistasMessages.docLinhaAnalista(\n                a.nome,\n                a.categoria,\n                a.descricao || '',\n                limitesStr,\n              ),\n            );\n          }\n          linhas.push('');\n          await salvarEstado(destinoDoc, linhas.join('\\n'));\n          log.sucesso(CliComandoAnalistasMessages.docGerada(destinoDoc));\n          return;\n        }\n        if (opts.output) {\n          const destino = path.isAbsolute(opts.output)\n            ? opts.output\n            : path.join(process.cwd(), opts.output);\n          await salvarEstado(destino, {\n            geradoEm: new Date().toISOString(),\n            total: lista.length,\n            analistas: lista,\n            configLimites: config.ANALISE_LIMITES ?? {},\n          });\n          log.sucesso(CliComandoAnalistasMessages.jsonExportado(destino));\n          return;\n        }\n        if (opts.json) {\n          log.info(\n            JSON.stringify({ total: lista.length, analistas: lista }, null, 2),\n          );\n          return;\n        }\n        log.info(CliComandoAnalistasMessages.titulo);\n        for (const a of lista) {\n          log.info(\n            CliComandoAnalistasMessages.linhaAnalista(\n              a.nome,\n              a.categoria,\n              a.descricao,\n            ),\n          );\n        }\n        log.info(\n          CliComandoAnalistasMessages.tituloComIcone(ICONES_DIAGNOSTICO.info),\n        );\n        log.info(CliComandoAnalistasMessages.total(registroAnalistas.length));\n      } catch (err) {\n        log.erro(\n          `Falha ao listar analistas: ${err instanceof Error ? err.message : String(err)}`,\n        );\n        sair(ExitCode.Failure);\n      }\n    });\n}\n"]}