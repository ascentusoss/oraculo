{"version":3,"file":"processamento-diagnostico.js","sourceRoot":"","sources":["../../src/cli/processamento-diagnostico.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport fs from 'node:fs';\nimport path from 'node:path';\n\nimport { detectarArquetipos } from '@analistas/detectores/detector-arquetipos.js';\nimport { normalizarOcorrenciaParaJson } from '@cli/diagnostico/normalizar-ocorrencias-json.js';\nimport {\n  exibirBlocoFiltros,\n  listarAnalistas,\n} from '@cli/processing/display.js';\nimport {\n  configurarFiltros,\n  expandIncludes,\n  processPatternGroups,\n  processPatternListAchatado,\n} from '@cli/processing/filters.js';\nimport chalk from '@core/config/chalk-safe.js';\nimport { config } from '@core/config/config.js';\nimport {\n  executarInquisicao,\n  iniciarInquisicao,\n  prepararComAst,\n  registrarUltimasMetricas,\n} from '@core/execution/inquisidor.js';\nimport { CliProcessamentoDiagnosticoMessages } from '@core/messages/cli/cli-processamento-diagnostico-messages.js';\nimport { ExcecoesMessages } from '@core/messages/core/excecoes-messages.js';\nimport {\n  log,\n  logGuardian,\n  logRelatorio,\n  logSistema,\n  MENSAGENS_AUTOFIX,\n} from '@core/messages/index.js';\nimport { aplicarSupressaoOcorrencias } from '@core/parsing/filters.js';\nimport { scanSystemIntegrity } from '@guardian/sentinela.js';\nimport { emitirConselhoOracular } from '@relatorios/conselheiro-oracular.js';\nimport { gerarRelatorioMarkdown } from '@relatorios/gerador-relatorio.js';\nimport fragmentarRelatorio from '@shared/data-processing/fragmentar-relatorio.js';\nimport { stringifyJsonEscaped } from '@shared/data-processing/json.js';\nimport { dedupeOcorrencias } from '@shared/data-processing/ocorrencias.js';\n\n// Importar tipos centralizados (consolidado)\nimport {\n  asTecnicas,\n  converterResultadoGuardian,\n  type FileEntry,\n  type FileEntryWithAst,\n  type FiltrosConfig,\n  IntegridadeStatus,\n  type LinguagensJson,\n  type LogExtensions,\n  type OpcoesProcessamentoDiagnostico,\n  type ParseErrosJson,\n  type ResultadoGuardian,\n  type ResultadoInquisicaoCompleto,\n  type ResultadoProcessamentoDiagnostico,\n  type SaidaJsonDiagnostico,\n} from '@';\n\n// Persistncia: usar helper centralizado, mas com resolver dinmico para compat com mocks de teste\nlet salvarEstado: (caminho: string, dados: unknown) => Promise<void>;\n\nasync function getSalvarEstado(): Promise<\n  (caminho: string, dados: unknown) => Promise<void>\n> {\n  if (salvarEstado) return salvarEstado;\n  // Em testes, permitir mock do path .ts para compatibilidade com Vitest\n  const candidates = process.env.VITEST\n    ? [\n        '@shared/persistence/persistencia.js',\n        '@shared/persistence/persistencia.ts',\n      ]\n    : ['@shared/persistence/persistencia.js'];\n\n  for (const p of candidates) {\n    try {\n      const mod = await import(p as string).catch(\n        () => undefined as Record<string, unknown> | undefined,\n      );\n      if (mod && typeof mod.salvarEstado === 'function') {\n        salvarEstado = mod.salvarEstado as (\n          c: string,\n          d: unknown,\n        ) => Promise<void>;\n        break;\n      }\n    } catch {}\n  }\n\n  // Fallback: importar pelo alias oficial\n  if (!salvarEstado) {\n    const mod = await import('@shared/persistence/persistencia.js');\n    salvarEstado = (\n      mod as { salvarEstado: (c: string, d: unknown) => Promise<void> }\n    ).salvarEstado;\n  }\n  return salvarEstado;\n}\n// Reexports para compatibilidade com testes que importam utilitrios diretamente deste mdulo\nexport {\n  configurarFiltros,\n  getDefaultExcludes,\n} from '@cli/processing/filters.js';\n// registroAnalistas ser importado dinamicamente quando necessrio\n\n// Helpers deduplicao/agrupamento: agora centralizados em @shared/data-processing/ocorrencias\n\n// Constante para timeout de deteco de arqutipos (em milissegundos)\nconst DETECT_TIMEOUT_MS = process.env.VITEST ? 1000 : 30000;\n\n// Helper: deteco de arqutipos com timeout e absoro de rejeies\n\nasync function detectarArquetiposComTimeout(\n  ctx: Parameters<typeof detectarArquetipos>[0],\n  baseDir: Parameters<typeof detectarArquetipos>[1],\n  options?: { quiet?: boolean },\n): Promise<Awaited<ReturnType<typeof detectarArquetipos>> | undefined> {\n  try {\n    const detectPromise = detectarArquetipos(ctx, baseDir, options).catch(\n      (e) => {\n        // Em DEV_MODE, registra erro explcito\n        try {\n          if (\n            config.DEV_MODE &&\n            typeof (log as { erro?: Function }).erro === 'function'\n          ) {\n            const msg = e instanceof Error ? e.message : String(e);\n            (log as { erro: Function }).erro(\n              `Falha detector arquetipos: ${msg}`,\n            );\n          }\n        } catch {}\n        return undefined;\n      },\n    );\n    const timeoutPromise = new Promise<undefined>((resolve) =>\n      setTimeout(() => resolve(undefined), DETECT_TIMEOUT_MS),\n    );\n    return (await Promise.race([detectPromise, timeoutPromise])) as\n      | Awaited<ReturnType<typeof detectarArquetipos>>\n      | undefined;\n  } catch {\n    return undefined;\n  }\n}\n\n// Utilitrios para processamento de filtros\n\n// Hook de teste: permite injetar uma ocorrncia sinttica mnima para\n// exercitar ramos de exportao e despedida sem custo alto de anlise.\n\n// Expanso de includes: aceita diretrios sem curingas\n\n// Funo para obter padres de excluso padro do config\n// Funo auxiliar para detectar o tipo de projeto (simplificada)\n\n// Funo para configurar filtros no config global\n\n// Funo auxiliar para sincronizar arrays de excluso\n\n// Funo para exibir bloco de filtros (verbose)\n\n// Funo principal de processamento do diagnstico\n\nexport async function processarDiagnostico(\n  opts: OpcoesProcessamentoDiagnostico,\n): Promise<ResultadoProcessamentoDiagnostico> {\n  // Configurar flags globais\n  config.GUARDIAN_ENABLED = opts.guardianCheck ?? false;\n  // Novo comportamento: --full ativa verbose, padro  compacto/resumido\n  config.VERBOSE = opts.full ?? false;\n  // Compacto: respeita --compact explcito; por padro  o inverso de --full\n  if ((opts as unknown as Record<string, unknown>).compact !== undefined) {\n    config.COMPACT_MODE = Boolean(\n      (opts as unknown as Record<string, unknown>).compact,\n    );\n  } else {\n    config.COMPACT_MODE = !opts.full;\n  }\n\n  // Configurar nvel de log\n  if (\n    opts.logLevel &&\n    ['erro', 'aviso', 'info', 'debug'].includes(opts.logLevel)\n  ) {\n    config.LOG_LEVEL = opts.logLevel as 'erro' | 'aviso' | 'info' | 'debug';\n  }\n\n  // Processar filtros\n  const includeGroupsRaw = processPatternGroups(opts.include);\n  const includeGroupsExpanded = includeGroupsRaw.map((g) => expandIncludes(g));\n  const includeListFlat = includeGroupsExpanded.flat();\n  const excludeList = processPatternListAchatado(opts.exclude);\n  const incluiNodeModules = includeListFlat.some((p) => /node_modules/.test(p));\n\n  // Exibir bloco de filtros se verbose\n  exibirBlocoFiltros(\n    includeGroupsExpanded,\n    includeListFlat,\n    excludeList,\n    incluiNodeModules,\n  );\n\n  // Configurar filtros no config global\n  configurarFiltros(\n    includeGroupsRaw,\n    includeListFlat,\n    excludeList,\n    incluiNodeModules,\n  );\n\n  let iniciouDiagnostico = false;\n  const baseDir = process.cwd();\n  let guardianResultado: ResultadoGuardian | undefined;\n  let fileEntries: FileEntryWithAst[] = [];\n  let totalOcorrencias = 0;\n  let _jsonEmitted = false;\n\n  // Listar analistas se solicitado\n  if (opts.listarAnalistas && !opts.json) {\n    await listarAnalistas();\n  }\n\n  // Nota: antigamente tentvamos resolver dinamicamente uma outra\n  // instncia de `log` aqui (usando casts para `any`) para compatibilidade\n  // com mocks; atualmente usamos o `log` importado estaticamente e, quando\n  // necessrio, importamos dinamicamente nos trechos locais onde isto \n  // requisitado pelos testes. Isso evita uso de `any` e elimina variveis\n  // no utilizadas.\n\n  try {\n    // Fase inicial do diagnstico\n    if (opts.json) {\n      // Suprime cabealhos verbosos no modo JSON\n    } else if (!iniciouDiagnostico && !config.COMPACT_MODE) {\n      // Usa optional chaining para suportar mocks parciais do mdulo de log nos testes\n      (log as typeof log & LogExtensions).fase?.(\n        'Iniciando diagnstico completo',\n      );\n      iniciouDiagnostico = true;\n    } else if (!iniciouDiagnostico && config.COMPACT_MODE) {\n      (log as typeof log & LogExtensions).fase?.('Diagnstico (modo compacto)');\n      iniciouDiagnostico = true;\n    }\n\n    // 1) Primeira varredura rpida (sem AST) apenas para obter entries e opcionalmente rodar Guardian\n    (log as typeof log & LogExtensions).fase?.('Varredura');\n    const leituraInicial = await iniciarInquisicao(baseDir, {\n      incluirMetadados: false,\n      skipExec: true,\n    });\n    fileEntries = leituraInicial.fileEntries; // contm contedo mas sem AST\n\n    // Criao e/ou salvamento de arqutipo personalizado sob demanda\n    if (opts.criarArquetipo) {\n      try {\n        const norm = (p: string) => p.replace(/\\\\/g, '/');\n        const dirSet = new Set<string>();\n        const arquivosRaiz: string[] = [];\n        for (const fe of fileEntries) {\n          const rel = norm(fe.relPath || fe.fullPath || '');\n          if (!rel) continue;\n          if (!rel.includes('/')) {\n            arquivosRaiz.push(rel);\n          }\n          const parts = rel.split('/');\n          if (parts.length > 1) {\n            // acumula prefixos de diretrios: ex.: src/a/b -> 'src', 'src/a', 'src/a/b'\n            for (let i = 1; i < parts.length; i++) {\n              const d = parts.slice(0, i).join('/');\n              if (d) dirSet.add(d);\n            }\n          }\n        }\n\n        // Tenta obter nome do projeto a partir do package.json (preferncia: fileEntries; fallback: disco)\n        let nomeProjeto = path.basename(baseDir);\n        try {\n          const pkg = fileEntries.find((fe) =>\n            /(^|[\\\\/])package\\.json$/.test(fe.relPath || fe.fullPath),\n          );\n          if (pkg && typeof pkg.content === 'string' && pkg.content.trim()) {\n            const parsed = JSON.parse(pkg.content);\n            if (\n              parsed &&\n              typeof parsed.name === 'string' &&\n              parsed.name.trim()\n            ) {\n              nomeProjeto = parsed.name.trim();\n            }\n          } else {\n            const pkgPath = path.join(baseDir, 'package.json');\n            try {\n              const raw = await fs.promises.readFile(pkgPath, 'utf-8');\n              const parsed = JSON.parse(raw);\n              if (\n                parsed &&\n                typeof parsed.name === 'string' &&\n                parsed.name.trim()\n              ) {\n                nomeProjeto = parsed.name.trim();\n              }\n            } catch {}\n          }\n        } catch {}\n\n        const estruturaDetectada = Array.from(dirSet);\n        const {\n          criarTemplateArquetipoPersonalizado,\n          salvarArquetipoPersonalizado,\n        } = await import('@analistas/js-ts/arquetipos-personalizados.js');\n        const arquetipo = criarTemplateArquetipoPersonalizado(\n          nomeProjeto,\n          estruturaDetectada,\n          arquivosRaiz,\n          'generico',\n        );\n        if (opts.salvarArquetipo) {\n          await salvarArquetipoPersonalizado(arquetipo, baseDir);\n        } else if (config.VERBOSE) {\n          log.info(\n            CliProcessamentoDiagnosticoMessages.templateArquetipoPreview,\n          );\n        }\n      } catch (e) {\n        log.aviso(\n          `Falha ao gerar/salvar arqutipo personalizado: ${\n            e instanceof Error ? e.message : String(e)\n          }`,\n        );\n      }\n    }\n\n    // Executar Guardian se solicitado\n    if (config.GUARDIAN_ENABLED) {\n      // Usa optional chaining para evitar erro quando o mock no prover `fase`\n      (log as typeof log & LogExtensions).fase?.(\n        'Verificando integridade do Orculo',\n      );\n      try {\n        const resultado = await scanSystemIntegrity(fileEntries, {\n          suppressLogs: true,\n        });\n        guardianResultado = resultado;\n        switch (resultado.status) {\n          case IntegridadeStatus.Ok:\n            logGuardian.integridadeOk();\n            break;\n          case IntegridadeStatus.Criado:\n            logGuardian.baselineCriado();\n            break;\n          case IntegridadeStatus.Aceito:\n            logGuardian.baselineAceito();\n            break;\n          case IntegridadeStatus.AlteracoesDetectadas:\n            logGuardian.alteracoesDetectadas();\n            totalOcorrencias++;\n            break;\n        }\n      } catch (err) {\n        logGuardian.bloqueado();\n        if (\n          config.GUARDIAN_ENFORCE_PROTECTION &&\n          typeof err === 'object' &&\n          err &&\n          'detalhes' in err &&\n          Array.isArray((err as { detalhes?: unknown }).detalhes)\n        ) {\n          (err as { detalhes: string[] }).detalhes.forEach((d) => {\n            logGuardian.aviso(d);\n          });\n          if (!process.env.VITEST) {\n            try {\n              process.exit(1);\n            } catch (e) {\n              throw e;\n            }\n            throw new Error(ExcecoesMessages.exit1);\n          }\n        } else {\n          logGuardian.modoPermissivo();\n        }\n      }\n    }\n\n    // Se modo somente varredura estiver ativo, encerramos aps coleta inicial\n    if (config.SCAN_ONLY) {\n      log.info(chalk.bold(`\\n`));\n      logGuardian.scanOnly(fileEntries.length);\n      if (config.REPORT_EXPORT_ENABLED) {\n        try {\n          const ts = new Date().toISOString().replace(/[:.]/g, '-');\n          const dir =\n            typeof config.REPORT_OUTPUT_DIR === 'string'\n              ? config.REPORT_OUTPUT_DIR\n              : path.join(baseDir, 'oraculo-reports');\n          const fs = await import('node:fs');\n          await fs.promises.mkdir(dir, { recursive: true });\n          const nome = `oraculo-scan-${ts}`;\n          const resumo = {\n            modo: 'scan-only',\n            totalArquivos: fileEntries.length,\n            timestamp: new Date().toISOString(),\n          };\n          const salvar = await getSalvarEstado();\n          await salvar(path.join(dir, `${nome}.json`), resumo);\n          log.sucesso(\n            CliProcessamentoDiagnosticoMessages.relatorioScanSalvo(dir),\n          );\n        } catch (e) {\n          const msg =\n            CliProcessamentoDiagnosticoMessages.falhaExportarRelatorioScanOnly(\n              (e as Error).message,\n            );\n          log.erro(msg);\n        }\n      }\n      if (opts.json) {\n        console.log(\n          JSON.stringify({\n            modo: 'scan-only',\n            totalArquivos: fileEntries.length,\n          }),\n        );\n      }\n      // Evita encerramento forado em testes/ambiente de automao\n      if (!process.env.VITEST && !opts.json) process.exit(0);\n      else if (!process.env.VITEST && opts.json) process.exitCode = 0;\n      return {\n        totalOcorrencias: 0,\n        temErro: false,\n        guardianResultado,\n        fileEntriesComAst: [],\n        resultadoFinal: {\n          ocorrencias: [],\n          metricas: {\n            totalArquivos: 0,\n            tempoTotal: 0,\n            analistas: [],\n          },\n        },\n      };\n    }\n    // (bloco de criao de arqutipo removido)\n\n    // Preparar AST para os arquivos coletados\n    // Suporte ao fast-mode: reduz carga (parcialmente) quando ativo\n    const fastMode = Boolean(\n      (opts as unknown as Record<string, unknown>)['fast'],\n    );\n    (log as typeof log & LogExtensions).fase?.('Preparando AST');\n    let fileEntriesComAst = await prepararComAst(fileEntries, baseDir);\n    if (fastMode) {\n      // Heurstica simples: prioriza arquivos em src/ e ignora testes/configs\n      fileEntriesComAst = fileEntriesComAst.filter((fe) => {\n        const rel = (fe.relPath || fe.fullPath || '')\n          .replace(/\\\\/g, '/')\n          .toLowerCase();\n        const isTest =\n          /(^|\\/)tests?(\\/|\\.)/.test(rel) ||\n          /\\.(test|spec)\\.(ts|js|tsx|jsx)$/.test(rel) ||\n          /__tests__/.test(rel);\n        const isConfig =\n          /config|\\.config\\.|\\.rc\\.|package\\.json|tsconfig|eslint|prettier|vitest|jest|babel/.test(\n            rel,\n          );\n        const isSrc = /(^|\\/)src\\//.test(rel);\n        return isSrc && !isTest && !isConfig;\n      });\n    }\n\n    // Detectar arqutipos (pode retornar undefined em casos mnimos)\n    const arquetiposResultado:\n      | Awaited<ReturnType<typeof detectarArquetipos>>\n      | undefined = await detectarArquetiposComTimeout(\n      { arquivos: fileEntriesComAst, baseDir },\n      baseDir,\n      {\n        quiet: opts.json,\n      },\n    );\n\n    // Continuar com o processamento restante...\n    // Em fast-mode, reduz o conjunto de analistas para acelerar\n    const registro = (await import('@analistas/registry/registry.js'))\n      .registroAnalistas;\n    let tecnicas = asTecnicas(registro);\n    if (fastMode) {\n      const fmIncludeSrc: unknown =\n        (config as unknown as Record<string, unknown>).fastMode &&\n        ((config as unknown as Record<string, unknown>).fastMode as Record<\n          string,\n          unknown\n        >);\n      const includeList = Array.isArray(\n        (fmIncludeSrc as Record<string, unknown>)?.analystsInclude,\n      )\n        ? ((fmIncludeSrc as Record<string, unknown>)\n            .analystsInclude as string[])\n        : [];\n      const fmExcludeSrc: unknown =\n        (config as unknown as Record<string, unknown>).fastMode &&\n        ((config as unknown as Record<string, unknown>).fastMode as Record<\n          string,\n          unknown\n        >);\n      const excludeList = Array.isArray(\n        (fmExcludeSrc as Record<string, unknown>)?.analystsExclude,\n      )\n        ? ((fmExcludeSrc as Record<string, unknown>)\n            .analystsExclude as string[])\n        : [];\n\n      tecnicas = asTecnicas(\n        (registro as (import('@').Analista | import('@').Tecnica)[]).filter(\n          (a) => {\n            // Normaliza nomes para comparao robusta\n            const nomeRaw = (a as unknown as { nome?: string }).nome || '';\n            const norm = (s: string) =>\n              s.toLowerCase().replace(/[^a-z0-9]+/g, '-');\n            const nome = norm(nomeRaw);\n            const matchInclude = includeList.length\n              ? includeList.some((n) => {\n                  const nn = norm(n);\n                  return (\n                    nome.includes(nn) ||\n                    nomeRaw.toLowerCase().includes(n.toLowerCase())\n                  );\n                })\n              : true;\n            const matchExclude = excludeList.some((n) => {\n              const nn = norm(n);\n              return (\n                nome.includes(nn) ||\n                nomeRaw.toLowerCase().includes(n.toLowerCase())\n              );\n            });\n            return matchInclude && !matchExclude;\n          },\n        ),\n      );\n    }\n\n    (log as typeof log & LogExtensions).fase?.('Executando analistas');\n\n    // Flags especiais (disponveis para detectores/analistas via config global)\n    try {\n      const verifyCycles = Boolean(\n        (opts as unknown as Record<string, unknown>)['verifyCycles'] ||\n        (config as unknown as Record<string, unknown>)['SPECIAL_VERIFY_CYCLES'],\n      );\n      (config as unknown as Record<string, unknown>)['SPECIAL_VERIFY_CYCLES'] =\n        verifyCycles;\n    } catch {}\n\n    const resultadoExecucao = await executarInquisicao(\n      fileEntriesComAst,\n      tecnicas,\n      baseDir,\n      converterResultadoGuardian(guardianResultado),\n      {\n        verbose: config.VERBOSE,\n        compact: config.COMPACT_MODE,\n        fast: opts.fast ?? false, // Modo rpido: workers paralelos\n      },\n    );\n\n    // Processar mtricas e ocorrncias\n    registrarUltimasMetricas(resultadoExecucao.metricas);\n    // Deduplica ocorrncias repetidas para reduzir rudo no orquestrador\n    let ocorrenciasFiltradas = dedupeOcorrencias(\n      resultadoExecucao.ocorrencias || [],\n    );\n    // Trust Compiler: se habilitado, reduzir ocorrncias quando TS/ESLint no reportam\n    const trustCompiler = Boolean(\n      (opts as unknown as Record<string, unknown>)['trustCompiler'] ||\n      (config as unknown as Record<string, unknown>)['SPECIAL_TRUST_COMPILER'],\n    );\n    if (trustCompiler) {\n      try {\n        // Heurstica simples: se projeto tem tsconfig e tsc --noEmit no reporta erros, rebaixa severidades conhecidas\n        const hasTs = fs.existsSync(path.join(baseDir, 'tsconfig.json'));\n        let tsOk = true;\n        if (hasTs) {\n          // Evitar spawn pesado: usar flag existente de sucesso da build no pipeline\n          // Caso no disponvel, assume ok para reduzir rudo em modo confiana\n          tsOk = true;\n        }\n        if (tsOk) {\n          ocorrenciasFiltradas = ocorrenciasFiltradas.filter((o) => {\n            const regra = o.tipo || '';\n            // regras que o compilador/ESLint normalmente cobrem\n            const cobertas = [/import.*nao.*usado/i, /tipo-inseguro.*unknown/i];\n            return !cobertas.some((r) => r.test(regra));\n          });\n        }\n      } catch {}\n    }\n    // Conciliao simples entre analistas: rebaixa severidade em casos de conflito\n    try {\n      const byLoc = new Map<\n        string,\n        { tipos: Set<string>; items: Record<string, unknown>[] }\n      >();\n      for (const o of ocorrenciasFiltradas as unknown as Record<\n        string,\n        unknown\n      >[]) {\n        const key = `${o.relPath || ''}:${o.linha || 0}`;\n        const tipo = String(o.tipo || '');\n        if (!byLoc.has(key)) byLoc.set(key, { tipos: new Set(), items: [] });\n        const entry = byLoc.get(key);\n        if (!entry) continue;\n        entry.tipos.add(tipo);\n        entry.items.push(o);\n      }\n      for (const [, entry] of byLoc) {\n        const tipos = Array.from(entry.tipos);\n        const hasTypeUnsafe = tipos.some((t) => t.startsWith('tipo-inseguro'));\n        const hasComplexity = tipos.some((t) =>\n          /complexidade|funcoes-longas/i.test(t),\n        );\n        if (hasTypeUnsafe && hasComplexity) {\n          for (const item of entry.items) {\n            const tipo = String(item.tipo || '');\n            if (tipo.startsWith('tipo-inseguro')) {\n              item.nivel = 'aviso';\n              item.mensagem = `${item.mensagem} |  Conciliao: inferncia e tipagem explcita em conflito; revisar caso`;\n            }\n          }\n        }\n      }\n    } catch {}\n    // Aplicar supresses configuradas em oraculo.config.json\n    ocorrenciasFiltradas = aplicarSupressaoOcorrencias(\n      ocorrenciasFiltradas,\n      (config as unknown as FiltrosConfig) || undefined,\n    );\n    const totalOcorrenciasProcessadas = ocorrenciasFiltradas.length;\n\n    //  PROCESSAMENTO DE FLAGS INTUITIVAS\n    // Mapear flags intuitivas para as flags internas\n    if (opts.fix && !opts.autoFix) {\n      opts.autoFix = true;\n      logSistema.processamentoFixDetectada();\n    }\n\n    if (opts.fixSafe && !opts.autoFixConservative) {\n      opts.autoFixConservative = true;\n      opts.autoFix = true;\n      log.info(MENSAGENS_AUTOFIX.flags.fixSafe);\n    }\n\n    // Aplicar correes automticas (quick fixes) se solicitado\n    if (opts.autoFix) {\n      try {\n        // Importar mdulos de quick fixes e configurao\n        // O registro de quick fixes foi consolidado em fix-config.js\n        const { findQuickFixes, applyQuickFix } =\n          await import('@core/config/auto/fix-config.js');\n        const { getAutoFixConfig } =\n          await import('@core/config/auto/auto-fix-config.js');\n\n        // Determinar configurao do auto-fix\n        let autoFixMode = opts.autoFixMode || 'balanced';\n        if (opts.autoFixConservative) {\n          autoFixMode = 'conservative';\n          opts.autoFix = true; // Ativar auto-fix automaticamente\n        }\n\n        const autoFixConfig = getAutoFixConfig(autoFixMode);\n\n        if (autoFixMode === 'conservative') {\n          log.info(MENSAGENS_AUTOFIX.logs.modoConservador);\n        } else if (autoFixMode === 'aggressive') {\n          log.aviso(CliProcessamentoDiagnosticoMessages.autoFixModoAgressivo);\n        }\n\n        // Encontrar arquivos com quick fixes disponveis\n        const quickFixesDisponiveis = ocorrenciasFiltradas.filter(\n          (occ) =>\n            occ.tipo === 'auto-fix-disponivel' ||\n            occ.tipo === 'QUICK_FIX_DISPONIVEL',\n        );\n\n        if (quickFixesDisponiveis.length === 0) {\n          logSistema.autoFixNenhumaCorrecao();\n        } else {\n          logSistema.autoFixAplicando(autoFixMode);\n\n          let arquivosCorrigidos = 0;\n          let totalCorrecoes = 0;\n          let correcoesPuladas = 0;\n\n          // Agrupar por arquivo para aplicar todas as correes de uma vez\n          const correcoesPorArquivo = new Map<\n            string,\n            typeof quickFixesDisponiveis\n          >();\n          for (const fix of quickFixesDisponiveis) {\n            const arquivo = fix.relPath || fix.arquivo;\n            if (!arquivo) continue;\n\n            if (!correcoesPorArquivo.has(arquivo)) {\n              correcoesPorArquivo.set(arquivo, []);\n            }\n            correcoesPorArquivo.get(arquivo)?.push(fix);\n          }\n\n          // Aplicar correes arquivo por arquivo\n          const maxFixesPerFile = autoFixConfig?.maxFixesPerFile ?? Infinity;\n          for (const [arquivo, _fixes] of correcoesPorArquivo) {\n            try {\n              // Encontrar o FileEntry correspondente\n              const fileEntry = fileEntriesComAst.find(\n                (fe) => fe.relPath === arquivo || fe.fullPath === arquivo,\n              );\n\n              if (!fileEntry || typeof fileEntry.content !== 'string') {\n                logSistema.autoFixArquivoNaoEncontrado(arquivo);\n                continue;\n              }\n\n              let codigoCorrigido = fileEntry.content;\n              let corrigiuAlgo = false;\n              let correcoesPorArquivoCount = 0;\n\n              // Encontrar e aplicar quick fixes com configurao\n              const quickFixesEncontrados = findQuickFixes(\n                codigoCorrigido,\n                undefined,\n                autoFixConfig,\n                arquivo,\n              );\n\n              for (const quickFix of quickFixesEncontrados) {\n                // Verificar limite de correes por arquivo\n                const maxFixesPerFile =\n                  autoFixConfig?.maxFixesPerFile ?? Infinity;\n                if (correcoesPorArquivoCount >= maxFixesPerFile) {\n                  correcoesPuladas += quickFix.matches.length;\n                  break;\n                }\n\n                for (const match of quickFix.matches) {\n                  try {\n                    const novocodigo = applyQuickFix(\n                      codigoCorrigido,\n                      quickFix,\n                      match,\n                    );\n                    if (novocodigo !== codigoCorrigido) {\n                      codigoCorrigido = novocodigo;\n                      corrigiuAlgo = true;\n                      totalCorrecoes++;\n                      correcoesPorArquivoCount++;\n\n                      if (config.VERBOSE) {\n                        logSistema.autoFixAplicada(\n                          quickFix.title,\n                          quickFix.confidence,\n                        );\n                      }\n                    }\n                  } catch (err) {\n                    logSistema.autoFixFalha(\n                      quickFix.id,\n                      err instanceof Error ? err.message : String(err),\n                    );\n                  }\n\n                  // Verificar limite de correes por arquivo\n                  if (correcoesPorArquivoCount >= maxFixesPerFile) {\n                    break;\n                  }\n                }\n              }\n\n              // Salvar arquivo se houve alteraes\n              if (corrigiuAlgo) {\n                const { promises: fs } = await import('node:fs');\n                const caminhoCompleto = path.isAbsolute(arquivo)\n                  ? arquivo\n                  : path.join(baseDir, arquivo);\n                await fs.writeFile(caminhoCompleto, codigoCorrigido, 'utf-8');\n                arquivosCorrigidos++;\n\n                if (config.VERBOSE) {\n                  logSistema.autoFixCorrigido(arquivo);\n                }\n              }\n            } catch (err) {\n              log.erro(\n                ` Erro ao corrigir ${arquivo}: ${err instanceof Error ? err.message : String(err)}`,\n              );\n            }\n          }\n\n          if (arquivosCorrigidos > 0) {\n            const estatisticas = [\n              `${totalCorrecoes} correes aplicadas em ${arquivosCorrigidos} arquivo(s)`,\n            ];\n\n            if (correcoesPuladas > 0) {\n              estatisticas.push(\n                `${correcoesPuladas} correes puladas (limite por arquivo: ${maxFixesPerFile === Infinity ? '' : maxFixesPerFile})`,\n              );\n            }\n\n            if (autoFixMode === 'conservative') {\n              estatisticas.push('modo conservador (alta confiana apenas)');\n            }\n\n            logSistema.autoFixEstatisticas(estatisticas);\n\n            // Validao ESLint ps-auto-fix para harmonia total\n            if (\n              process.env.ORACULO_ESLINT_VALIDATION !== '0' &&\n              autoFixConfig.validateAfterFix\n            ) {\n              try {\n                log.info(MENSAGENS_AUTOFIX.logs.validacaoEslint);\n                const { spawn } = await import('node:child_process');\n\n                // Lista de arquivos corrigidos para validao\n                const arquivosParaValidar = Array.from(\n                  correcoesPorArquivo.keys(),\n                );\n\n                if (arquivosParaValidar.length > 0) {\n                  // Executar ESLint --fix apenas nos arquivos modificados\n                  const eslintArgs = ['--fix', ...arquivosParaValidar];\n\n                  const proc = spawn('npx', ['eslint', ...eslintArgs], {\n                    cwd: baseDir,\n                    stdio: 'pipe',\n                  });\n\n                  let stdout = '';\n                  let _stderr = '';\n\n                  proc.stdout?.on('data', (data) => {\n                    stdout += data;\n                  });\n                  proc.stderr?.on('data', (data) => {\n                    _stderr += data;\n                  });\n\n                  await new Promise((resolve, _reject) => {\n                    proc.on('close', (code) => {\n                      if (code === 0) {\n                        logSistema.autoFixESLintHarmonia();\n                        resolve(void 0);\n                      } else {\n                        // ESLint encontrou/corrigiu issues - isso  normal\n                        if (config.VERBOSE && stdout) {\n                          logSistema.processamentoESLintOutput(stdout);\n                        }\n                        logSistema.autoFixESLintAjustes();\n                        resolve(void 0);\n                      }\n                    });\n\n                    proc.on('error', (err) => {\n                      logSistema.autoFixESLintFalha(err.message);\n                      resolve(void 0); // No falha o processo principal\n                    });\n                  });\n                }\n              } catch (err) {\n                log.aviso(\n                  `  Validao ESLint no executada: ${err instanceof Error ? err.message : String(err)}`,\n                );\n              }\n            }\n          } else {\n            logSistema.autoFixNenhumaAplicada();\n          }\n\n          // Remover quick fixes das ocorrncias j que foram aplicados\n          const ocorrenciasSemQuickFixes = ocorrenciasFiltradas.filter(\n            (occ) =>\n              occ.tipo !== 'auto-fix-disponivel' &&\n              occ.tipo !== 'QUICK_FIX_DISPONIVEL',\n          );\n\n          // Atualizar contadores e usar ocorrncias sem quick fixes nos relatrios\n          totalOcorrencias = ocorrenciasSemQuickFixes.length;\n        }\n      } catch (err) {\n        log.erro(\n          ` Falha ao executar auto-fix: ${err instanceof Error ? err.message : String(err)}`,\n        );\n      }\n    } else {\n      // CRTICO: Definir totalOcorrencias no fluxo normal (sem auto-fix)\n      totalOcorrencias = ocorrenciasFiltradas.length;\n    }\n\n    // Logging bsico sempre, detalhado para --verbose e --debug\n    const tiposOcorrencias = new Map<string, number>();\n    const nivelOcorrencias = new Map<string, number>();\n\n    ocorrenciasFiltradas.forEach((ocorrencia) => {\n      const tipo = ocorrencia.tipo || 'DESCONHECIDO';\n      const nivel = ocorrencia.nivel || 'info';\n      tiposOcorrencias.set(tipo, (tiposOcorrencias.get(tipo) || 0) + 1);\n      nivelOcorrencias.set(nivel, (nivelOcorrencias.get(nivel) || 0) + 1);\n    });\n\n    if (tiposOcorrencias.size > 0 && !opts.json) {\n      // Modo executivo: mostrar resumo executivo conciso e acionvel\n      if (opts.executive) {\n        try {\n          const criticos = nivelOcorrencias.get('erro') || 0;\n          const altos = nivelOcorrencias.get('alto') || 0;\n          const total = totalOcorrenciasProcessadas;\n\n          // Top arquivos por ocorrncias (somente erros/avisos crticos para executivo)\n          const arquivoCount = new Map<string, number>();\n          for (const oc of ocorrenciasFiltradas) {\n            const pathKey = (oc.relPath ||\n              oc.arquivo ||\n              'desconhecido') as string;\n            const nivel = oc.nivel || 'info';\n            if (nivel === 'erro' || nivel === 'alto') {\n              arquivoCount.set(pathKey, (arquivoCount.get(pathKey) || 0) + 1);\n            }\n          }\n          const topArquivos = Array.from(arquivoCount.entries())\n            .sort((a, b) => b[1] - a[1])\n            .slice(0, 5);\n\n          const header =\n            CliProcessamentoDiagnosticoMessages.resumoExecutivoHeader(\n              total,\n              criticos,\n              altos,\n            );\n          if (\n            typeof (log as typeof log & LogExtensions).imprimirBloco ===\n            'function'\n          ) {\n            const linhas = [\n              CliProcessamentoDiagnosticoMessages.resumoExecutivoCriticos(\n                criticos,\n              ),\n              CliProcessamentoDiagnosticoMessages.resumoExecutivoAltos(altos),\n              CliProcessamentoDiagnosticoMessages.linhaEmBranco,\n              CliProcessamentoDiagnosticoMessages.resumoExecutivoTopArquivosErrosAltos,\n              ...topArquivos.map(([f, c]) =>\n                CliProcessamentoDiagnosticoMessages.resumoExecutivoBulletTopArquivo(\n                  f,\n                  c,\n                ),\n              ),\n              CliProcessamentoDiagnosticoMessages.linhaEmBranco,\n              CliProcessamentoDiagnosticoMessages.resumoExecutivoAcaoSugerida,\n            ];\n            (log as typeof log & LogExtensions).imprimirBloco(header, linhas);\n          } else {\n            log.info(header);\n            if (topArquivos.length > 0) {\n              log.info(\n                CliProcessamentoDiagnosticoMessages.resumoExecutivoTopArquivosErrosAltos,\n              );\n              topArquivos.forEach(([f, c]) =>\n                log.info(\n                  CliProcessamentoDiagnosticoMessages.resumoExecutivoBulletTopArquivo(\n                    f,\n                    c,\n                  ),\n                ),\n              );\n            }\n            log.info(\n              CliProcessamentoDiagnosticoMessages.resumoExecutivoAcaoSugerida,\n            );\n          }\n        } catch {\n          // no crtico\n        }\n      }\n      // Resumo bsico sempre (no verbose e no executive)\n      else if (!config.VERBOSE && !config.DEV_MODE) {\n        logSistema.processamentoResumoOcorrencias(totalOcorrenciasProcessadas);\n\n        // Top 5 tipos mais comuns\n        const topTipos = Array.from(tiposOcorrencias.entries())\n          .sort((a, b) => b[1] - a[1])\n          .slice(0, 5);\n\n        console.log(CliProcessamentoDiagnosticoMessages.linhaEmBranco);\n        console.log(CliProcessamentoDiagnosticoMessages.principaisTiposTitulo);\n        topTipos.forEach(([tipo, count]) => {\n          console.log(\n            CliProcessamentoDiagnosticoMessages.principaisTiposLinha(\n              tipo,\n              count,\n            ),\n          );\n        });\n\n        // Mini top arquivos (5) para ao rpida\n        try {\n          const arquivoCount = new Map<string, number>();\n          for (const oc of ocorrenciasFiltradas) {\n            const pathKey = (oc.relPath ||\n              oc.arquivo ||\n              'desconhecido') as string;\n            arquivoCount.set(pathKey, (arquivoCount.get(pathKey) || 0) + 1);\n          }\n          const topArquivos = Array.from(arquivoCount.entries())\n            .sort((a, b) => b[1] - a[1])\n            .slice(0, 5);\n          if (topArquivos.length > 0) {\n            console.log(CliProcessamentoDiagnosticoMessages.linhaEmBranco);\n            console.log(CliProcessamentoDiagnosticoMessages.topArquivosTitulo);\n            topArquivos.forEach(([f, c]) =>\n              console.log(\n                CliProcessamentoDiagnosticoMessages.topArquivosLinha(f, c),\n              ),\n            );\n          }\n        } catch {\n          /* ignore */\n        }\n\n        console.log(CliProcessamentoDiagnosticoMessages.linhaEmBranco);\n        logSistema.processamentoDicasContextuais();\n\n        // Dicas baseadas no contedo real encontrado\n        const totalTodos = tiposOcorrencias.get('TODO_PENDENTE') || 0;\n        const totalQuickFixes =\n          (tiposOcorrencias.get('QUICK_FIX_DISPONIVEL') || 0) +\n          (tiposOcorrencias.get('auto-fix-disponivel') || 0);\n        const totalErros = nivelOcorrencias.get('erro') || 0;\n        const totalAvisos = nivelOcorrencias.get('aviso') || 0;\n\n        if (totalErros > 0) {\n          logSistema.processamentoErrosCriticos(totalErros);\n        }\n\n        if (totalAvisos > 0) {\n          logSistema.processamentoAvisosEncontrados(totalAvisos);\n        }\n\n        if (totalQuickFixes > 10) {\n          logSistema.processamentoQuickFixesMuitos(totalQuickFixes);\n          logSistema.processamentoQuickFixesComando();\n          logSistema.processamentoQuickFixesExecutar();\n        } else if (totalQuickFixes > 0) {\n          logSistema.processamentoQuickFixesMuitos(totalQuickFixes);\n          logSistema.processamentoQuickFixesComando();\n          logSistema.processamentoQuickFixesExecutar();\n        }\n\n        if (totalTodos > 50) {\n          logSistema.processamentoTodosMuitos(totalTodos);\n        } else if (totalTodos > 0) {\n          logSistema.processamentoTodosPoucos(totalTodos);\n        }\n\n        if (totalOcorrenciasProcessadas > 1000) {\n          logSistema.processamentoMuitasOcorrencias();\n          logSistema.processamentoFiltrarPasta();\n        }\n\n        logSistema.processamentoUsarFull();\n        logSistema.processamentoUsarJson();\n\n        if (totalOcorrenciasProcessadas < 100) {\n          logSistema.processamentoProjetoLimpo();\n        }\n      } else {\n        // Detalhamento completo para --verbose (ou quando --full ativo)\n        logSistema.processamentoDetalhamentoOcorrencias(\n          totalOcorrenciasProcessadas,\n        );\n\n        // Mostrar por tipo\n        log.info(CliProcessamentoDiagnosticoMessages.porTipoTitulo);\n        Array.from(tiposOcorrencias.entries())\n          .sort((a, b) => b[1] - a[1])\n          .forEach(([tipo, count]) => {\n            log.info(\n              CliProcessamentoDiagnosticoMessages.porTipoLinha(tipo, count),\n            );\n          });\n\n        // Mostrar por nvel de severidade\n        log.info(CliProcessamentoDiagnosticoMessages.porSeveridadeTitulo);\n        Array.from(nivelOcorrencias.entries())\n          .sort((a, b) => b[1] - a[1])\n          .forEach(([nivel, count]) => {\n            const emoji =\n              nivel === 'erro' ? '' : nivel === 'aviso' ? '' : '';\n            log.info(\n              CliProcessamentoDiagnosticoMessages.porSeveridadeLinha(\n                emoji,\n                nivel,\n                count,\n              ),\n            );\n          });\n\n        // Adicionar top arquivos com contagem (til para investigao)\n        try {\n          const arquivosCount = new Map<string, number>();\n          for (const oc of ocorrenciasFiltradas) {\n            const key = (oc.relPath || oc.arquivo || 'desconhecido') as string;\n            arquivosCount.set(key, (arquivosCount.get(key) || 0) + 1);\n          }\n          const topArquivosAll = Array.from(arquivosCount.entries())\n            .sort((a, b) => b[1] - a[1])\n            .slice(0, 10);\n          if (topArquivosAll.length) {\n            if (\n              typeof (log as typeof log & LogExtensions).imprimirBloco ===\n              'function'\n            ) {\n              const linhas = [\n                CliProcessamentoDiagnosticoMessages.topArquivosPorOcorrenciasTitulo,\n                ...topArquivosAll.map(([f, c]) =>\n                  CliProcessamentoDiagnosticoMessages.resumoExecutivoBulletTopArquivo(\n                    f,\n                    c,\n                  ),\n                ),\n              ];\n              (log as typeof log & LogExtensions).imprimirBloco(\n                CliProcessamentoDiagnosticoMessages.arquivosMaisOcorrenciasTitulo,\n                linhas,\n              );\n            } else {\n              log.info(\n                CliProcessamentoDiagnosticoMessages.topArquivosPorOcorrenciasTitulo,\n              );\n              topArquivosAll.forEach(([f, c]) =>\n                log.info(\n                  CliProcessamentoDiagnosticoMessages.resumoExecutivoBulletTopArquivo(\n                    f,\n                    c,\n                  ),\n                ),\n              );\n            }\n          }\n\n          // Top crticos imediatos (erros/alto) para ao rpida\n          const criticosOuAltos: Array<{\n            arquivo: string;\n            tipo: string;\n            nivel: string;\n            linha?: number;\n            coluna?: number;\n          }> = [];\n          for (const oc of ocorrenciasFiltradas) {\n            const nivel = (oc.nivel || 'info').toString().toLowerCase();\n            if (nivel === 'erro' || nivel === 'alto') {\n              criticosOuAltos.push({\n                arquivo: (oc.relPath || oc.arquivo || 'desconhecido') as string,\n                tipo: (oc.tipo || 'desconhecido') as string,\n                nivel,\n                linha: typeof oc.linha === 'number' ? oc.linha : undefined,\n                coluna:\n                  typeof (oc as unknown as { coluna?: number }).coluna ===\n                  'number'\n                    ? (oc as unknown as { coluna?: number }).coluna\n                    : undefined,\n              });\n            }\n          }\n          // Ordenao por severidade: erro > alto > aviso (se houver)\n          const ordemNivel = (n: string) =>\n            n === 'erro' ? 3 : n === 'alto' ? 2 : n === 'aviso' ? 1 : 0;\n          const topCriticos = criticosOuAltos\n            .sort((a, b) => ordemNivel(b.nivel) - ordemNivel(a.nivel))\n            .slice(0, 10);\n          if (topCriticos.length) {\n            if (\n              typeof (log as typeof log & LogExtensions).imprimirBloco ===\n              'function'\n            ) {\n              const linhas = topCriticos.map((c) => {\n                const pos =\n                  typeof c.linha === 'number'\n                    ? `:${c.linha}${typeof c.coluna === 'number' ? `:${c.coluna}` : ''}`\n                    : '';\n                return CliProcessamentoDiagnosticoMessages.topCriticosLinha(\n                  c.nivel.toUpperCase(),\n                  c.tipo,\n                  c.arquivo,\n                  pos,\n                );\n              });\n              (log as typeof log & LogExtensions).imprimirBloco(\n                CliProcessamentoDiagnosticoMessages.topCriticosTitulo,\n                linhas,\n              );\n            } else {\n              log.info(\n                CliProcessamentoDiagnosticoMessages.topCriticosTituloComDoisPontos,\n              );\n              topCriticos.forEach((c) => {\n                const pos =\n                  typeof c.linha === 'number'\n                    ? `:${c.linha}${typeof c.coluna === 'number' ? `:${c.coluna}` : ''}`\n                    : '';\n                log.info(\n                  CliProcessamentoDiagnosticoMessages.topCriticosLinha(\n                    c.nivel.toUpperCase(),\n                    c.tipo,\n                    c.arquivo,\n                    pos,\n                  ),\n                );\n              });\n            }\n          }\n\n          // Amostra de ocorrncias (limite para no poluir o terminal)\n          const SAMPLE_MAX = 50;\n          const sample = ocorrenciasFiltradas\n            .slice(0, SAMPLE_MAX)\n            .map(\n              (o) =>\n                `${o.relPath}:${o.linha ?? ''} [${o.nivel ?? ''}] ${String(o.mensagem ?? '').replace(/\\n/g, ' ')}`,\n            );\n          if (sample.length) {\n            if (\n              typeof (log as typeof log & LogExtensions).imprimirBloco ===\n              'function'\n            ) {\n              (log as typeof log & LogExtensions).imprimirBloco(\n                CliProcessamentoDiagnosticoMessages.amostraBlocoTitulo(\n                  sample.length,\n                ),\n                sample.slice(0, 20),\n              );\n            } else {\n              log.info(\n                CliProcessamentoDiagnosticoMessages.amostraOcorrenciasTitulo,\n              );\n              sample\n                .slice(0, 20)\n                .forEach((s) =>\n                  log.info(\n                    CliProcessamentoDiagnosticoMessages.amostraLinhaIndentada(\n                      s,\n                    ),\n                  ),\n                );\n            }\n            if (ocorrenciasFiltradas.length > SAMPLE_MAX) {\n              log.info(\n                CliProcessamentoDiagnosticoMessages.amostraMaisLinhas(\n                  SAMPLE_MAX,\n                  ocorrenciasFiltradas.length,\n                ),\n              );\n            }\n          }\n        } catch {\n          // ignore\n        }\n      }\n    }\n\n    // Logging adicional para DEBUG\n    if (config.VERBOSE || config.DEV_MODE) {\n      if (config.DEV_MODE && !opts.json && resultadoExecucao.metricas) {\n        if (resultadoExecucao.metricas.analistas) {\n          const analistasComOcorrencias =\n            resultadoExecucao.metricas.analistas.filter(\n              (a) => (a.ocorrencias ?? 0) > 0,\n            );\n          logSistema.processamentoAnalistasProblemas(\n            analistasComOcorrencias.length,\n          );\n          analistasComOcorrencias.forEach((analista) => {\n            log.info(\n              CliProcessamentoDiagnosticoMessages.analistaOcorrenciasLinha(\n                analista.nome,\n                analista.ocorrencias,\n                analista.duracaoMs.toFixed(1),\n              ),\n            );\n          });\n        }\n      }\n    }\n\n    // Mensagem final apenas quando repositrio est limpo\n    try {\n      if (!opts.json && !config.SCAN_ONLY && totalOcorrencias === 0) {\n        logRelatorio.repositorioImpecavel();\n      }\n    } catch {}\n\n    // Em ambiente de testes (Vitest) tambm invocar via import dinmico o mdulo\n    // que os testes normalmente mockam (`../../src/nucleo/constelacao/log.js`).\n    // Isso garante que, mesmo que haja alguma diferena de instncia entre o\n    // import esttico e o mock aplicado pelo Vitest, as spies do teste sejam\n    // chamadas e asseres sobre `logMock` passem.\n    // (removed temporary vitest dynamic invocations)\n\n    // Log de diagnstico concludo para testes\n    if (process.env.VITEST && !opts.json) {\n      log.info(CliProcessamentoDiagnosticoMessages.diagnosticoConcluido);\n    }\n\n    // Processar arqutipos se disponvel\n    if (arquetiposResultado) {\n      // Lgica de processamento de arqutipos seria implementada aqui\n      // Por enquanto, apenas log se verbose\n      if (config.VERBOSE && arquetiposResultado.candidatos?.length > 0) {\n        log.info(\n          CliProcessamentoDiagnosticoMessages.arquetiposDetectados(\n            arquetiposResultado.candidatos.length,\n          ),\n        );\n      }\n\n      // Em modo compacto, mostrar informao resumida sobre arqutipos\n      if (\n        !config.VERBOSE &&\n        config.COMPACT_MODE &&\n        arquetiposResultado.candidatos?.length > 0\n      ) {\n        const topCandidato = arquetiposResultado.candidatos[0];\n        log.info(\n          CliProcessamentoDiagnosticoMessages.arquetiposCompact(\n            topCandidato.nome,\n            topCandidato.confidence,\n          ),\n        );\n      }\n\n      // Exibir informaes sobre candidatos mesmo quando no verbose (para testes)\n      if (!config.VERBOSE && arquetiposResultado.candidatos?.length > 0) {\n        log.info(\n          CliProcessamentoDiagnosticoMessages.arquetiposCandidatosEncontrados(\n            arquetiposResultado.candidatos.length,\n          ),\n        );\n      }\n\n      // Exibir informaes detalhadas dos arquetipos se verbose\n      if (config.VERBOSE && arquetiposResultado.candidatos?.length > 0) {\n        const candidatoTop = arquetiposResultado.candidatos[0];\n\n        // Log dos candidatos\n        log.info(\n          CliProcessamentoDiagnosticoMessages.arquetiposCandidatosTitulo,\n        );\n        for (const candidato of arquetiposResultado.candidatos.slice(0, 3)) {\n          log.info(\n            CliProcessamentoDiagnosticoMessages.arquetiposCandidatoLinha(\n              candidato.nome,\n              candidato.confidence,\n            ),\n          );\n        }\n\n        // Log do planoSugestao se existir\n        if (candidatoTop.planoSugestao) {\n          const plano = candidatoTop.planoSugestao;\n          if (plano.mover && plano.mover.length > 0) {\n            log.info(\n              CliProcessamentoDiagnosticoMessages.planoSugestaoMove(\n                plano.mover.length,\n              ),\n            );\n          } else {\n            log.info(\n              CliProcessamentoDiagnosticoMessages.planoSugestaoNenhumMove,\n            );\n          }\n\n          if (plano.conflitos && plano.conflitos.length > 0) {\n            log.info(\n              CliProcessamentoDiagnosticoMessages.conflitos(\n                plano.conflitos.length,\n              ),\n            );\n          }\n        }\n\n        // Log de anomalias se existirem\n        if (candidatoTop.anomalias && candidatoTop.anomalias.length > 0) {\n          const tituloAnomalias =\n            CliProcessamentoDiagnosticoMessages.anomaliasTitulo;\n          const linhasAnomalias: string[] = [];\n          for (const anomalia of candidatoTop.anomalias.slice(0, 8)) {\n            linhasAnomalias.push(\n              CliProcessamentoDiagnosticoMessages.anomaliaLinha(\n                anomalia.path,\n                anomalia.motivo,\n              ),\n            );\n          }\n          if (candidatoTop.anomalias.length > 8) {\n            linhasAnomalias.push(\n              CliProcessamentoDiagnosticoMessages.anomaliasMais(\n                candidatoTop.anomalias.length - 8,\n              ),\n            );\n          }\n\n          if (\n            typeof (log as typeof log & LogExtensions).imprimirBloco ===\n            'function'\n          ) {\n            (log as typeof log & LogExtensions).imprimirBloco(\n              tituloAnomalias,\n              linhasAnomalias,\n            );\n          } else {\n            // Fallback para logs simples se imprimirBloco no estiver disponvel\n            log.info(\n              CliProcessamentoDiagnosticoMessages.anomaliasTituloComDoisPontos,\n            );\n            for (const linha of linhasAnomalias) {\n              log.info(\n                CliProcessamentoDiagnosticoMessages.amostraLinhaIndentada(\n                  linha,\n                ),\n              );\n            }\n          }\n\n          // Log adicional sobre anomalias ocultas se houver mais de 8\n          if (candidatoTop.anomalias.length > 8) {\n            log.aviso(\n              CliProcessamentoDiagnosticoMessages.anomaliasOcultasAviso(\n                candidatoTop.anomalias.length - 8,\n              ),\n            );\n          }\n        }\n\n        // Log de drift se existir\n        if (arquetiposResultado.drift) {\n          const drift = arquetiposResultado.drift;\n          if (drift.alterouArquetipo) {\n            log.info(\n              CliProcessamentoDiagnosticoMessages.driftAlterou(\n                drift.anterior,\n                drift.atual,\n              ),\n            );\n          } else {\n            log.info(\n              CliProcessamentoDiagnosticoMessages.driftMantido(drift.atual),\n            );\n          }\n\n          if (drift.arquivosRaizNovos && drift.arquivosRaizNovos.length > 0) {\n            const novosStr =\n              drift.arquivosRaizNovos.length > 3\n                ? `${drift.arquivosRaizNovos.slice(0, 3).join(', ')}`\n                : drift.arquivosRaizNovos.join(', ');\n            log.info(CliProcessamentoDiagnosticoMessages.driftNovos(novosStr));\n          }\n          if (\n            drift.arquivosRaizRemovidos &&\n            drift.arquivosRaizRemovidos.length > 0\n          ) {\n            const removidosStr =\n              drift.arquivosRaizRemovidos.length > 3\n                ? `${drift.arquivosRaizRemovidos.slice(0, 3).join(', ')}`\n                : drift.arquivosRaizRemovidos.join(', ');\n            log.info(\n              CliProcessamentoDiagnosticoMessages.driftRemovidos(removidosStr),\n            );\n          }\n        }\n      } else if (config.VERBOSE) {\n        // Debug: log se no h candidatos ou arquetiposResultado  undefined\n        const candidatosCount = arquetiposResultado\n          ? (\n              arquetiposResultado as Awaited<\n                ReturnType<typeof detectarArquetipos>\n              >\n            ).candidatos?.length || 0\n          : 0;\n        log.info(\n          `DEBUG: arquetiposResultado=${!!arquetiposResultado}, candidatos=${candidatosCount}`,\n        );\n      }\n\n      // Imprimir bloco de resumo de estrutura se houver baseline/drift (fora de JSON)\n      if (\n        !opts.json &&\n        arquetiposResultado &&\n        (arquetiposResultado.baseline || arquetiposResultado.drift)\n      ) {\n        const linhasEstrutura: string[] = [];\n        if (arquetiposResultado.baseline) {\n          const baseline = arquetiposResultado.baseline;\n          linhasEstrutura.push(\n            CliProcessamentoDiagnosticoMessages.baselineArquetipo(\n              baseline.arquetipo,\n              baseline.confidence,\n            ),\n          );\n          linhasEstrutura.push(\n            CliProcessamentoDiagnosticoMessages.baselineCriadoEm(\n              new Date(baseline.timestamp).toLocaleString('pt-BR'),\n            ),\n          );\n        } else {\n          // Log de aviso quando no h baseline\n          log.aviso(\n            CliProcessamentoDiagnosticoMessages.baselineDesconhecidoAviso,\n          );\n          linhasEstrutura.push(\n            CliProcessamentoDiagnosticoMessages.baselineArquetipoDesconhecido,\n          );\n        }\n        if (arquetiposResultado.drift) {\n          const drift = arquetiposResultado.drift;\n          if (drift.alterouArquetipo) {\n            linhasEstrutura.push(\n              CliProcessamentoDiagnosticoMessages.driftDetectado(\n                drift.anterior,\n                drift.atual,\n              ),\n            );\n          } else {\n            linhasEstrutura.push(\n              CliProcessamentoDiagnosticoMessages.arquetipoMantido(drift.atual),\n            );\n          }\n          if (drift.arquivosRaizNovos && drift.arquivosRaizNovos.length > 0) {\n            linhasEstrutura.push(\n              CliProcessamentoDiagnosticoMessages.novosArquivosRaiz(\n                drift.arquivosRaizNovos.join(', '),\n              ),\n            );\n          }\n          if (\n            drift.arquivosRaizRemovidos &&\n            drift.arquivosRaizRemovidos.length > 0\n          ) {\n            linhasEstrutura.push(\n              CliProcessamentoDiagnosticoMessages.arquivosRemovidosRaiz(\n                drift.arquivosRaizRemovidos.join(', '),\n              ),\n            );\n          }\n        }\n        if (\n          arquetiposResultado.candidatos &&\n          arquetiposResultado.candidatos.length > 0\n        ) {\n          const top = arquetiposResultado.candidatos[0];\n          linhasEstrutura.push(\n            CliProcessamentoDiagnosticoMessages.candidatoPrincipal(\n              top.nome,\n              top.confidence,\n            ),\n          );\n        }\n\n        const tituloEstrutura =\n          CliProcessamentoDiagnosticoMessages.resumoEstruturaTitulo;\n        if (\n          typeof (log as typeof log & LogExtensions).imprimirBloco ===\n          'function'\n        ) {\n          // Calcular largura como nos outros blocos\n          let larguraEstrutura: number | undefined;\n          if (\n            typeof (log as Record<string, unknown>).calcularLargura ===\n            'function'\n          ) {\n            larguraEstrutura = (\n              log as { calcularLargura: Function }\n            ).calcularLargura(\n              tituloEstrutura,\n              linhasEstrutura,\n              config.COMPACT_MODE ? 84 : 96,\n            );\n            // Se calcularLargura retornar undefined, usar fallback\n            if (\n              typeof larguraEstrutura !== 'number' ||\n              isNaN(larguraEstrutura)\n            ) {\n              larguraEstrutura = config.COMPACT_MODE ? 84 : 96;\n            }\n          } else {\n            larguraEstrutura = config.COMPACT_MODE ? 84 : 96;\n          }\n          (log as typeof log & LogExtensions).imprimirBloco(\n            tituloEstrutura,\n            linhasEstrutura,\n            undefined,\n            larguraEstrutura,\n          );\n        }\n      }\n\n      // Sada JSON se solicitado\n      // No imprimir logs arbitrrios antes do JSON final  isso quebra os testes que\n      // esperam JSON puro em stdout. Em ambiente de desenvolvimento, registrar via\n      // logger debug para auxiliar diagnstico local.\n      if (\n        config.DEV_MODE &&\n        typeof (log as { debug?: Function }).debug === 'function'\n      ) {\n        try {\n          (log as { debug: Function }).debug(\n            CliProcessamentoDiagnosticoMessages.debugAboutToEmitJson(\n              JSON.stringify(opts),\n            ),\n          );\n        } catch {}\n      }\n      if (opts.json) {\n        // Agregar ocorrncias de TODO_PENDENTE por arquivo\n        const ocorrenciasOriginais = ocorrenciasFiltradas;\n        const todosPorArquivo = new Map<string, typeof ocorrenciasOriginais>();\n\n        // Separar TODOs dos outros tipos de ocorrncia\n        const naoTodos: typeof ocorrenciasOriginais = [];\n        for (const ocorrencia of ocorrenciasOriginais) {\n          if (ocorrencia.tipo === 'TODO_PENDENTE') {\n            const relPath = ocorrencia.relPath || 'desconhecido';\n            if (!todosPorArquivo.has(relPath)) {\n              todosPorArquivo.set(relPath, []);\n            }\n            const todosArray = todosPorArquivo.get(relPath);\n            if (todosArray) {\n              todosArray.push(ocorrencia);\n            }\n          } else {\n            naoTodos.push(ocorrencia);\n          }\n        }\n\n        // Agregar TODOs por arquivo\n        const todosAgregados: typeof ocorrenciasOriginais = [];\n        for (const [, todos] of todosPorArquivo) {\n          if (todos.length === 1) {\n            todosAgregados.push(todos[0]);\n          } else if (todos.length > 1) {\n            // Criar ocorrncia agregada\n            const primeira = todos[0];\n            const mensagemAgregada =\n              CliProcessamentoDiagnosticoMessages.todosPendentesEncontrados(\n                todos.length,\n              );\n            todosAgregados.push({\n              ...primeira,\n              mensagem: mensagemAgregada,\n              linha: Math.min(...todos.map((t) => t.linha || 0)),\n            });\n          }\n        }\n\n        // Combinar ocorrncias agregadas e deduplicar para reduzir rudo\n        let todasOcorrencias = [...naoTodos, ...todosAgregados];\n        todasOcorrencias = dedupeOcorrencias(todasOcorrencias);\n\n        // Em modo --json: emitir apenas erros e localizaes (sem mtricas/caches/tempos).\n        // Antes, normaliza para enriquecer `linha/coluna` quando disponvel via `loc`.\n        const ocorrenciasParaJson = todasOcorrencias\n          .map((o) => normalizarOcorrenciaParaJson(o))\n          .filter((o) => {\n            const nivel = (o.nivel || 'info') as string;\n            return nivel === 'erro' || o.tipo === 'PARSE_ERRO';\n          });\n        const totalOcorrenciasJson = ocorrenciasParaJson.length;\n\n        // Agregar tipos de ocorrncias\n        const tiposOcorrencias: Record<string, number> = {};\n        const parseErros: ParseErrosJson = {\n          totalOriginais: 0,\n          totalExibidos: 0,\n          agregados: 0,\n        };\n\n        // Contar tipos de ocorrncias e parse erros\n        for (const ocorrencia of ocorrenciasParaJson) {\n          const tipo = ocorrencia.tipo || 'desconhecido';\n          tiposOcorrencias[tipo] = (tiposOcorrencias[tipo] || 0) + 1;\n\n          // Contar parse erros\n          if (tipo === 'PARSE_ERRO') {\n            parseErros.totalOriginais++;\n            parseErros.totalExibidos++;\n          }\n        }\n\n        // Ler parse erros das variveis globais (para testes e cenrios especiais)\n        const parseErrosGlobais =\n          ((globalThis as Record<string, unknown>)\n            .__ORACULO_PARSE_ERROS__ as unknown[]) || [];\n        const parseErrosOriginais =\n          ((globalThis as Record<string, unknown>)\n            .__ORACULO_PARSE_ERROS_ORIGINAIS__ as number) || 0;\n\n        // Adicionar parse erros globais  contagem\n        if (parseErrosGlobais.length > 0 || parseErrosOriginais > 0) {\n          parseErros.totalOriginais = Math.max(\n            parseErros.totalOriginais,\n            parseErrosOriginais,\n          );\n\n          // Se h array global, usar seu tamanho; seno, manter o valor atual (que vem das ocorrncias reais)\n          if (parseErrosGlobais.length > 0) {\n            parseErros.totalExibidos = Math.min(\n              parseErros.totalOriginais,\n              parseErrosGlobais.length,\n            );\n          }\n          // Se no h array global, totalExibidos j foi definido com o nmero de ocorrncias reais\n\n          // Atualizar totalOcorrencias se h parse erros\n          if (parseErrosOriginais > 0) {\n            totalOcorrencias = Math.max(totalOcorrencias, parseErrosOriginais);\n          }\n        }\n\n        // Calcular agregados\n        parseErros.agregados = Math.max(\n          0,\n          parseErros.totalOriginais - parseErros.totalExibidos,\n        );\n\n        // Determinar status baseado nas regras\n        let status = 'ok';\n        if (totalOcorrenciasJson > 0) {\n          status = 'problemas';\n          // Se h PARSE_ERRO e PARSE_ERRO_FALHA est ativo, marcar como erro\n          if (parseErros.totalOriginais > 0 && config.PARSE_ERRO_FALHA) {\n            status = 'erro';\n          }\n        }\n\n        const saidaJson: SaidaJsonDiagnostico = {\n          status: status as 'ok' | 'problemas' | 'erro',\n          totalOcorrencias: totalOcorrenciasJson,\n          guardian: guardianResultado ? 'verificado' : 'nao-verificado',\n          tiposOcorrencias,\n          parseErros,\n          ocorrencias: ocorrenciasParaJson,\n          linguagens: { total: 0, extensoes: {} }, // ser preenchido depois\n        };\n\n        // S incluir estruturaIdentificada se houver resultado de arquetipos\n        if (arquetiposResultado) {\n          saidaJson.estruturaIdentificada = {\n            melhores: arquetiposResultado.candidatos || [],\n            baseline: arquetiposResultado.baseline || null,\n            drift: arquetiposResultado.drift || {\n              alterouArquetipo: false,\n              deltaConfidence: 0,\n              arquivosRaizNovos: [],\n              arquivosRaizRemovidos: [],\n            },\n          };\n        }\n\n        // JSON ser emitido usando helper centralizado que aplica escapes Unicode\n\n        // Computa linguagens a partir dos file entries com AST (ou sem AST)\n        const computeLinguagens = (\n          fes: (FileEntry | FileEntryWithAst)[],\n        ): LinguagensJson => {\n          const extensoes: Record<string, number> = {};\n          let sem_ext = 0;\n          for (const f of fes || []) {\n            const rel = f.relPath || f.fullPath || '';\n            const base = rel.split(/[\\\\/]/).pop() || '';\n            const idx = base.lastIndexOf('.');\n            if (idx === -1) {\n              sem_ext++;\n            } else {\n              const ext = base.slice(idx + 1) || 'sem_ext';\n              extensoes[ext] = (extensoes[ext] || 0) + 1;\n            }\n          }\n          return {\n            total: (fes || []).length,\n            extensoes: { ...extensoes, sem_ext },\n          };\n        };\n\n        const linguagensFinal = computeLinguagens(\n          fileEntriesComAst || fileEntries,\n        );\n\n        // Anexa valores calculados\n        saidaJson.linguagens = linguagensFinal;\n\n        // Gerar JSON usando utilitrio comum com escape Unicode\n        try {\n          // Adicionar metadados de verso do schema e timestamp para compatibilidade\n          const schemaMeta = {\n            schemaVersion: '1.0.0',\n            oraculoVersion: '0.0.0',\n            timestamp: new Date().toISOString(),\n          };\n          const saidaComMeta = { ...schemaMeta, ...saidaJson };\n          // Verificar flag CLI/opt para ascii-only\n          const asciiOnly = Boolean(\n            (opts && (opts as OpcoesProcessamentoDiagnostico).jsonAscii) ||\n            false,\n          );\n          console.log(stringifyJsonEscaped(saidaComMeta, 2, { asciiOnly }));\n          _jsonEmitted = true;\n        } catch (e) {\n          console.error(\n            CliProcessamentoDiagnosticoMessages.errorGeneratingJson,\n            e,\n          );\n          console.log(\n            CliProcessamentoDiagnosticoMessages.fallbackJson,\n            JSON.stringify(saidaJson),\n          );\n          _jsonEmitted = true;\n        }\n        // Exit codes padronizados: 0=ok/avisos, 1=erros, 2=critico (parse erros fatais)\n        if (!process.env.VITEST) {\n          const erros = (nivelOcorrencias.get('erro') || 0) as number;\n          const exitCode =\n            parseErros.totalOriginais > 0 && config.PARSE_ERRO_FALHA\n              ? 2\n              : erros > 0\n                ? 1\n                : 0;\n          process.exit(exitCode);\n        }\n      }\n\n      // Logs finais fora do modo JSON e quando no  scan-only\n      if (!opts.json && !config.SCAN_ONLY) {\n        // Imprimir bloco de resumo de tipos se houver ocorrncias\n        if (totalOcorrencias > 0 && ocorrenciasFiltradas) {\n          // Modo executivo: apenas problemas crticos e altos\n          if (opts.executive) {\n            const { gerarResumoExecutivo } =\n              await import('@relatorios/filtro-inteligente.js');\n            const resumoExec = gerarResumoExecutivo(ocorrenciasFiltradas);\n            if (resumoExec.detalhes.length > 0) {\n              const linhasExec = resumoExec.detalhes.map(\n                (problema) =>\n                  `${problema.icone} ${problema.titulo.padEnd(25)} ${problema.quantidade.toString().padStart(6)}`,\n              );\n\n              const tituloExec =\n                CliProcessamentoDiagnosticoMessages.resumoExecutivoTitulo(\n                  resumoExec.problemasCriticos + resumoExec.problemasAltos,\n                );\n              const cabecalhoExec = [\n                `${CliProcessamentoDiagnosticoMessages.cabecalhoExecProblema.padEnd(30)}${CliProcessamentoDiagnosticoMessages.cabecalhoExecQtd.padStart(6)}`,\n              ];\n\n              if (\n                'imprimirBloco' in log &&\n                typeof log.imprimirBloco === 'function'\n              ) {\n                log.imprimirBloco(tituloExec, [\n                  ...cabecalhoExec,\n                  ...linhasExec,\n                ]);\n              }\n\n              console.log(\n                CliProcessamentoDiagnosticoMessages.dicaUseFull(\n                  totalOcorrencias,\n                ),\n              );\n            } else {\n              console.log(\n                CliProcessamentoDiagnosticoMessages.projetoBomEstado(\n                  totalOcorrencias,\n                ),\n              );\n              if (resumoExec.quickFixes > 0) {\n                console.log(\n                  CliProcessamentoDiagnosticoMessages.quickFixesDisponiveis(\n                    resumoExec.quickFixes,\n                  ),\n                );\n              }\n            }\n          } else {\n            // Modo padro: todos os tipos\n            const tiposResumo: Record<string, number> = {};\n            for (const ocorrencia of ocorrenciasFiltradas) {\n              const tipo = ocorrencia.tipo || 'desconhecido';\n              tiposResumo[tipo] = (tiposResumo[tipo] || 0) + 1;\n            }\n\n            const linhasResumo = Object.entries(tiposResumo).map(\n              ([tipo, qtd]) =>\n                `${tipo.padEnd(20)} ${qtd.toString().padStart(8)}`,\n            );\n\n            const tituloResumo =\n              CliProcessamentoDiagnosticoMessages.resumoTiposTitulo;\n            const cabecalho = [\n              `${CliProcessamentoDiagnosticoMessages.cabecalhoResumoTipo.padEnd(20)}${CliProcessamentoDiagnosticoMessages.cabecalhoResumoQuantidade.padStart(8)}`,\n            ];\n\n            if (\n              'imprimirBloco' in log &&\n              typeof log.imprimirBloco === 'function'\n            ) {\n              log.imprimirBloco(tituloResumo, [...cabecalho, ...linhasResumo]);\n            }\n          }\n        }\n\n        // Mensagem final\n        // Emitir 'Tudo pronto' apenas uma vez\n        if (\n          !config.COMPACT_MODE &&\n          !process.env.__ORACULO_TUDO_PRONTO_EMITIDO\n        ) {\n          log.info(CliProcessamentoDiagnosticoMessages.tudoPronto);\n          (\n            process.env as unknown as Record<string, string>\n          ).__ORACULO_TUDO_PRONTO_EMITIDO = '1';\n        }\n\n        // Log de diagnstico concludo para testes\n        if (process.env.VITEST) {\n          log.info(CliProcessamentoDiagnosticoMessages.diagnosticoConcluido);\n        }\n      }\n    }\n\n    // Relatrios e exportao (executa mesmo quando arquetiposResultado undefined)\n    if (!opts.json && !config.SCAN_ONLY) {\n      (log as typeof log & LogExtensions).fase?.('Gerando relatrios');\n      try {\n        const contextoConselho = {\n          hora: new Date().getHours(),\n          arquivosParaCorrigir: totalOcorrencias,\n          arquivosParaPodar: 0,\n          totalOcorrenciasAnaliticas: totalOcorrencias,\n          integridadeGuardian: guardianResultado?.status || 'nao-verificado',\n        };\n        emitirConselhoOracular(contextoConselho);\n\n        if (config.REPORT_EXPORT_ENABLED) {\n          const ts = new Date().toISOString().replace(/[:.]/g, '-');\n          const dir =\n            typeof config.REPORT_OUTPUT_DIR === 'string'\n              ? config.REPORT_OUTPUT_DIR\n              : path.join(baseDir, 'oraculo-reports');\n\n          const fs = await import('node:fs');\n          await fs.promises.mkdir(dir, { recursive: true });\n\n          const outputPath = path.join(dir, `oraculo-diagnostico-${ts}.md`);\n          const resultadoCompleto = {\n            ...resultadoExecucao,\n            fileEntries: fileEntriesComAst,\n            guardian: guardianResultado,\n          } as ResultadoInquisicaoCompleto;\n          // Nota: a gerao de Markdown ser feita aps a fragmentao/export\n          // para que possamos incluir no relatrio links para o manifest e shards.\n\n          // Monta e salva dois artefatos: um SUMMARY (sempre) e opcionalmente o FULL (pesado)\n          try {\n            // Agregar mtricas de analistas por nome (em vez de uma entrada por arquivo)\n            const metricasOriginais = resultadoExecucao.metricas;\n            const analistasAgregados: Record<\n              string,\n              { duracaoMs: number; ocorrencias: number; execucoes: number }\n            > = {};\n            for (const a of metricasOriginais?.analistas || []) {\n              const nome = a.nome || 'desconhecido';\n              if (!analistasAgregados[nome]) {\n                analistasAgregados[nome] = {\n                  duracaoMs: 0,\n                  ocorrencias: 0,\n                  execucoes: 0,\n                };\n              }\n              analistasAgregados[nome].duracaoMs += a.duracaoMs || 0;\n              analistasAgregados[nome].ocorrencias += a.ocorrencias || 0;\n              analistasAgregados[nome].execucoes += 1;\n            }\n            const analistasResumidos = Object.entries(analistasAgregados)\n              .map(([nome, dados]) => ({\n                nome,\n                duracaoTotalMs: Math.round(dados.duracaoMs * 100) / 100,\n                ocorrenciasTotal: dados.ocorrencias,\n                execucoes: dados.execucoes,\n              }))\n              .sort((a, b) => b.ocorrenciasTotal - a.ocorrenciasTotal);\n\n            // Mtricas resumidas (sem o array gigante de analistas por arquivo)\n            const metricasResumidas = {\n              totalArquivos: metricasOriginais?.totalArquivos,\n              tempoParsingMs: metricasOriginais?.tempoParsingMs,\n              tempoAnaliseMs: metricasOriginais?.tempoAnaliseMs,\n              cacheAstHits: metricasOriginais?.cacheAstHits,\n              cacheAstMiss: metricasOriginais?.cacheAstMiss,\n              analistas: analistasResumidos,\n            };\n\n            // Ocorrncias limpas: apenas campos essenciais\n            const ocorrenciasLimpas = dedupeOcorrencias(\n              resultadoExecucao.ocorrencias || [],\n            )\n              .slice(0, 2000)\n              .map((oc) => {\n                const ocAny = oc as Record<string, unknown>;\n                return {\n                  tipo: oc.tipo,\n                  nivel: oc.nivel,\n                  mensagem: oc.mensagem,\n                  relPath: oc.relPath,\n                  linha: oc.linha,\n                  coluna: oc.coluna,\n                  ...(ocAny.sugestao ? { sugestao: ocAny.sugestao } : {}),\n                };\n              });\n\n            const relatorioSummary = {\n              timestamp: new Date().toISOString(),\n              totalOcorrencias,\n              baselineModificado: Boolean(\n                guardianResultado &&\n                (\n                  guardianResultado as unknown as {\n                    baselineModificado?: boolean;\n                  }\n                ).baselineModificado,\n              ),\n              // verso resumida: mtricas agregadas e ocorrncias limpas\n              metricas: metricasResumidas,\n              ocorrencias: ocorrenciasLimpas,\n            };\n\n            const salvar = await getSalvarEstado();\n            await salvar(\n              path.join(dir, `oraculo-relatorio-summary-${ts}.json`),\n              relatorioSummary,\n            );\n\n            // Se exportao full estiver ativa, grava tambm o payload completo em arquivo separado\n            let fragmentResult:\n              | { manifestFile?: string; manifest?: unknown }\n              | undefined = undefined;\n            if (config.REPORT_EXPORT_FULL) {\n              const relatorioFull = {\n                timestamp: new Date().toISOString(),\n                totalOcorrencias,\n                baselineModificado: Boolean(\n                  guardianResultado &&\n                  (\n                    guardianResultado as unknown as {\n                      baselineModificado?: boolean;\n                    }\n                  ).baselineModificado,\n                ),\n                resultado: resultadoCompleto,\n              };\n              // Se o relatrio for muito grande, fragmentar em mltiplos arquivos para evitar arquivos gigantes\n              try {\n                fragmentResult = await fragmentarRelatorio(\n                  relatorioFull,\n                  dir,\n                  ts,\n                  {\n                    maxOcorrenciasPerShard: config.REPORT_FRAGMENT_OCCURRENCES,\n                    maxFileEntriesPerShard: config.REPORT_FRAGMENT_FILEENTRIES,\n                  },\n                );\n                // Registrar no log onde est o manifest\n                log.info(\n                  CliProcessamentoDiagnosticoMessages.relatorioFullFragmentado(\n                    fragmentResult.manifestFile,\n                  ),\n                );\n              } catch {\n                // Fallback: salvar como nico arquivo caso a fragmentao falhe\n                await salvar(\n                  path.join(dir, `oraculo-relatorio-full-${ts}.json`),\n                  relatorioFull,\n                );\n              }\n            }\n\n            // Gerar o Markdown do diagnstico agora (inclui links/manifest quando disponvel)\n            try {\n              await gerarRelatorioMarkdown(\n                resultadoCompleto,\n                outputPath,\n                !opts.full,\n                {\n                  manifestFile: fragmentResult?.manifestFile,\n                  relatoriosDir: dir,\n                  ts,\n                  hadFull: Boolean(fragmentResult),\n                },\n              );\n            } catch (e) {\n              log.aviso(\n                CliProcessamentoDiagnosticoMessages.falhaGerarRelatorioMarkdownMetadados(\n                  (e as Error).message,\n                ),\n              );\n              // Tenta gerar sem opes como fallback\n              await gerarRelatorioMarkdown(\n                resultadoCompleto,\n                outputPath,\n                !opts.full,\n              );\n            }\n\n            // Relatrio adicional: otimizao de SVG (agrupado por diretrio)\n            try {\n              const { exportarRelatorioSvgOtimizacao } =\n                await import('@cli/diagnostico/exporters/svg-otimizacao-exporter.js');\n              await exportarRelatorioSvgOtimizacao({\n                entries: fileEntriesComAst,\n                relatoriosDir: dir,\n                ts,\n              });\n            } catch {\n              // No crtico  export adicional no deve falhar o diagnstico\n            }\n\n            log.sucesso(\n              CliProcessamentoDiagnosticoMessages.relatoriosExportadosPara(dir),\n            );\n          } catch (e) {\n            log.erro(\n              CliProcessamentoDiagnosticoMessages.falhaSalvarRelatorioJson(\n                (e as Error).message,\n              ),\n            );\n          }\n        }\n      } catch (e) {\n        log.erro(\n          CliProcessamentoDiagnosticoMessages.falhaExportarRelatorios(\n            (e as Error).message,\n          ),\n        );\n      }\n    }\n\n    // Garantir impresso de resumo e despedida caso ainda no tenham sido exibidos\n    if (!opts.json && !config.SCAN_ONLY) {\n      try {\n        // Se houver ocorrncias, exibe resumo de tipos (mesma lgica usada acima)\n        if (totalOcorrencias > 0 && resultadoExecucao && ocorrenciasFiltradas) {\n          const tiposResumo: Record<string, number> = {};\n          for (const ocorrencia of ocorrenciasFiltradas) {\n            const tipo = ocorrencia.tipo || 'desconhecido';\n            tiposResumo[tipo] = (tiposResumo[tipo] || 0) + 1;\n          }\n          const linhasResumo = Object.entries(tiposResumo).map(\n            ([tipo, qtd]) => `${tipo.padEnd(20)} ${qtd.toString().padStart(8)}`,\n          );\n          const tituloResumo =\n            CliProcessamentoDiagnosticoMessages.resumoTiposTitulo;\n          const cabecalho = [\n            `${CliProcessamentoDiagnosticoMessages.cabecalhoResumoTipo.padEnd(20)}${CliProcessamentoDiagnosticoMessages.cabecalhoResumoQuantidade.padStart(8)}`,\n          ];\n          if (\n            'imprimirBloco' in log &&\n            typeof log.imprimirBloco === 'function'\n          ) {\n            log.imprimirBloco(tituloResumo, [...cabecalho, ...linhasResumo]);\n          }\n        }\n\n        if (\n          !config.COMPACT_MODE &&\n          !process.env.__ORACULO_TUDO_PRONTO_EMITIDO\n        ) {\n          log.info(CliProcessamentoDiagnosticoMessages.tudoPronto);\n          (\n            process.env as unknown as Record<string, string>\n          ).__ORACULO_TUDO_PRONTO_EMITIDO = '1';\n        }\n      } catch {}\n    }\n\n    // Quando no houve `arquetiposResultado`, ainda precisamos suportar\n    // `--json`: emitir o JSON final mesmo sem os dados de arquetipos.\n    if (opts.json) {\n      // Reproduz o mesmo comportamento de gerao de JSON usado acima,\n      // mas tolera arquetiposResultado undefined.\n      const ocorrenciasOriginais = dedupeOcorrencias(\n        resultadoExecucao.ocorrencias || [],\n      );\n      const todosPorArquivo = new Map<string, typeof ocorrenciasOriginais>();\n      const naoTodos: typeof ocorrenciasOriginais = [];\n      for (const ocorrencia of ocorrenciasOriginais) {\n        if (ocorrencia.tipo === 'TODO_PENDENTE') {\n          const relPath = ocorrencia.relPath || 'desconhecido';\n          if (!todosPorArquivo.has(relPath)) todosPorArquivo.set(relPath, []);\n          const ocorrenciasArquivo = todosPorArquivo.get(relPath);\n          if (ocorrenciasArquivo) ocorrenciasArquivo.push(ocorrencia);\n        } else {\n          naoTodos.push(ocorrencia);\n        }\n      }\n\n      // Mensagem final apenas quando repositrio est limpo\n      try {\n        if (!opts.json && !config.SCAN_ONLY && totalOcorrencias === 0) {\n          logRelatorio.repositorioImpecavel();\n        }\n      } catch {}\n\n      const todosAgregados: typeof ocorrenciasOriginais = [];\n      for (const [, todos] of todosPorArquivo) {\n        if (todos.length === 1) todosAgregados.push(todos[0]);\n        else if (todos.length > 1) {\n          const primeira = todos[0];\n          const mensagemAgregada =\n            CliProcessamentoDiagnosticoMessages.todosPendentesEncontrados(\n              todos.length,\n            );\n          todosAgregados.push({\n            ...primeira,\n            mensagem: mensagemAgregada,\n            linha: Math.min(...todos.map((t) => t.linha || 0)),\n          });\n        }\n      }\n\n      let todasOcorrencias = [...naoTodos, ...todosAgregados];\n      todasOcorrencias = dedupeOcorrencias(todasOcorrencias);\n\n      // Em modo --json, queremos reduzir o payload ao essencial.\n      // Emitimos apenas ocorrncias de nvel \"erro\" (inclui PARSE_ERRO).\n      const ocorrenciasParaJson = todasOcorrencias.filter((o) => {\n        const nivel = (o.nivel || 'info') as string;\n        return nivel === 'erro' || o.tipo === 'PARSE_ERRO';\n      });\n      const tiposOcorrencias: Record<string, number> = {};\n      const parseErros: ParseErrosJson = {\n        totalOriginais: 0,\n        totalExibidos: 0,\n        agregados: 0,\n      };\n      for (const ocorrencia of ocorrenciasParaJson) {\n        const tipo = ocorrencia.tipo || 'desconhecido';\n        tiposOcorrencias[tipo] = (tiposOcorrencias[tipo] || 0) + 1;\n        if (tipo === 'PARSE_ERRO') {\n          parseErros.totalOriginais++;\n          parseErros.totalExibidos++;\n        }\n      }\n\n      const parseErrosGlobais =\n        ((globalThis as Record<string, unknown>)\n          .__ORACULO_PARSE_ERROS__ as unknown[]) || [];\n      const parseErrosOriginais =\n        ((globalThis as Record<string, unknown>)\n          .__ORACULO_PARSE_ERROS_ORIGINAIS__ as number) || 0;\n      if (parseErrosGlobais.length > 0 || parseErrosOriginais > 0) {\n        parseErros.totalOriginais = Math.max(\n          parseErros.totalOriginais,\n          parseErrosOriginais,\n        );\n        if (parseErrosGlobais.length > 0) {\n          parseErros.totalExibidos = Math.min(\n            parseErros.totalOriginais,\n            parseErrosGlobais.length,\n          );\n        }\n        if (parseErrosOriginais > 0) {\n          totalOcorrencias = Math.max(totalOcorrencias, parseErrosOriginais);\n        }\n      }\n      parseErros.agregados = Math.max(\n        0,\n        parseErros.totalOriginais - parseErros.totalExibidos,\n      );\n\n      let status = 'ok';\n      if (ocorrenciasParaJson.length > 0) {\n        status = 'problemas';\n        if (parseErros.totalOriginais > 0 && config.PARSE_ERRO_FALHA)\n          status = 'erro';\n      }\n\n      const saidaJson: SaidaJsonDiagnostico = {\n        status: status as 'ok' | 'problemas' | 'erro',\n        totalOcorrencias: ocorrenciasParaJson.length,\n        guardian: guardianResultado ? 'verificado' : 'nao-verificado',\n        tiposOcorrencias,\n        parseErros,\n        ocorrencias: ocorrenciasParaJson,\n        linguagens: { total: 0, extensoes: {} },\n      };\n\n      // Quando no h dados de arquetipos, omitimos `estruturaIdentificada` no JSON\n      // (o fluxo principal j trata de inclu-lo quando disponvel).\n\n      const computeLinguagens = (\n        fes: (FileEntry | FileEntryWithAst)[],\n      ): LinguagensJson => {\n        const extensoes: Record<string, number> = {};\n        let sem_ext = 0;\n        for (const f of fes || []) {\n          const rel = f.relPath || f.fullPath || '';\n          const base = rel.split(/[\\\\/\\\\\\\\]/).pop() || '';\n          const idx = base.lastIndexOf('.');\n          if (idx === -1) {\n            sem_ext++;\n          } else {\n            const ext = base.slice(idx + 1) || 'sem_ext';\n            extensoes[ext] = (extensoes[ext] || 0) + 1;\n          }\n        }\n        return {\n          total: (fes || []).length,\n          extensoes: { ...extensoes, sem_ext },\n        };\n      };\n\n      const linguagensFinal = computeLinguagens(\n        fileEntriesComAst || fileEntries,\n      );\n      saidaJson.linguagens = linguagensFinal;\n\n      if (!_jsonEmitted) {\n        try {\n          // Adicionar metadados de verso do schema e timestamp para compatibilidade\n          let pkgVersion = '0.0.0';\n          try {\n            const pkgRaw = await fs.promises.readFile(\n              path.join(process.cwd(), 'package.json'),\n              'utf-8',\n            );\n            const pkgObj = JSON.parse(pkgRaw) as { version?: string };\n            if (pkgObj && typeof pkgObj.version === 'string')\n              pkgVersion = pkgObj.version;\n          } catch {}\n          const schemaMeta = {\n            schemaVersion: '1.0.0',\n            oraculoVersion: pkgVersion,\n            timestamp: new Date().toISOString(),\n          };\n          const saidaComMeta = { ...schemaMeta, ...saidaJson };\n          const asciiOnly = Boolean(\n            (opts && (opts as OpcoesProcessamentoDiagnostico).jsonAscii) ||\n            false,\n          );\n          console.log(stringifyJsonEscaped(saidaComMeta, 2, { asciiOnly }));\n          _jsonEmitted = true;\n\n          // Se a exportao estiver habilitada via flags globais/locais, salvamos o JSON em disco\n          if (config.REPORT_EXPORT_ENABLED) {\n            try {\n              const ts = new Date().toISOString().replace(/[:.]/g, '-');\n              const dir =\n                typeof config.REPORT_OUTPUT_DIR === 'string'\n                  ? config.REPORT_OUTPUT_DIR\n                  : path.join(baseDir, 'oraculo-reports');\n              const fs = await import('node:fs');\n              await fs.promises.mkdir(dir, { recursive: true });\n              const salvar = await getSalvarEstado();\n              await salvar(\n                path.join(dir, `oraculo-diagnostico-${ts}.json`),\n                saidaComMeta,\n              );\n              log.sucesso(\n                CliProcessamentoDiagnosticoMessages.relatoriosExportadosPara(\n                  dir,\n                ),\n              );\n            } catch (e) {\n              log.erro(\n                CliProcessamentoDiagnosticoMessages.falhaSalvarRelatorioJson(\n                  (e as Error).message,\n                ),\n              );\n            }\n          }\n        } catch (e) {\n          console.error(\n            CliProcessamentoDiagnosticoMessages.errorGeneratingJson,\n            e,\n          );\n          console.log(\n            CliProcessamentoDiagnosticoMessages.fallbackJson,\n            JSON.stringify(saidaJson),\n          );\n          _jsonEmitted = true;\n        }\n      }\n      // Exit codes padronizados: 0=ok/avisos, 1=erros, 2=critico (parse erros fatais)\n      if (!process.env.VITEST) {\n        const erros = (nivelOcorrencias.get('erro') || 0) as number;\n        const exitCode =\n          parseErros.totalOriginais > 0 && config.PARSE_ERRO_FALHA\n            ? 2\n            : erros > 0\n              ? 1\n              : 0;\n        process.exit(exitCode);\n      }\n    }\n  } catch (error) {\n    // Se o erro for resultado de um process.exit mocked (ex.: Error('exit:1'))\n    // devemos repropagar para que os testes possam captur-lo. Evitamos\n    // engolir erros que representam encerramento do processo.\n    try {\n      if (\n        error &&\n        typeof error === 'object' &&\n        'message' in error &&\n        typeof (error as { message?: unknown }).message === 'string' &&\n        String((error as { message: string }).message).startsWith('exit:')\n      ) {\n        throw error;\n      }\n    } catch (re) {\n      throw re;\n    }\n    // Tratamento de erro geral para o processamento do diagnstico\n    // Normaliza mensagens que podem ser string, Error ou outro objeto\n    const errMsg =\n      typeof error === 'string'\n        ? error\n        : error instanceof Error\n          ? error.message\n          : (() => {\n              try {\n                return JSON.stringify(error);\n              } catch {\n                return String(error);\n              }\n            })();\n\n    log.erro(CliProcessamentoDiagnosticoMessages.erroFatalDiagnostico(errMsg));\n\n    // Em modo de desenvolvimento, mostrar stack trace\n    if (config.DEV_MODE) {\n      console.error(error);\n    }\n\n    // Retornar resultado com erro\n    return {\n      totalOcorrencias: 1,\n      temErro: true,\n      guardianResultado,\n      fileEntriesComAst: [],\n      resultadoFinal: {\n        ocorrencias: [],\n        metricas: {\n          totalArquivos: 0,\n          tempoTotal: 0,\n          analistas: [],\n        },\n      },\n    };\n  }\n\n  // Mensagem final apenas quando repositrio est limpo (fallback)\n  try {\n    if (!opts.json && !config.SCAN_ONLY && totalOcorrencias === 0) {\n      logRelatorio.repositorioImpecavel();\n    }\n  } catch {}\n\n  // Fallback para garantir que a funo sempre retorna um valor\n  return {\n    totalOcorrencias: totalOcorrencias || 0,\n    temErro: false,\n    guardianResultado,\n    fileEntriesComAst: [],\n    resultadoFinal: {\n      ocorrencias: [],\n      metricas: {\n        totalArquivos: 0,\n        tempoTotal: 0,\n        analistas: [],\n      },\n    },\n  };\n}\n"]}