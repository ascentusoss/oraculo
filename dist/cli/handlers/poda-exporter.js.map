{"version":3,"file":"poda-exporter.js","sourceRoot":"","sources":["../../../src/cli/handlers/poda-exporter.ts"],"names":[],"mappings":"AAMA,OAAO,EAAE,QAAQ,IAAI,EAAE,EAAE,MAAM,SAAS,CAAC;AACzC,OAAO,IAAI,MAAM,WAAW,CAAC;AAE7B,OAAO,EAAE,MAAM,EAAE,MAAM,wBAAwB,CAAC;AAChD,OAAO,EAAE,oBAAoB,EAAE,MAAM,8CAA8C,CAAC;AACpF,OAAO,EAAE,GAAG,EAAE,MAAM,yBAAyB,CAAC;AAC9C,OAAO,EACL,sBAAsB,EACtB,0BAA0B,GAC3B,MAAM,+BAA+B,CAAC;AAmBvC,MAAM,CAAC,KAAK,UAAU,sBAAsB,CAC1C,OAA0B;IAE1B,IAAI,CAAC,MAAM,CAAC,qBAAqB,EAAE,CAAC;QAClC,OAAO,IAAI,CAAC;IACd,CAAC;IAED,IAAI,CAAC;QACH,MAAM,EAAE,OAAO,EAAE,OAAO,EAAE,SAAS,EAAE,QAAQ,EAAE,GAAG,OAAO,CAAC;QAG1D,MAAM,GAAG,GACP,OAAO,MAAM,CAAC,iBAAiB,KAAK,QAAQ;YAC1C,CAAC,CAAC,MAAM,CAAC,iBAAiB;YAC1B,CAAC,CAAC,IAAI,CAAC,IAAI,CAAC,OAAO,EAAE,YAAY,CAAC,CAAC;QAGvC,MAAM,EAAE,CAAC,KAAK,CAAC,GAAG,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;QAGzC,MAAM,EAAE,GAAG,IAAI,IAAI,EAAE,CAAC,WAAW,EAAE,CAAC,OAAO,CAAC,OAAO,EAAE,GAAG,CAAC,CAAC;QAC1D,MAAM,QAAQ,GAAG,gBAAgB,EAAE,EAAE,CAAC;QAGtC,MAAM,SAAS,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,QAAQ,KAAK,CAAC,CAAC;QACnD,MAAM,0BAA0B,CAAC,SAAS,EAAE,OAAO,EAAE,SAAS,EAAE;YAC9D,QAAQ;SACT,CAAC,CAAC;QAGH,MAAM,WAAW,GAAG,IAAI,CAAC,IAAI,CAAC,GAAG,EAAE,GAAG,QAAQ,OAAO,CAAC,CAAC;QACvD,MAAM,sBAAsB,CAAC,WAAW,EAAE,OAAO,EAAE,SAAS,CAAC,CAAC;QAG9D,GAAG,CAAC,OAAO,CAAC,oBAAoB,CAAC,IAAI,CAAC,oBAAoB,CAAC,GAAG,CAAC,CAAC,CAAC;QAEjE,OAAO;YACL,QAAQ,EAAE,SAAS;YACnB,IAAI,EAAE,WAAW;YACjB,GAAG;SACJ,CAAC;IACJ,CAAC;IAAC,OAAO,KAAK,EAAE,CAAC;QACf,GAAG,CAAC,IAAI,CAAC,oBAAoB,CAAC,IAAI,CAAC,aAAa,CAAE,KAAe,CAAC,OAAO,CAAC,CAAC,CAAC;QAE5E,MAAM,KAAK,CAAC;IACd,CAAC;AACH,CAAC","sourcesContent":["// SPDX-License-Identifier: MIT\n/**\n * Handler para exportação de relatórios de poda\n * Consolida lógica duplicada de geração de relatórios Markdown e JSON\n */\n\nimport { promises as fs } from 'node:fs';\nimport path from 'node:path';\n\nimport { config } from '/config/config.js';\nimport { CliExportersMessages } from '/messages/cli/cli-exporters-messages.js';\nimport { log } from '/messages/index.js';\nimport {\n  gerarRelatorioPodaJson,\n  gerarRelatorioPodaMarkdown,\n} from '/relatorio-poda.js';\n\nimport type { PodaExportOptions, PodaExportResult } from '@';\n\n// Re-export para compatibilidade\nexport type { PodaExportOptions, PodaExportResult };\n\n/**\n * Exporta relatórios de poda (Markdown e JSON)\n *\n * Centraliza a lógica de:\n * - Criação de diretório de relatórios\n * - Geração de timestamp único\n * - Exportação em ambos os formatos\n * - Tratamento de erros\n *\n *  options - Opções de exportação\n *  Caminhos dos arquivos gerados ou null em caso de erro\n */\nexport async function exportarRelatoriosPoda(\n  options: PodaExportOptions,\n): Promise<PodaExportResult | null> {\n  if (!config.REPORT_EXPORT_ENABLED) {\n    return null;\n  }\n\n  try {\n    const { baseDir, podados, pendentes, simulado } = options;\n\n    // Determinar diretório de saída\n    const dir =\n      typeof config.REPORT_OUTPUT_DIR === 'string'\n        ? config.REPORT_OUTPUT_DIR\n        : path.join(baseDir, 'relatorios');\n\n    // Criar diretório se não existir\n    await fs.mkdir(dir, { recursive: true });\n\n    // Gerar timestamp único para os arquivos\n    const ts = new Date().toISOString().replace(/[:.]/g, '-');\n    const nomeBase = `oraculo-poda-${ts}`;\n\n    // Gerar relatório Markdown\n    const caminhoMd = path.join(dir, `${nomeBase}.md`);\n    await gerarRelatorioPodaMarkdown(caminhoMd, podados, pendentes, {\n      simulado,\n    });\n\n    // Gerar relatório JSON\n    const caminhoJson = path.join(dir, `${nomeBase}.json`);\n    await gerarRelatorioPodaJson(caminhoJson, podados, pendentes);\n\n    // Log de sucesso\n    log.sucesso(CliExportersMessages.poda.relatoriosExportados(dir));\n\n    return {\n      markdown: caminhoMd,\n      json: caminhoJson,\n      dir,\n    };\n  } catch (error) {\n    log.erro(CliExportersMessages.poda.falhaExportar((error as Error).message));\n    // Re-throw para manter comportamento original do comando\n    throw error;\n  }\n}\n"]}