{"version":3,"file":"baseline.js","sourceRoot":"","sources":["../../src/guardian/baseline.ts"],"names":[],"mappings":"AACA,OAAO,IAAI,MAAM,WAAW,CAAC;AAE7B,OAAO,EAAE,SAAS,EAAE,YAAY,EAAE,MAAM,qCAAqC,CAAC;AAE9E,OAAO,EAAE,aAAa,EAAE,MAAM,iBAAiB,CAAC;AAahD,MAAM,CAAC,KAAK,UAAU,gBAAgB;IACpC,IAAI,CAAC;QACH,MAAM,IAAI,GAAG,MAAM,SAAS,CAAmB,aAAa,CAAC,CAAC;QAC9D,IAAI,IAAI,IAAI,OAAO,IAAI,KAAK,QAAQ,IAAI,CAAC,KAAK,CAAC,OAAO,CAAC,IAAI,CAAC,EAAE,CAAC;YAC7D,MAAM,OAAO,GAAG,MAAM,CAAC,OAAO,CAAC,IAA+B,CAAC,CAAC,MAAM,CACpE,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,EAAE,EAAE,CAAC,OAAO,CAAC,KAAK,QAAQ,IAAI,OAAO,CAAC,KAAK,QAAQ,CAC3D,CAAC;YACF,OAAO,MAAM,CAAC,WAAW,CAAC,OAAO,CAAqB,CAAC;QACzD,CAAC;QACD,OAAO,IAAI,CAAC;IACd,CAAC;IAAC,MAAM,CAAC;QACP,OAAO,IAAI,CAAC;IACd,CAAC;AACH,CAAC;AAMD,MAAM,CAAC,KAAK,UAAU,cAAc,CAClC,QAA0B;IAE1B,MAAM,EAAE,GAAG,MAAM,MAAM,CAAC,SAAS,CAAC,CAAC;IACnC,MAAM,EAAE,CAAC,QAAQ,CAAC,KAAK,CAAC,IAAI,CAAC,OAAO,CAAC,aAAa,CAAC,EAAE,EAAE,SAAS,EAAE,IAAI,EAAE,CAAC,CAAC;IAC1E,MAAM,YAAY,CAAC,aAAa,EAAE,QAAQ,CAAC,CAAC;AAC9C,CAAC","sourcesContent":["// SPDX-License-Identifier: MIT\nimport path from 'node:path';\n\nimport { lerEstado, salvarEstado } from '@shared/persistence/persistencia.js';\n\nimport { BASELINE_PATH } from './constantes.js';\n\n/**\n * Representa o estado salvo de integridade de arquivos no baseline.\n * Mapeia caminho relativo de arquivo para hash (string).\n */\nexport type SnapshotBaseline = Record<string, string>;\n\n/**\n * L� o baseline atual do sistema de integridade.\n * Retorna null se o arquivo n�o existir ou estiver malformado.\n */\n\nexport async function carregarBaseline(): Promise<SnapshotBaseline | null> {\n  try {\n    const json = await lerEstado<SnapshotBaseline>(BASELINE_PATH);\n    if (json && typeof json === 'object' && !Array.isArray(json)) {\n      const entries = Object.entries(json as Record<string, unknown>).filter(\n        ([k, v]) => typeof k === 'string' && typeof v === 'string',\n      );\n      return Object.fromEntries(entries) as SnapshotBaseline;\n    }\n    return null;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * Salva um novo baseline de integridade em disco, sobrescrevendo qualquer estado anterior.\n */\n\nexport async function salvarBaseline(\n  snapshot: SnapshotBaseline,\n): Promise<void> {\n  const fs = await import('node:fs');\n  await fs.promises.mkdir(path.dirname(BASELINE_PATH), { recursive: true });\n  await salvarEstado(BASELINE_PATH, snapshot);\n}\n"]}