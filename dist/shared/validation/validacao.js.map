{"version":3,"file":"validacao.js","sourceRoot":"","sources":["../../../src/shared/validation/validacao.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport path from 'node:path';\n\nimport { ExcecoesMessages } from '/messages/core/excecoes-messages.js';\n\nimport type { ErroValidacaoCombinacao } from '@';\n\n// Re-exporta o tipo para compatibilidade\nexport type { ErroValidacaoCombinacao };\n\n/** Normaliza um caminho assegurando que permanece dentro da CWD (remove tentativas de escape). */\nexport function normalizePath(p: string): string {\n  const normalized = path.normalize(p);\n  const resolved = path.resolve(normalized);\n  const cwd = process.cwd();\n\n  // Assegurar que o caminho permanece dentro da CWD\n  if (!resolved.startsWith(cwd)) {\n    throw new Error(ExcecoesMessages.caminhoForaDaCwdNaoPermitido(p));\n  }\n\n  return normalized;\n}\n\n/** Valida se um caminho de arquivo é seguro para operações de leitura/escrita */\nexport function isPathSafe(filePath: string): boolean {\n  try {\n    const normalized = normalizePath(filePath);\n\n    // Verificar padrões perigosos\n    const dangerousPatterns = [\n      /\\.\\./, // Directory traversal\n      /^\\/etc\\//, // System directories\n      /^\\/root\\//, // Root directory\n      /^\\/sys\\//, // System files\n      /^\\/proc\\//, // Process files\n      /^C:\\\\Windows\\\\/i, // Windows system directory\n      /^C:\\\\System32\\\\/i, // Windows system32\n    ];\n\n    return !dangerousPatterns.some((pattern) => pattern.test(normalized));\n  } catch {\n    return false;\n  }\n}\n\n/** Valida se um nome de arquivo é válido e seguro */\nexport function isFilenameSafe(filename: string): boolean {\n  if (!filename || filename.length === 0) return false;\n  if (filename.length > 255) return false;\n\n  // Caracteres proibidos\n  const invalidChars = /[<>:\"|?*\\x00-\\x1f]/;\n  if (invalidChars.test(filename)) return false;\n\n  // Nomes reservados no Windows\n  const reservedNames = /^(CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])(\\.|$)/i;\n  if (reservedNames.test(filename)) return false;\n\n  return true;\n}\n\n/** Sanitiza um nome de arquivo removendo caracteres perigosos */\nexport function sanitizeFilename(filename: string): string {\n  return filename\n    .replace(/[<>:\"|?*\\x00-\\x1f]/g, '_')\n    .replace(/^(CON|PRN|AUX|NUL|COM[1-9]|LPT[1-9])(\\.|$)/i, 'file_$1$2')\n    .slice(0, 255);\n}\n\n/** Valida se uma string representa um caminho relativo válido */\nexport function isRelativePathValid(relativePath: string): boolean {\n  if (!relativePath) return false;\n  if (path.isAbsolute(relativePath)) return false;\n\n  const normalized = path.normalize(relativePath);\n  return !normalized.startsWith('..');\n}\n\n/** Extrai a extensão de um arquivo de forma segura */\nexport function getFileExtension(filename: string): string {\n  const ext = path.extname(filename);\n  return ext.toLowerCase();\n}\n\n/** Verifica se uma extensão está na lista de extensões permitidas */\nexport function isExtensionAllowed(\n  filename: string,\n  allowedExtensions: string[],\n): boolean {\n  const ext = getFileExtension(filename);\n  return allowedExtensions.includes(ext);\n}\n\n// Compatibilidade com funções originais\nexport function normalizarPathLocal(p: string): string {\n  return normalizePath(p);\n}\n\n/** Valida se um valor é um número positivo */\nexport function validarNumeroPositivo(\n  v: unknown,\n  _nome: string,\n): number | null {\n  if (typeof v === 'number' && v > 0) return v;\n  if (typeof v === 'string') {\n    const num = Number.parseFloat(v);\n    if (!Number.isNaN(num) && num > 0) return num;\n  }\n  return null;\n}\n\n/** Regras simples de combinação de flags globais. Expandir conforme novos casos. */\nexport function validarCombinacoes(\n  flags: Record<string, unknown>,\n): ErroValidacaoCombinacao[] {\n  const erros: ErroValidacaoCombinacao[] = [];\n  if (flags.scanOnly && flags.incremental) {\n    erros.push({\n      codigo: 'SCAN_INCREMENTAL',\n      mensagem:\n        'Não combinar --scan-only com --incremental (incremental exige AST).',\n    });\n  }\n  return erros;\n}\n\nexport function sanitizarFlags(flags: Record<string, unknown>): void {\n  const erros = validarCombinacoes(flags);\n  if (erros.length) {\n    const detalhe = erros.map((e) => `${e.codigo}: ${e.mensagem}`).join('; ');\n    throw new Error(detalhe);\n  }\n}\n"]}