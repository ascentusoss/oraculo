{"version":3,"file":"estrutura.js","sourceRoot":"","sources":["../../../src/shared/helpers/estrutura.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n// @oraculo-disable tipo-literal-inline-complexo\n// Justificativa: tipos locais para helpers de estrutura\nimport path from 'node:path';\n\nimport { lerEstado } from '@shared/persistence/persistencia.js';\n\nimport type { NomeacaoEstilo, OpcoesEstrategista, ParseNomeResultado } from '@';\n\n// Re-exporta os tipos para compatibilidade\nexport type { NomeacaoEstilo, OpcoesEstrategista, ParseNomeResultado };\n\nexport const CATEGORIAS_DEFAULT: Required<\n  NonNullable<OpcoesEstrategista['categoriasMapa']>\n> = {\n  controller: 'controllers',\n  controllers: 'controllers',\n  webhook: 'webhooks',\n  webhooks: 'webhooks',\n  cliente: 'clients',\n  client: 'clients',\n  service: 'services',\n  repository: 'repositories',\n  config: 'config',\n  test: '__tests__',\n  spec: '__tests__',\n  type: 'types',\n  types: 'types',\n  handler: 'handlers',\n};\n\nexport const DEFAULT_OPCOES: Required<\n  Pick<\n    OpcoesEstrategista,\n    | 'raizCodigo'\n    | 'criarSubpastasPorEntidade'\n    | 'apenasCategoriasConfiguradas'\n    | 'categoriasMapa'\n    | 'ignorarPastas'\n  >\n> &\n  Pick<OpcoesEstrategista, 'estiloPreferido'> = {\n  raizCodigo: 'src',\n  criarSubpastasPorEntidade: true,\n  apenasCategoriasConfiguradas: true,\n  estiloPreferido: 'kebab',\n  categoriasMapa: {},\n  ignorarPastas: [\n    'node_modules',\n    '.git',\n    'dist',\n    'build',\n    'coverage',\n    '.oraculo',\n  ],\n};\n\n// Presets de estrutura: baseiam-se nos defaults, aplicando ajustes de organização\nexport const PRESETS: Record<\n  string,\n  Partial<typeof DEFAULT_OPCOES> & { nome: string }\n> = {\n  oraculo: {\n    nome: 'oraculo',\n    // No preset \"oraculo\" não organizamos por entidade/domains\n    criarSubpastasPorEntidade: false,\n    apenasCategoriasConfiguradas: false,\n    categoriasMapa: { ...CATEGORIAS_DEFAULT },\n    ignorarPastas: [\n      ...DEFAULT_OPCOES.ignorarPastas,\n      'tests',\n      'tests/fixtures',\n      'src/analistas',\n      'src/arquitetos',\n      'src/relatorios',\n      'src/guardian',\n      'src/nucleo',\n      'src/cli',\n      'src/zeladores',\n    ],\n  },\n  'node-community': {\n    nome: 'node-community',\n    criarSubpastasPorEntidade: false,\n    apenasCategoriasConfiguradas: false,\n    categoriasMapa: {\n      ...CATEGORIAS_DEFAULT,\n    },\n  },\n  'ts-lib': {\n    nome: 'ts-lib',\n    criarSubpastasPorEntidade: false,\n    apenasCategoriasConfiguradas: false,\n    categoriasMapa: {\n      ...CATEGORIAS_DEFAULT,\n    },\n  },\n};\n\nexport function normalizarRel(p: string): string {\n  return p.replace(/\\\\/g, '/');\n}\n\nexport function deveIgnorar(rel: string, ignorar: string[]): boolean {\n  const norm = normalizarRel(rel);\n  // Ignora se qualquer padrão ocorrer em qualquer nível do caminho (não apenas na raiz)\n  // Exemplos suportados:\n  //  - 'node_modules' casa 'node_modules/...', 'a/b/node_modules/...'\n  //  - 'dist' casa 'dist/...', 'x/dist/...'\n  //  - padrões com subpastas ('coverage/html') ainda casam por substring segmentada\n  return ignorar.some((raw) => {\n    const pat = normalizarRel(raw);\n    if (!pat) return false;\n    if (norm === pat) return true;\n    if (norm.startsWith(`${pat}/`)) return true;\n    if (norm.endsWith(`/${pat}`)) return true;\n    // Casa por segmento intermediário:\n    //  - '/pat/' ocorre no meio do caminho\n    //  - ou qualquer segmento exatamente igual ao pat (quando pat é um único segmento)\n    if (norm.includes(`/${pat}/`)) return true;\n    if (!pat.includes('/')) {\n      const segs = norm.split('/');\n      if (segs.includes(pat)) return true;\n    }\n    return false;\n  });\n}\n\nexport function parseNomeArquivo(baseName: string): ParseNomeResultado {\n  const semExt = baseName.replace(/\\.[^.]+$/i, '');\n  const lower = semExt.toLowerCase();\n\n  // Apenas aceite categorias reconhecidas (singular/plural) para evitar falsos positivos\n  const CATS = new Set(\n    Object.keys(CATEGORIAS_DEFAULT).map((c) => c.toLowerCase()),\n  );\n\n  const dotMatch = /^(?<ent>[\\w-]+)\\.(?<cat>[\\w-]+)$/.exec(semExt);\n  if (dotMatch?.groups) {\n    const cat = dotMatch.groups.cat.toLowerCase();\n    if (CATS.has(cat)) return { entidade: dotMatch.groups.ent, categoria: cat };\n  }\n\n  const kebabMatch = /^(?<ent>[\\w-]+)-(?<cat>[\\w-]+)$/.exec(lower);\n  if (kebabMatch?.groups) {\n    const cat = kebabMatch.groups.cat.toLowerCase();\n    if (CATS.has(cat))\n      return { entidade: kebabMatch.groups.ent, categoria: cat };\n  }\n\n  const camelMatch =\n    /^(?<ent>[A-Za-z][A-Za-z0-9]*?)(?<cat>Controller|Webhook|Cliente|Client|Service|Repository)$/.exec(\n      semExt,\n    );\n  if (camelMatch?.groups)\n    return {\n      entidade: camelMatch.groups.ent,\n      categoria: camelMatch.groups.cat.toLowerCase(),\n    };\n\n  const tokens = [\n    'controller',\n    'controllers',\n    'webhook',\n    'webhooks',\n    'cliente',\n    'client',\n    'service',\n    'repository',\n  ];\n  for (const tk of tokens) {\n    if (lower.endsWith(`-${tk}`) || lower.endsWith(`.${tk}`)) {\n      const entidade = lower.replace(new RegExp(`[.-]${tk}$`), '');\n      return { entidade: entidade || null, categoria: tk };\n    }\n  }\n  return { entidade: null, categoria: null };\n}\n\nexport function destinoPara(\n  relPath: string,\n  raizCodigo: string,\n  criarSubpastasPorEntidade: boolean,\n  apenasCategoriasConfiguradas: boolean,\n  categoriasMapa: Record<string, string>,\n): { destinoDir: string | null; motivo?: string } {\n  const baseName = path.posix.basename(normalizarRel(relPath));\n  const { entidade, categoria } = parseNomeArquivo(baseName);\n  if (!categoria) return { destinoDir: null };\n\n  // Evita pluralização incorreta quando já termina com 's'\n  const normCat = categoria.toLowerCase();\n  const pastaMapeada = categoriasMapa[normCat];\n  if (!pastaMapeada && apenasCategoriasConfiguradas) {\n    return {\n      destinoDir: null,\n      motivo: `categoria ${categoria} não configurada`,\n    };\n  }\n  const pastaFinal =\n    pastaMapeada || (normCat.endsWith('s') ? normCat : `${normCat}s`);\n  if (criarSubpastasPorEntidade && entidade) {\n    const ent = entidade\n      .toString()\n      .replace(/[^a-z0-9-]/gi, '')\n      .toLowerCase();\n    const dir = path.posix.join(raizCodigo, 'domains', ent, pastaFinal);\n    return {\n      destinoDir: dir,\n      motivo: `categoria ${categoria} organizada por entidade ${ent}`,\n    };\n  }\n  return {\n    destinoDir: path.posix.join(raizCodigo, pastaFinal),\n    motivo: `categoria ${categoria} organizada por camada`,\n  };\n}\n\nexport async function carregarConfigEstrategia(\n  baseDir: string,\n  overrides?: OpcoesEstrategista,\n): Promise<Required<typeof DEFAULT_OPCOES>> {\n  const caminho = path.join(baseDir, '.oraculo', 'estrutura.json');\n  const lido = await lerEstado<Record<string, unknown> | []>(caminho);\n  const cfgArquivo = (\n    lido && !Array.isArray(lido) && typeof lido === 'object' ? lido : {}\n  ) as (Partial<typeof DEFAULT_OPCOES> & { preset?: string }) | {};\n\n  const nomePreset = (overrides?.preset ||\n    (cfgArquivo as { preset?: string }).preset) as string | undefined;\n  const preset =\n    nomePreset && PRESETS[nomePreset]?.nome ? PRESETS[nomePreset] : undefined;\n\n  // Merge determinístico: DEFAULT -> PRESET -> ARQUIVO -> OVERRIDES (apenas chaves definidas)\n  const base = { ...DEFAULT_OPCOES } as Required<typeof DEFAULT_OPCOES>;\n  const aplicarParcial = (src?: Partial<typeof DEFAULT_OPCOES>) => {\n    if (!src) return;\n    if (src.raizCodigo) base.raizCodigo = src.raizCodigo as string;\n    if (typeof src.criarSubpastasPorEntidade === 'boolean')\n      base.criarSubpastasPorEntidade = src.criarSubpastasPorEntidade as boolean;\n    if (typeof src.apenasCategoriasConfiguradas === 'boolean')\n      base.apenasCategoriasConfiguradas =\n        src.apenasCategoriasConfiguradas as boolean;\n    if (src.estiloPreferido)\n      base.estiloPreferido = src.estiloPreferido as NomeacaoEstilo;\n    if (src.categoriasMapa)\n      base.categoriasMapa = {\n        ...base.categoriasMapa,\n        ...src.categoriasMapa,\n      } as Record<string, string>;\n    if (src.ignorarPastas && Array.isArray(src.ignorarPastas))\n      base.ignorarPastas = Array.from(\n        new Set([...base.ignorarPastas, ...src.ignorarPastas]),\n      );\n  };\n  aplicarParcial(preset as Partial<typeof DEFAULT_OPCOES>);\n  aplicarParcial(cfgArquivo as Partial<typeof DEFAULT_OPCOES>);\n  aplicarParcial(overrides as Partial<typeof DEFAULT_OPCOES>);\n\n  // No modo de preset (apenasCategoriasConfiguradas=false), garantimos defaults base.\n  // No modo manual (true), o usuário controla explicitamente o que será mapeado.\n  if (!base.apenasCategoriasConfiguradas) {\n    base.categoriasMapa = {\n      ...CATEGORIAS_DEFAULT,\n      ...base.categoriasMapa,\n    } as Record<string, string>;\n  }\n  return base;\n}\n"]}