{"version":3,"file":"rule-config.js","sourceRoot":"","sources":["../../../src/shared/helpers/rule-config.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\n/**\n * Sistema de configuração granular de regras\n * Suporta:\n * - Regras por arquivo/diretório (glob patterns)\n * - Overrides específicos\n * - Severidade customizada\n * - Exclusões por padrão de arquivo\n */\n\nimport { config } from '@core/config/config.js';\nimport { minimatch } from 'minimatch';\n\nimport type { RuleConfig, RuleOverride } from '@';\n\nexport type { RuleConfig, RuleOverride };\n\n/**\n * Verifica se uma regra deve ser aplicada para um arquivo específico\n */\nexport function isRuleSuppressed(ruleName: string, filePath: string): boolean {\n  // Normaliza o caminho do arquivo (remove ./ e normaliza barras)\n  const normalizedPath = filePath.replace(/^\\.\\//, '').replace(/\\\\/g, '/');\n\n  // 1. Verifica suppressRules globais (config antigo - compatibilidade)\n  const configData = config as unknown as {\n    suppressRules?: string[];\n    rules?: Record<string, RuleConfig>;\n    testPatterns?: { files?: string[]; allowAnyType?: boolean };\n  };\n\n  const suppressRules = configData.suppressRules;\n  if (suppressRules?.includes(ruleName)) {\n    return true;\n  }\n\n  // 2. Verifica config.rules (novo sistema)\n  const ruleConfig = configData.rules?.[ruleName];\n  if (ruleConfig) {\n    // Verifica se severity é 'off'\n    if (ruleConfig.severity === 'off') {\n      return true;\n    }\n\n    // Verifica se arquivo está em exclude patterns\n    if (ruleConfig.exclude) {\n      for (const pattern of ruleConfig.exclude) {\n        if (minimatch(normalizedPath, pattern, { dot: true })) {\n          return true;\n        }\n      }\n    }\n\n    // Verifica allowTestFiles para arquivos de teste\n    if (ruleConfig.allowTestFiles && isTestFile(normalizedPath, configData)) {\n      return true;\n    }\n  }\n\n  // 3. Verifica padrões de teste globais (para tipo-inseguro em testes)\n  if (ruleName === 'tipo-inseguro' || ruleName === 'tipo-inseguro-any') {\n    const testPatterns = configData.testPatterns;\n    if (testPatterns?.allowAnyType && isTestFile(normalizedPath, configData)) {\n      return true;\n    }\n  }\n\n  return false;\n} /**\n * Verifica se um arquivo é de teste baseado nos padrões configurados\n */\nfunction isTestFile(\n  filePath: string,\n  configData: { testPatterns?: { files?: string[] } },\n): boolean {\n  const testPatterns = configData.testPatterns?.files || [\n    '**/*.test.*',\n    '**/*.spec.*',\n    'test/**/*',\n    'tests/**/*',\n    '**/__tests__/**',\n  ];\n\n  return testPatterns.some((pattern) =>\n    minimatch(filePath, pattern, { dot: true }),\n  );\n}\n\n/**\n * Obtém a severidade configurada para uma regra\n */\nexport function getRuleSeverity(\n  ruleName: string,\n  filePath: string,\n): 'error' | 'warning' | 'info' | undefined {\n  const configData = config as unknown as {\n    rules?: Record<string, RuleConfig>;\n  };\n  const ruleConfig = configData.rules?.[ruleName];\n\n  if (!ruleConfig) {\n    return undefined;\n  }\n\n  // Se regra está suprimida, retorna undefined\n  if (isRuleSuppressed(ruleName, filePath)) {\n    return undefined;\n  }\n\n  // Mapeia severidades\n  if (ruleConfig.severity === 'error') return 'error';\n  if (ruleConfig.severity === 'warning') return 'warning';\n  if (ruleConfig.severity === 'info') return 'info';\n\n  return undefined;\n}\n\n/**\n * Verifica se uma ocorrência deve ser suprimida baseado na configuração\n */\nexport function shouldSuppressOccurrence(\n  tipo: string,\n  filePath: string,\n  _severity?: string,\n): boolean {\n  // Extrai o nome base da regra\n  // tipo-inseguro-any -> tipo-inseguro\n  // tipo-inseguro-any-assertion -> tipo-inseguro\n  // tipo-inseguro-any-cast -> tipo-inseguro\n  // tipo-inseguro-unknown -> tipo-inseguro\n  const baseRuleName = tipo.replace(/-(any|unknown|assertion|cast).*$/, '');\n\n  // Verifica supressão para regra base e variantes\n  const rulesToCheck = [tipo, baseRuleName];\n\n  return rulesToCheck.some((rule) => isRuleSuppressed(rule, filePath));\n}\n"]}