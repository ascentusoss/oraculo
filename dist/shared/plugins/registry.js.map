{"version":3,"file":"registry.js","sourceRoot":"","sources":["../../../src/shared/plugins/registry.ts"],"names":[],"mappings":"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","sourcesContent":["// SPDX-License-Identifier: MIT\nimport { ExcecoesMessages } from '/messages/core/excecoes-messages.js';\nimport { log, logCore } from '/messages/index.js';\n\nimport type {\n  GlobalComImport,\n  ImportDinamico,\n  LanguageSupport,\n  ParserPlugin,\n  PluginConfig,\n} from '@';\n\n/**\n * Registry centralizado para gerenciamento de plugins de parser\n * Suporta loading din√¢mico, cache e configura√ß√£o flex√≠vel\n */\nexport class PluginRegistry {\n  private plugins = new Map<string, ParserPlugin>();\n  private extensionMap = new Map<string, string>(); // extens√£o -> nome do plugin\n  private config: PluginConfig;\n  private userConfiguredEnabled = false;\n  private languageSupport: Record<string, LanguageSupport>;\n  private loadingPromises = new Map<string, Promise<ParserPlugin>>();\n\n  constructor(\n    config?: PluginConfig,\n    languageSupport?: Record<string, LanguageSupport>,\n  ) {\n    this.config = {\n      enabled: ['core'],\n      autoload: true,\n      registry: '/plugins',\n      ...config,\n    };\n    this.userConfiguredEnabled = !!config?.enabled;\n    this.languageSupport = languageSupport || {};\n  }\n\n  /**\n   * Registra um plugin no registry\n   */\n  registerPlugin(plugin: ParserPlugin): void {\n    logCore.registrandoPlugin(plugin.name, plugin.version);\n\n    // Valida o plugin\n    this.validatePlugin(plugin);\n\n    // Registra o plugin\n    this.plugins.set(plugin.name, plugin);\n\n    // Mapeia extens√µes para o plugin\n    for (const ext of plugin.extensions) {\n      if (this.extensionMap.has(ext)) {\n        const existing = this.extensionMap.get(ext);\n        log.debug(\n          `‚ö†Ô∏è Extens√£o ${ext} j√° mapeada para plugin ${existing}, sobrescrevendo com ${plugin.name}`,\n        );\n      }\n      this.extensionMap.set(ext, plugin.name);\n    }\n\n    log.debug(\n      `‚úÖ Plugin ${plugin.name} registrado com extens√µes: ${plugin.extensions.join(', ')}`,\n    );\n  }\n\n  /**\n   * Carrega um plugin dinamicamente\n   */\n  async loadPlugin(name: string): Promise<ParserPlugin> {\n    // Se j√° est√° carregado, retorna\n    if (this.plugins.has(name)) {\n      const plugin = this.plugins.get(name);\n      if (!plugin) {\n        throw new Error(\n          ExcecoesMessages.pluginRegistradoNaoPodeSerObtido(name),\n        );\n      }\n      return plugin;\n    }\n\n    // Se j√° est√° sendo carregado, retorna a promise existente\n    // NOTE: este padr√£o evita condi√ß√µes de race onde m√∫ltiplos callers tentariam\n    // carregar o mesmo plugin simultaneamente ‚Äî a promise existente √© retornada\n    // e quaisquer erros s√£o propagados pela promise, evitando rejetions n√£o tratadas.\n    if (this.loadingPromises.has(name)) {\n      const promise = this.loadingPromises.get(name);\n      if (!promise) {\n        throw new Error(\n          ExcecoesMessages.pluginCarregandoPromiseNaoPodeSerObtida(name),\n        );\n      }\n      return promise;\n    }\n\n    // Cria nova promise de loading\n    const loadingPromise = this.doLoadPlugin(name);\n    this.loadingPromises.set(name, loadingPromise);\n\n    try {\n      const plugin = await loadingPromise;\n      this.loadingPromises.delete(name);\n      return plugin;\n    } catch (error) {\n      this.loadingPromises.delete(name);\n      throw error;\n    }\n  }\n\n  /**\n   * Implementa√ß√£o real do loading do plugin\n   */\n  private async doLoadPlugin(name: string): Promise<ParserPlugin> {\n    log.debug(`üì¶ Carregando plugin: ${name}`);\n\n    try {\n      // Tenta carregar do registry configurado\n      const pluginPath = `${this.config.registry}/${name}-plugin`;\n      // Usa import din√¢mico mock√°vel (globalThis.import pode ser substitu√≠do nos testes)\n      const dynImport: ImportDinamico =\n        (globalThis as GlobalComImport).import || ((p: string) => import(p));\n      const pluginModule = await dynImport(pluginPath);\n\n      const plugin: ParserPlugin =\n        ((pluginModule as Record<string, unknown>).default as ParserPlugin) ||\n        (pluginModule as ParserPlugin);\n\n      // Valida e registra\n      this.validatePlugin(plugin);\n      this.registerPlugin(plugin);\n\n      return plugin;\n    } catch (error) {\n      logCore.erroCarregarPlugin(name, (error as Error).message);\n      throw new Error(\n        ExcecoesMessages.naoFoiPossivelCarregarPlugin(\n          name,\n          (error as Error).message,\n        ),\n      );\n    }\n  }\n\n  /**\n   * Obt√©m plugin por extens√£o de arquivo\n   */\n  async getPluginForExtension(extension: string): Promise<ParserPlugin | null> {\n    const pluginName = this.extensionMap.get(extension);\n\n    if (!pluginName) {\n      if (this.config.autoload) {\n        logCore.tentandoAutoload(extension);\n        // Tenta inferir nome do plugin pela extens√£o\n        const inferredName = this.inferPluginName(extension);\n        if (inferredName && this.config.enabled.includes(inferredName)) {\n          try {\n            return await this.loadPlugin(inferredName);\n          } catch {\n            logCore.autoloadFalhou(inferredName);\n          }\n        }\n      }\n      return null;\n    }\n\n    // Verifica se o plugin est√° habilitado\n    // Regra: se o usu√°rio N√ÉO configurou a lista 'enabled', tratamos todos os plugins registrados como habilitados por padr√£o.\n    // S√≥ aplicamos o gate includes() quando houve configura√ß√£o expl√≠cita de 'enabled'.\n    if (\n      this.userConfiguredEnabled &&\n      !this.config.enabled.includes(pluginName)\n    ) {\n      log.debug(\n        `üö´ Plugin ${pluginName} est√° desabilitado para extens√£o ${extension}`,\n      );\n      return null;\n    }\n\n    // Verifica suporte da linguagem\n    const langKey = extension.substring(1); // remove o ponto\n    const langSupport = this.languageSupport[langKey];\n    if (langSupport && !langSupport.enabled) {\n      log.debug(`üö´ Suporte √† linguagem ${langKey} est√° desabilitado`);\n      return null;\n    }\n\n    return await this.loadPlugin(pluginName);\n  }\n\n  /**\n   * Infere nome do plugin baseado na extens√£o\n   */\n  private inferPluginName(extension: string): string | null {\n    const extMap: Record<string, string> = {\n      '.xml': 'core', // XML fica no core\n      '.html': 'core', // HTML fica no core\n      '.htm': 'core',\n      '.css': 'core', // CSS fica no core\n      '.js': 'core',\n      '.jsx': 'core',\n      '.ts': 'core',\n      '.tsx': 'core',\n      '.mjs': 'core',\n      '.cjs': 'core',\n      '.php': 'core', // PHP fica no core\n      '.py': 'core', // Python fica no core\n    };\n\n    return extMap[extension] || null;\n  }\n\n  /**\n   * Valida um plugin antes do registro\n   */\n  private validatePlugin(plugin: ParserPlugin): void {\n    if (!plugin.name || typeof plugin.name !== 'string') {\n      throw new Error(ExcecoesMessages.pluginDeveTerNomeValido);\n    }\n\n    if (!plugin.version || typeof plugin.version !== 'string') {\n      throw new Error(ExcecoesMessages.pluginDeveTerVersaoValida);\n    }\n\n    if (!Array.isArray(plugin.extensions) || plugin.extensions.length === 0) {\n      throw new Error(ExcecoesMessages.pluginDeveDefinirPeloMenosUmaExtensao);\n    }\n\n    if (typeof plugin.parse !== 'function') {\n      throw new Error(ExcecoesMessages.pluginDeveImplementarMetodoParse);\n    }\n  }\n\n  /**\n   * Lista plugins registrados\n   */\n  getRegisteredPlugins(): string[] {\n    return Array.from(this.plugins.keys());\n  }\n\n  /**\n   * Lista extens√µes suportadas\n   */\n  getSupportedExtensions(): string[] {\n    return Array.from(this.extensionMap.keys());\n  }\n\n  /**\n   * Obt√©m estat√≠sticas do registry\n   */\n  getStats(): {\n    pluginsRegistrados: number;\n    extensoesSuportadas: number;\n    pluginsHabilitados: number;\n    autoloadAtivo: boolean;\n  } {\n    return {\n      pluginsRegistrados: this.plugins.size,\n      extensoesSuportadas: this.extensionMap.size,\n      pluginsHabilitados: this.config.enabled.length,\n      autoloadAtivo: this.config.autoload,\n    };\n  }\n\n  /**\n   * Atualiza configura√ß√£o do registry\n   */\n  updateConfig(newConfig: Partial<PluginConfig>): void {\n    this.config = { ...this.config, ...newConfig };\n    if (Object.prototype.hasOwnProperty.call(newConfig, 'enabled')) {\n      this.userConfiguredEnabled = true;\n    }\n    log.debug(`üîß Configura√ß√£o do registry atualizada`);\n  }\n\n  /**\n   * Atualiza suporte a linguagens\n   */\n  updateLanguageSupport(newSupport: Record<string, LanguageSupport>): void {\n    this.languageSupport = { ...this.languageSupport, ...newSupport };\n    log.debug(`üåê Suporte a linguagens atualizado`);\n  }\n\n  /**\n   * Limpa cache de plugins (√∫til para testes)\n   */\n  clearCache(): void {\n    this.plugins.clear();\n    this.extensionMap.clear();\n    this.loadingPromises.clear();\n    log.debug(`üßπ Cache do registry limpo`);\n  }\n}\n\n/**\n * Inst√¢ncia global do registry (singleton)\n */\nlet globalRegistry: PluginRegistry | null = null;\n\n/**\n * Obt√©m a inst√¢ncia global do registry\n */\n\nexport function getGlobalRegistry(): PluginRegistry {\n  if (!globalRegistry) {\n    globalRegistry = new PluginRegistry();\n  }\n  return globalRegistry;\n}\n\n/**\n * Configura a inst√¢ncia global do registry\n */\n\nexport function configureGlobalRegistry(\n  config?: PluginConfig,\n  languageSupport?: Record<string, LanguageSupport>,\n): void {\n  globalRegistry = new PluginRegistry(config, languageSupport);\n}\n\n/**\n * Reseta a inst√¢ncia global (√∫til para testes)\n */\n\nexport function resetGlobalRegistry(): void {\n  globalRegistry = null;\n}\n"]}